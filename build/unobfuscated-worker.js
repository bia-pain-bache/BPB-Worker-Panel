var ma=Object.create;var Dr=Object.defineProperty;var xa=Object.getOwnPropertyDescriptor;var ba=Object.getOwnPropertyNames;var ga=Object.getPrototypeOf,ya=Object.prototype.hasOwnProperty;var f=(t,r)=>Dr(t,"name",{value:r,configurable:!0}),po=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,a)=>(typeof require<"u"?require:r)[a]}):t)((function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}));var cr=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var wa=(t,r,a,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of ba(r))!ya.call(t,l)&&l!==a&&Dr(t,l,{get:()=>r[l],enumerable:!(n=xa(r,l))||n.enumerable});return t};var Nr=(t,r,a)=>(a=t!=null?ma(ga(t)):{},wa(r||!t||!t.__esModule?Dr(a,"default",{value:t,enumerable:!0}):a,t));var Yr=cr((()=>{}));var Xr=cr(((Vi,wr)=>{(function(t){"use strict";var r=f((function(o){var i,s=new Float64Array(16);if(o)for(i=0;i<o.length;i++)s[i]=o[i];return s}),"gf"),a=f((function(){throw new Error("no PRNG")}),"randombytes"),n=new Uint8Array(16),l=new Uint8Array(32);l[0]=9;var h=r(),d=r([1]),v=r([56129,1]),p=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),w=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),_=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(o,i,s,e){o[i]=s>>24&255,o[i+1]=s>>16&255,o[i+2]=s>>8&255,o[i+3]=s&255,o[i+4]=e>>24&255,o[i+5]=e>>16&255,o[i+6]=e>>8&255,o[i+7]=e&255}f(k,"ts64");function M(o,i,s,e,c){var m,b=0;for(m=0;m<c;m++)b|=o[i+m]^s[e+m];return(1&b-1>>>8)-1}f(M,"vn");function z(o,i,s,e){return M(o,i,s,e,16)}f(z,"crypto_verify_16");function V(o,i,s,e){return M(o,i,s,e,32)}f(V,"crypto_verify_32");function W(o,i,s,e){for(var c=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,m=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,b=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,I=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,O=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,oe=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,G=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,Re=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,q=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,le=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,de=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,ge=s[16]&255|(s[17]&255)<<8|(s[18]&255)<<16|(s[19]&255)<<24,be=s[20]&255|(s[21]&255)<<8|(s[22]&255)<<16|(s[23]&255)<<24,ue=s[24]&255|(s[25]&255)<<8|(s[26]&255)<<16|(s[27]&255)<<24,he=s[28]&255|(s[29]&255)<<8|(s[30]&255)<<16|(s[31]&255)<<24,pe=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,Z=c,ae=m,Q=b,ee=I,re=O,j=oe,S=G,C=Re,N=q,$=le,T=de,U=ge,ce=be,ye=ue,ve=he,we=pe,u,Pe=0;Pe<20;Pe+=2)u=Z+ce|0,re^=u<<7|u>>>25,u=re+Z|0,N^=u<<9|u>>>23,u=N+re|0,ce^=u<<13|u>>>19,u=ce+N|0,Z^=u<<18|u>>>14,u=j+ae|0,$^=u<<7|u>>>25,u=$+j|0,ye^=u<<9|u>>>23,u=ye+$|0,ae^=u<<13|u>>>19,u=ae+ye|0,j^=u<<18|u>>>14,u=T+S|0,ve^=u<<7|u>>>25,u=ve+T|0,Q^=u<<9|u>>>23,u=Q+ve|0,S^=u<<13|u>>>19,u=S+Q|0,T^=u<<18|u>>>14,u=we+U|0,ee^=u<<7|u>>>25,u=ee+we|0,C^=u<<9|u>>>23,u=C+ee|0,U^=u<<13|u>>>19,u=U+C|0,we^=u<<18|u>>>14,u=Z+ee|0,ae^=u<<7|u>>>25,u=ae+Z|0,Q^=u<<9|u>>>23,u=Q+ae|0,ee^=u<<13|u>>>19,u=ee+Q|0,Z^=u<<18|u>>>14,u=j+re|0,S^=u<<7|u>>>25,u=S+j|0,C^=u<<9|u>>>23,u=C+S|0,re^=u<<13|u>>>19,u=re+C|0,j^=u<<18|u>>>14,u=T+$|0,U^=u<<7|u>>>25,u=U+T|0,N^=u<<9|u>>>23,u=N+U|0,$^=u<<13|u>>>19,u=$+N|0,T^=u<<18|u>>>14,u=we+ve|0,ce^=u<<7|u>>>25,u=ce+we|0,ye^=u<<9|u>>>23,u=ye+ce|0,ve^=u<<13|u>>>19,u=ve+ye|0,we^=u<<18|u>>>14;Z=Z+c|0,ae=ae+m|0,Q=Q+b|0,ee=ee+I|0,re=re+O|0,j=j+oe|0,S=S+G|0,C=C+Re|0,N=N+q|0,$=$+le|0,T=T+de|0,U=U+ge|0,ce=ce+be|0,ye=ye+ue|0,ve=ve+he|0,we=we+pe|0,o[0]=Z>>>0&255,o[1]=Z>>>8&255,o[2]=Z>>>16&255,o[3]=Z>>>24&255,o[4]=ae>>>0&255,o[5]=ae>>>8&255,o[6]=ae>>>16&255,o[7]=ae>>>24&255,o[8]=Q>>>0&255,o[9]=Q>>>8&255,o[10]=Q>>>16&255,o[11]=Q>>>24&255,o[12]=ee>>>0&255,o[13]=ee>>>8&255,o[14]=ee>>>16&255,o[15]=ee>>>24&255,o[16]=re>>>0&255,o[17]=re>>>8&255,o[18]=re>>>16&255,o[19]=re>>>24&255,o[20]=j>>>0&255,o[21]=j>>>8&255,o[22]=j>>>16&255,o[23]=j>>>24&255,o[24]=S>>>0&255,o[25]=S>>>8&255,o[26]=S>>>16&255,o[27]=S>>>24&255,o[28]=C>>>0&255,o[29]=C>>>8&255,o[30]=C>>>16&255,o[31]=C>>>24&255,o[32]=N>>>0&255,o[33]=N>>>8&255,o[34]=N>>>16&255,o[35]=N>>>24&255,o[36]=$>>>0&255,o[37]=$>>>8&255,o[38]=$>>>16&255,o[39]=$>>>24&255,o[40]=T>>>0&255,o[41]=T>>>8&255,o[42]=T>>>16&255,o[43]=T>>>24&255,o[44]=U>>>0&255,o[45]=U>>>8&255,o[46]=U>>>16&255,o[47]=U>>>24&255,o[48]=ce>>>0&255,o[49]=ce>>>8&255,o[50]=ce>>>16&255,o[51]=ce>>>24&255,o[52]=ye>>>0&255,o[53]=ye>>>8&255,o[54]=ye>>>16&255,o[55]=ye>>>24&255,o[56]=ve>>>0&255,o[57]=ve>>>8&255,o[58]=ve>>>16&255,o[59]=ve>>>24&255,o[60]=we>>>0&255,o[61]=we>>>8&255,o[62]=we>>>16&255,o[63]=we>>>24&255}f(W,"core_salsa20");function B(o,i,s,e){for(var c=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,m=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,b=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,I=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,O=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,oe=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,G=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,Re=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,q=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,le=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,de=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,ge=s[16]&255|(s[17]&255)<<8|(s[18]&255)<<16|(s[19]&255)<<24,be=s[20]&255|(s[21]&255)<<8|(s[22]&255)<<16|(s[23]&255)<<24,ue=s[24]&255|(s[25]&255)<<8|(s[26]&255)<<16|(s[27]&255)<<24,he=s[28]&255|(s[29]&255)<<8|(s[30]&255)<<16|(s[31]&255)<<24,pe=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,Z=c,ae=m,Q=b,ee=I,re=O,j=oe,S=G,C=Re,N=q,$=le,T=de,U=ge,ce=be,ye=ue,ve=he,we=pe,u,Pe=0;Pe<20;Pe+=2)u=Z+ce|0,re^=u<<7|u>>>25,u=re+Z|0,N^=u<<9|u>>>23,u=N+re|0,ce^=u<<13|u>>>19,u=ce+N|0,Z^=u<<18|u>>>14,u=j+ae|0,$^=u<<7|u>>>25,u=$+j|0,ye^=u<<9|u>>>23,u=ye+$|0,ae^=u<<13|u>>>19,u=ae+ye|0,j^=u<<18|u>>>14,u=T+S|0,ve^=u<<7|u>>>25,u=ve+T|0,Q^=u<<9|u>>>23,u=Q+ve|0,S^=u<<13|u>>>19,u=S+Q|0,T^=u<<18|u>>>14,u=we+U|0,ee^=u<<7|u>>>25,u=ee+we|0,C^=u<<9|u>>>23,u=C+ee|0,U^=u<<13|u>>>19,u=U+C|0,we^=u<<18|u>>>14,u=Z+ee|0,ae^=u<<7|u>>>25,u=ae+Z|0,Q^=u<<9|u>>>23,u=Q+ae|0,ee^=u<<13|u>>>19,u=ee+Q|0,Z^=u<<18|u>>>14,u=j+re|0,S^=u<<7|u>>>25,u=S+j|0,C^=u<<9|u>>>23,u=C+S|0,re^=u<<13|u>>>19,u=re+C|0,j^=u<<18|u>>>14,u=T+$|0,U^=u<<7|u>>>25,u=U+T|0,N^=u<<9|u>>>23,u=N+U|0,$^=u<<13|u>>>19,u=$+N|0,T^=u<<18|u>>>14,u=we+ve|0,ce^=u<<7|u>>>25,u=ce+we|0,ye^=u<<9|u>>>23,u=ye+ce|0,ve^=u<<13|u>>>19,u=ve+ye|0,we^=u<<18|u>>>14;o[0]=Z>>>0&255,o[1]=Z>>>8&255,o[2]=Z>>>16&255,o[3]=Z>>>24&255,o[4]=j>>>0&255,o[5]=j>>>8&255,o[6]=j>>>16&255,o[7]=j>>>24&255,o[8]=T>>>0&255,o[9]=T>>>8&255,o[10]=T>>>16&255,o[11]=T>>>24&255,o[12]=we>>>0&255,o[13]=we>>>8&255,o[14]=we>>>16&255,o[15]=we>>>24&255,o[16]=S>>>0&255,o[17]=S>>>8&255,o[18]=S>>>16&255,o[19]=S>>>24&255,o[20]=C>>>0&255,o[21]=C>>>8&255,o[22]=C>>>16&255,o[23]=C>>>24&255,o[24]=N>>>0&255,o[25]=N>>>8&255,o[26]=N>>>16&255,o[27]=N>>>24&255,o[28]=$>>>0&255,o[29]=$>>>8&255,o[30]=$>>>16&255,o[31]=$>>>24&255}f(B,"core_hsalsa20");function H(o,i,s,e){W(o,i,s,e)}f(H,"crypto_core_salsa20");function X(o,i,s,e){B(o,i,s,e)}f(X,"crypto_core_hsalsa20");var K=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function x(o,i,s,e,c,m,b){var I=new Uint8Array(16),O=new Uint8Array(64),oe,G;for(G=0;G<16;G++)I[G]=0;for(G=0;G<8;G++)I[G]=m[G];for(;c>=64;){for(H(O,I,b,K),G=0;G<64;G++)o[i+G]=s[e+G]^O[G];for(oe=1,G=8;G<16;G++)oe=oe+(I[G]&255)|0,I[G]=oe&255,oe>>>=8;c-=64,i+=64,e+=64}if(c>0)for(H(O,I,b,K),G=0;G<c;G++)o[i+G]=s[e+G]^O[G];return 0}f(x,"crypto_stream_salsa20_xor");function A(o,i,s,e,c){var m=new Uint8Array(16),b=new Uint8Array(64),I,O;for(O=0;O<16;O++)m[O]=0;for(O=0;O<8;O++)m[O]=e[O];for(;s>=64;){for(H(b,m,c,K),O=0;O<64;O++)o[i+O]=b[O];for(I=1,O=8;O<16;O++)I=I+(m[O]&255)|0,m[O]=I&255,I>>>=8;s-=64,i+=64}if(s>0)for(H(b,m,c,K),O=0;O<s;O++)o[i+O]=b[O];return 0}f(A,"crypto_stream_salsa20");function D(o,i,s,e,c){var m=new Uint8Array(32);X(m,e,c,K);for(var b=new Uint8Array(8),I=0;I<8;I++)b[I]=e[I+16];return A(o,i,s,b,m)}f(D,"crypto_stream");function E(o,i,s,e,c,m,b){var I=new Uint8Array(32);X(I,m,b,K);for(var O=new Uint8Array(8),oe=0;oe<8;oe++)O[oe]=m[oe+16];return x(o,i,s,e,c,O,I)}f(E,"crypto_stream_xor");var L=f((function(o){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var i,s,e,c,m,b,I,O;i=o[0]&255|(o[1]&255)<<8,this.r[0]=i&8191,s=o[2]&255|(o[3]&255)<<8,this.r[1]=(i>>>13|s<<3)&8191,e=o[4]&255|(o[5]&255)<<8,this.r[2]=(s>>>10|e<<6)&7939,c=o[6]&255|(o[7]&255)<<8,this.r[3]=(e>>>7|c<<9)&8191,m=o[8]&255|(o[9]&255)<<8,this.r[4]=(c>>>4|m<<12)&255,this.r[5]=m>>>1&8190,b=o[10]&255|(o[11]&255)<<8,this.r[6]=(m>>>14|b<<2)&8191,I=o[12]&255|(o[13]&255)<<8,this.r[7]=(b>>>11|I<<5)&8065,O=o[14]&255|(o[15]&255)<<8,this.r[8]=(I>>>8|O<<8)&8191,this.r[9]=O>>>5&127,this.pad[0]=o[16]&255|(o[17]&255)<<8,this.pad[1]=o[18]&255|(o[19]&255)<<8,this.pad[2]=o[20]&255|(o[21]&255)<<8,this.pad[3]=o[22]&255|(o[23]&255)<<8,this.pad[4]=o[24]&255|(o[25]&255)<<8,this.pad[5]=o[26]&255|(o[27]&255)<<8,this.pad[6]=o[28]&255|(o[29]&255)<<8,this.pad[7]=o[30]&255|(o[31]&255)<<8}),"poly1305");L.prototype.blocks=function(o,i,s){for(var e=this.fin?0:2048,c,m,b,I,O,oe,G,Re,q,le,de,ge,be,ue,he,pe,Z,ae,Q,ee=this.h[0],re=this.h[1],j=this.h[2],S=this.h[3],C=this.h[4],N=this.h[5],$=this.h[6],T=this.h[7],U=this.h[8],ce=this.h[9],ye=this.r[0],ve=this.r[1],we=this.r[2],u=this.r[3],Pe=this.r[4],_e=this.r[5],$e=this.r[6],Ce=this.r[7],Ee=this.r[8],Ae=this.r[9];s>=16;)c=o[i+0]&255|(o[i+1]&255)<<8,ee+=c&8191,m=o[i+2]&255|(o[i+3]&255)<<8,re+=(c>>>13|m<<3)&8191,b=o[i+4]&255|(o[i+5]&255)<<8,j+=(m>>>10|b<<6)&8191,I=o[i+6]&255|(o[i+7]&255)<<8,S+=(b>>>7|I<<9)&8191,O=o[i+8]&255|(o[i+9]&255)<<8,C+=(I>>>4|O<<12)&8191,N+=O>>>1&8191,oe=o[i+10]&255|(o[i+11]&255)<<8,$+=(O>>>14|oe<<2)&8191,G=o[i+12]&255|(o[i+13]&255)<<8,T+=(oe>>>11|G<<5)&8191,Re=o[i+14]&255|(o[i+15]&255)<<8,U+=(G>>>8|Re<<8)&8191,ce+=Re>>>5|e,q=0,le=q,le+=ee*ye,le+=re*(5*Ae),le+=j*(5*Ee),le+=S*(5*Ce),le+=C*(5*$e),q=le>>>13,le&=8191,le+=N*(5*_e),le+=$*(5*Pe),le+=T*(5*u),le+=U*(5*we),le+=ce*(5*ve),q+=le>>>13,le&=8191,de=q,de+=ee*ve,de+=re*ye,de+=j*(5*Ae),de+=S*(5*Ee),de+=C*(5*Ce),q=de>>>13,de&=8191,de+=N*(5*$e),de+=$*(5*_e),de+=T*(5*Pe),de+=U*(5*u),de+=ce*(5*we),q+=de>>>13,de&=8191,ge=q,ge+=ee*we,ge+=re*ve,ge+=j*ye,ge+=S*(5*Ae),ge+=C*(5*Ee),q=ge>>>13,ge&=8191,ge+=N*(5*Ce),ge+=$*(5*$e),ge+=T*(5*_e),ge+=U*(5*Pe),ge+=ce*(5*u),q+=ge>>>13,ge&=8191,be=q,be+=ee*u,be+=re*we,be+=j*ve,be+=S*ye,be+=C*(5*Ae),q=be>>>13,be&=8191,be+=N*(5*Ee),be+=$*(5*Ce),be+=T*(5*$e),be+=U*(5*_e),be+=ce*(5*Pe),q+=be>>>13,be&=8191,ue=q,ue+=ee*Pe,ue+=re*u,ue+=j*we,ue+=S*ve,ue+=C*ye,q=ue>>>13,ue&=8191,ue+=N*(5*Ae),ue+=$*(5*Ee),ue+=T*(5*Ce),ue+=U*(5*$e),ue+=ce*(5*_e),q+=ue>>>13,ue&=8191,he=q,he+=ee*_e,he+=re*Pe,he+=j*u,he+=S*we,he+=C*ve,q=he>>>13,he&=8191,he+=N*ye,he+=$*(5*Ae),he+=T*(5*Ee),he+=U*(5*Ce),he+=ce*(5*$e),q+=he>>>13,he&=8191,pe=q,pe+=ee*$e,pe+=re*_e,pe+=j*Pe,pe+=S*u,pe+=C*we,q=pe>>>13,pe&=8191,pe+=N*ve,pe+=$*ye,pe+=T*(5*Ae),pe+=U*(5*Ee),pe+=ce*(5*Ce),q+=pe>>>13,pe&=8191,Z=q,Z+=ee*Ce,Z+=re*$e,Z+=j*_e,Z+=S*Pe,Z+=C*u,q=Z>>>13,Z&=8191,Z+=N*we,Z+=$*ve,Z+=T*ye,Z+=U*(5*Ae),Z+=ce*(5*Ee),q+=Z>>>13,Z&=8191,ae=q,ae+=ee*Ee,ae+=re*Ce,ae+=j*$e,ae+=S*_e,ae+=C*Pe,q=ae>>>13,ae&=8191,ae+=N*u,ae+=$*we,ae+=T*ve,ae+=U*ye,ae+=ce*(5*Ae),q+=ae>>>13,ae&=8191,Q=q,Q+=ee*Ae,Q+=re*Ee,Q+=j*Ce,Q+=S*$e,Q+=C*_e,q=Q>>>13,Q&=8191,Q+=N*Pe,Q+=$*u,Q+=T*we,Q+=U*ve,Q+=ce*ye,q+=Q>>>13,Q&=8191,q=(q<<2)+q|0,q=q+le|0,le=q&8191,q=q>>>13,de+=q,ee=le,re=de,j=ge,S=be,C=ue,N=he,$=pe,T=Z,U=ae,ce=Q,i+=16,s-=16;this.h[0]=ee,this.h[1]=re,this.h[2]=j,this.h[3]=S,this.h[4]=C,this.h[5]=N,this.h[6]=$,this.h[7]=T,this.h[8]=U,this.h[9]=ce},L.prototype.finish=function(o,i){var s=new Uint16Array(10),e,c,m,b;if(this.leftover){for(b=this.leftover,this.buffer[b++]=1;b<16;b++)this.buffer[b]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(e=this.h[1]>>>13,this.h[1]&=8191,b=2;b<10;b++)this.h[b]+=e,e=this.h[b]>>>13,this.h[b]&=8191;for(this.h[0]+=e*5,e=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=e,e=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=e,s[0]=this.h[0]+5,e=s[0]>>>13,s[0]&=8191,b=1;b<10;b++)s[b]=this.h[b]+e,e=s[b]>>>13,s[b]&=8191;for(s[9]-=8192,c=(e^1)-1,b=0;b<10;b++)s[b]&=c;for(c=~c,b=0;b<10;b++)this.h[b]=this.h[b]&c|s[b];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,m=this.h[0]+this.pad[0],this.h[0]=m&65535,b=1;b<8;b++)m=(this.h[b]+this.pad[b]|0)+(m>>>16)|0,this.h[b]=m&65535;o[i+0]=this.h[0]>>>0&255,o[i+1]=this.h[0]>>>8&255,o[i+2]=this.h[1]>>>0&255,o[i+3]=this.h[1]>>>8&255,o[i+4]=this.h[2]>>>0&255,o[i+5]=this.h[2]>>>8&255,o[i+6]=this.h[3]>>>0&255,o[i+7]=this.h[3]>>>8&255,o[i+8]=this.h[4]>>>0&255,o[i+9]=this.h[4]>>>8&255,o[i+10]=this.h[5]>>>0&255,o[i+11]=this.h[5]>>>8&255,o[i+12]=this.h[6]>>>0&255,o[i+13]=this.h[6]>>>8&255,o[i+14]=this.h[7]>>>0&255,o[i+15]=this.h[7]>>>8&255},L.prototype.update=function(o,i,s){var e,c;if(this.leftover){for(c=16-this.leftover,c>s&&(c=s),e=0;e<c;e++)this.buffer[this.leftover+e]=o[i+e];if(s-=c,i+=c,this.leftover+=c,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(s>=16&&(c=s-s%16,this.blocks(o,i,c),i+=c,s-=c),s){for(e=0;e<s;e++)this.buffer[this.leftover+e]=o[i+e];this.leftover+=s}};function R(o,i,s,e,c,m){var b=new L(m);return b.update(s,e,c),b.finish(o,i),0}f(R,"crypto_onetimeauth");function J(o,i,s,e,c,m){var b=new Uint8Array(16);return R(b,0,s,e,c,m),z(o,i,b,0)}f(J,"crypto_onetimeauth_verify");function P(o,i,s,e,c){var m;if(s<32)return-1;for(E(o,0,i,0,s,e,c),R(o,16,o,32,s-32,o),m=0;m<16;m++)o[m]=0;return 0}f(P,"crypto_secretbox");function F(o,i,s,e,c){var m,b=new Uint8Array(32);if(s<32||(D(b,0,32,e,c),J(i,16,i,32,s-32,b)!==0))return-1;for(E(o,0,i,0,s,e,c),m=0;m<32;m++)o[m]=0;return 0}f(F,"crypto_secretbox_open");function Y(o,i){var s;for(s=0;s<16;s++)o[s]=i[s]|0}f(Y,"set25519");function se(o){var i,s,e=1;for(i=0;i<16;i++)s=o[i]+e+65535,e=Math.floor(s/65536),o[i]=s-e*65536;o[0]+=e-1+37*(e-1)}f(se,"car25519");function ie(o,i,s){for(var e,c=~(s-1),m=0;m<16;m++)e=c&(o[m]^i[m]),o[m]^=e,i[m]^=e}f(ie,"sel25519");function Se(o,i){var s,e,c,m=r(),b=r();for(s=0;s<16;s++)b[s]=i[s];for(se(b),se(b),se(b),e=0;e<2;e++){for(m[0]=b[0]-65517,s=1;s<15;s++)m[s]=b[s]-65535-(m[s-1]>>16&1),m[s-1]&=65535;m[15]=b[15]-32767-(m[14]>>16&1),c=m[15]>>16&1,m[14]&=65535,ie(b,m,1-c)}for(s=0;s<16;s++)o[2*s]=b[s]&255,o[2*s+1]=b[s]>>8}f(Se,"pack25519");function te(o,i){var s=new Uint8Array(32),e=new Uint8Array(32);return Se(s,o),Se(e,i),V(s,0,e,0)}f(te,"neq25519");function fe(o){var i=new Uint8Array(32);return Se(i,o),i[0]&1}f(fe,"par25519");function me(o,i){var s;for(s=0;s<16;s++)o[s]=i[2*s]+(i[2*s+1]<<8);o[15]&=32767}f(me,"unpack25519");function xe(o,i,s){for(var e=0;e<16;e++)o[e]=i[e]+s[e]}f(xe,"A");function ke(o,i,s){for(var e=0;e<16;e++)o[e]=i[e]-s[e]}f(ke,"Z");function ne(o,i,s){var e,c,m=0,b=0,I=0,O=0,oe=0,G=0,Re=0,q=0,le=0,de=0,ge=0,be=0,ue=0,he=0,pe=0,Z=0,ae=0,Q=0,ee=0,re=0,j=0,S=0,C=0,N=0,$=0,T=0,U=0,ce=0,ye=0,ve=0,we=0,u=s[0],Pe=s[1],_e=s[2],$e=s[3],Ce=s[4],Ee=s[5],Ae=s[6],Le=s[7],Te=s[8],Ue=s[9],Be=s[10],We=s[11],He=s[12],je=s[13],Ge=s[14],Ye=s[15];e=i[0],m+=e*u,b+=e*Pe,I+=e*_e,O+=e*$e,oe+=e*Ce,G+=e*Ee,Re+=e*Ae,q+=e*Le,le+=e*Te,de+=e*Ue,ge+=e*Be,be+=e*We,ue+=e*He,he+=e*je,pe+=e*Ge,Z+=e*Ye,e=i[1],b+=e*u,I+=e*Pe,O+=e*_e,oe+=e*$e,G+=e*Ce,Re+=e*Ee,q+=e*Ae,le+=e*Le,de+=e*Te,ge+=e*Ue,be+=e*Be,ue+=e*We,he+=e*He,pe+=e*je,Z+=e*Ge,ae+=e*Ye,e=i[2],I+=e*u,O+=e*Pe,oe+=e*_e,G+=e*$e,Re+=e*Ce,q+=e*Ee,le+=e*Ae,de+=e*Le,ge+=e*Te,be+=e*Ue,ue+=e*Be,he+=e*We,pe+=e*He,Z+=e*je,ae+=e*Ge,Q+=e*Ye,e=i[3],O+=e*u,oe+=e*Pe,G+=e*_e,Re+=e*$e,q+=e*Ce,le+=e*Ee,de+=e*Ae,ge+=e*Le,be+=e*Te,ue+=e*Ue,he+=e*Be,pe+=e*We,Z+=e*He,ae+=e*je,Q+=e*Ge,ee+=e*Ye,e=i[4],oe+=e*u,G+=e*Pe,Re+=e*_e,q+=e*$e,le+=e*Ce,de+=e*Ee,ge+=e*Ae,be+=e*Le,ue+=e*Te,he+=e*Ue,pe+=e*Be,Z+=e*We,ae+=e*He,Q+=e*je,ee+=e*Ge,re+=e*Ye,e=i[5],G+=e*u,Re+=e*Pe,q+=e*_e,le+=e*$e,de+=e*Ce,ge+=e*Ee,be+=e*Ae,ue+=e*Le,he+=e*Te,pe+=e*Ue,Z+=e*Be,ae+=e*We,Q+=e*He,ee+=e*je,re+=e*Ge,j+=e*Ye,e=i[6],Re+=e*u,q+=e*Pe,le+=e*_e,de+=e*$e,ge+=e*Ce,be+=e*Ee,ue+=e*Ae,he+=e*Le,pe+=e*Te,Z+=e*Ue,ae+=e*Be,Q+=e*We,ee+=e*He,re+=e*je,j+=e*Ge,S+=e*Ye,e=i[7],q+=e*u,le+=e*Pe,de+=e*_e,ge+=e*$e,be+=e*Ce,ue+=e*Ee,he+=e*Ae,pe+=e*Le,Z+=e*Te,ae+=e*Ue,Q+=e*Be,ee+=e*We,re+=e*He,j+=e*je,S+=e*Ge,C+=e*Ye,e=i[8],le+=e*u,de+=e*Pe,ge+=e*_e,be+=e*$e,ue+=e*Ce,he+=e*Ee,pe+=e*Ae,Z+=e*Le,ae+=e*Te,Q+=e*Ue,ee+=e*Be,re+=e*We,j+=e*He,S+=e*je,C+=e*Ge,N+=e*Ye,e=i[9],de+=e*u,ge+=e*Pe,be+=e*_e,ue+=e*$e,he+=e*Ce,pe+=e*Ee,Z+=e*Ae,ae+=e*Le,Q+=e*Te,ee+=e*Ue,re+=e*Be,j+=e*We,S+=e*He,C+=e*je,N+=e*Ge,$+=e*Ye,e=i[10],ge+=e*u,be+=e*Pe,ue+=e*_e,he+=e*$e,pe+=e*Ce,Z+=e*Ee,ae+=e*Ae,Q+=e*Le,ee+=e*Te,re+=e*Ue,j+=e*Be,S+=e*We,C+=e*He,N+=e*je,$+=e*Ge,T+=e*Ye,e=i[11],be+=e*u,ue+=e*Pe,he+=e*_e,pe+=e*$e,Z+=e*Ce,ae+=e*Ee,Q+=e*Ae,ee+=e*Le,re+=e*Te,j+=e*Ue,S+=e*Be,C+=e*We,N+=e*He,$+=e*je,T+=e*Ge,U+=e*Ye,e=i[12],ue+=e*u,he+=e*Pe,pe+=e*_e,Z+=e*$e,ae+=e*Ce,Q+=e*Ee,ee+=e*Ae,re+=e*Le,j+=e*Te,S+=e*Ue,C+=e*Be,N+=e*We,$+=e*He,T+=e*je,U+=e*Ge,ce+=e*Ye,e=i[13],he+=e*u,pe+=e*Pe,Z+=e*_e,ae+=e*$e,Q+=e*Ce,ee+=e*Ee,re+=e*Ae,j+=e*Le,S+=e*Te,C+=e*Ue,N+=e*Be,$+=e*We,T+=e*He,U+=e*je,ce+=e*Ge,ye+=e*Ye,e=i[14],pe+=e*u,Z+=e*Pe,ae+=e*_e,Q+=e*$e,ee+=e*Ce,re+=e*Ee,j+=e*Ae,S+=e*Le,C+=e*Te,N+=e*Ue,$+=e*Be,T+=e*We,U+=e*He,ce+=e*je,ye+=e*Ge,ve+=e*Ye,e=i[15],Z+=e*u,ae+=e*Pe,Q+=e*_e,ee+=e*$e,re+=e*Ce,j+=e*Ee,S+=e*Ae,C+=e*Le,N+=e*Te,$+=e*Ue,T+=e*Be,U+=e*We,ce+=e*He,ye+=e*je,ve+=e*Ge,we+=e*Ye,m+=38*ae,b+=38*Q,I+=38*ee,O+=38*re,oe+=38*j,G+=38*S,Re+=38*C,q+=38*N,le+=38*$,de+=38*T,ge+=38*U,be+=38*ce,ue+=38*ye,he+=38*ve,pe+=38*we,c=1,e=m+c+65535,c=Math.floor(e/65536),m=e-c*65536,e=b+c+65535,c=Math.floor(e/65536),b=e-c*65536,e=I+c+65535,c=Math.floor(e/65536),I=e-c*65536,e=O+c+65535,c=Math.floor(e/65536),O=e-c*65536,e=oe+c+65535,c=Math.floor(e/65536),oe=e-c*65536,e=G+c+65535,c=Math.floor(e/65536),G=e-c*65536,e=Re+c+65535,c=Math.floor(e/65536),Re=e-c*65536,e=q+c+65535,c=Math.floor(e/65536),q=e-c*65536,e=le+c+65535,c=Math.floor(e/65536),le=e-c*65536,e=de+c+65535,c=Math.floor(e/65536),de=e-c*65536,e=ge+c+65535,c=Math.floor(e/65536),ge=e-c*65536,e=be+c+65535,c=Math.floor(e/65536),be=e-c*65536,e=ue+c+65535,c=Math.floor(e/65536),ue=e-c*65536,e=he+c+65535,c=Math.floor(e/65536),he=e-c*65536,e=pe+c+65535,c=Math.floor(e/65536),pe=e-c*65536,e=Z+c+65535,c=Math.floor(e/65536),Z=e-c*65536,m+=c-1+37*(c-1),c=1,e=m+c+65535,c=Math.floor(e/65536),m=e-c*65536,e=b+c+65535,c=Math.floor(e/65536),b=e-c*65536,e=I+c+65535,c=Math.floor(e/65536),I=e-c*65536,e=O+c+65535,c=Math.floor(e/65536),O=e-c*65536,e=oe+c+65535,c=Math.floor(e/65536),oe=e-c*65536,e=G+c+65535,c=Math.floor(e/65536),G=e-c*65536,e=Re+c+65535,c=Math.floor(e/65536),Re=e-c*65536,e=q+c+65535,c=Math.floor(e/65536),q=e-c*65536,e=le+c+65535,c=Math.floor(e/65536),le=e-c*65536,e=de+c+65535,c=Math.floor(e/65536),de=e-c*65536,e=ge+c+65535,c=Math.floor(e/65536),ge=e-c*65536,e=be+c+65535,c=Math.floor(e/65536),be=e-c*65536,e=ue+c+65535,c=Math.floor(e/65536),ue=e-c*65536,e=he+c+65535,c=Math.floor(e/65536),he=e-c*65536,e=pe+c+65535,c=Math.floor(e/65536),pe=e-c*65536,e=Z+c+65535,c=Math.floor(e/65536),Z=e-c*65536,m+=c-1+37*(c-1),o[0]=m,o[1]=b,o[2]=I,o[3]=O,o[4]=oe,o[5]=G,o[6]=Re,o[7]=q,o[8]=le,o[9]=de,o[10]=ge,o[11]=be,o[12]=ue,o[13]=he,o[14]=pe,o[15]=Z}f(ne,"M");function Fe(o,i){ne(o,i,i)}f(Fe,"S");function _t(o,i){var s=r(),e;for(e=0;e<16;e++)s[e]=i[e];for(e=253;e>=0;e--)Fe(s,s),e!==2&&e!==4&&ne(s,s,i);for(e=0;e<16;e++)o[e]=s[e]}f(_t,"inv25519");function $t(o,i){var s=r(),e;for(e=0;e<16;e++)s[e]=i[e];for(e=250;e>=0;e--)Fe(s,s),e!==1&&ne(s,s,i);for(e=0;e<16;e++)o[e]=s[e]}f($t,"pow2523");function ft(o,i,s){var e=new Uint8Array(32),c=new Float64Array(80),m,b,I=r(),O=r(),oe=r(),G=r(),Re=r(),q=r();for(b=0;b<31;b++)e[b]=i[b];for(e[31]=i[31]&127|64,e[0]&=248,me(c,s),b=0;b<16;b++)O[b]=c[b],G[b]=I[b]=oe[b]=0;for(I[0]=G[0]=1,b=254;b>=0;--b)m=e[b>>>3]>>>(b&7)&1,ie(I,O,m),ie(oe,G,m),xe(Re,I,oe),ke(I,I,oe),xe(oe,O,G),ke(O,O,G),Fe(G,Re),Fe(q,I),ne(I,oe,I),ne(oe,O,Re),xe(Re,I,oe),ke(I,I,oe),Fe(O,I),ke(oe,G,q),ne(I,oe,v),xe(I,I,G),ne(oe,oe,I),ne(I,G,q),ne(G,O,c),Fe(O,Re),ie(I,O,m),ie(oe,G,m);for(b=0;b<16;b++)c[b+16]=I[b],c[b+32]=oe[b],c[b+48]=O[b],c[b+64]=G[b];var le=c.subarray(32),de=c.subarray(16);return _t(le,le),ne(de,de,le),Se(o,de),0}f(ft,"crypto_scalarmult");function dt(o,i){return ft(o,i,l)}f(dt,"crypto_scalarmult_base");function rr(o,i){return a(i,32),dt(o,i)}f(rr,"crypto_box_keypair");function xt(o,i,s){var e=new Uint8Array(32);return ft(e,s,i),X(o,n,e,K)}f(xt,"crypto_box_beforenm");var Ht=P,io=F;function or(o,i,s,e,c,m){var b=new Uint8Array(32);return xt(b,c,m),Ht(o,i,s,e,b)}f(or,"crypto_box");function Oe(o,i,s,e,c,m){var b=new Uint8Array(32);return xt(b,c,m),io(o,i,s,e,b)}f(Oe,"crypto_box_open");var Ke=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function ze(o,i,s,e){for(var c=new Int32Array(16),m=new Int32Array(16),b,I,O,oe,G,Re,q,le,de,ge,be,ue,he,pe,Z,ae,Q,ee,re,j,S,C,N,$,T,U,ce=o[0],ye=o[1],ve=o[2],we=o[3],u=o[4],Pe=o[5],_e=o[6],$e=o[7],Ce=i[0],Ee=i[1],Ae=i[2],Le=i[3],Te=i[4],Ue=i[5],Be=i[6],We=i[7],He=0;e>=128;){for(re=0;re<16;re++)j=8*re+He,c[re]=s[j+0]<<24|s[j+1]<<16|s[j+2]<<8|s[j+3],m[re]=s[j+4]<<24|s[j+5]<<16|s[j+6]<<8|s[j+7];for(re=0;re<80;re++)if(b=ce,I=ye,O=ve,oe=we,G=u,Re=Pe,q=_e,le=$e,de=Ce,ge=Ee,be=Ae,ue=Le,he=Te,pe=Ue,Z=Be,ae=We,S=$e,C=We,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=(u>>>14|Te<<18)^(u>>>18|Te<<14)^(Te>>>9|u<<23),C=(Te>>>14|u<<18)^(Te>>>18|u<<14)^(u>>>9|Te<<23),N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,S=u&Pe^~u&_e,C=Te&Ue^~Te&Be,N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,S=Ke[re*2],C=Ke[re*2+1],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,S=c[re%16],C=m[re%16],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,Q=T&65535|U<<16,ee=N&65535|$<<16,S=Q,C=ee,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=(ce>>>28|Ce<<4)^(Ce>>>2|ce<<30)^(Ce>>>7|ce<<25),C=(Ce>>>28|ce<<4)^(ce>>>2|Ce<<30)^(ce>>>7|Ce<<25),N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,S=ce&ye^ce&ve^ye&ve,C=Ce&Ee^Ce&Ae^Ee&Ae,N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,le=T&65535|U<<16,ae=N&65535|$<<16,S=oe,C=ue,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=Q,C=ee,N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,oe=T&65535|U<<16,ue=N&65535|$<<16,ye=b,ve=I,we=O,u=oe,Pe=G,_e=Re,$e=q,ce=le,Ee=de,Ae=ge,Le=be,Te=ue,Ue=he,Be=pe,We=Z,Ce=ae,re%16===15)for(j=0;j<16;j++)S=c[j],C=m[j],N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=c[(j+9)%16],C=m[(j+9)%16],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,Q=c[(j+1)%16],ee=m[(j+1)%16],S=(Q>>>1|ee<<31)^(Q>>>8|ee<<24)^Q>>>7,C=(ee>>>1|Q<<31)^(ee>>>8|Q<<24)^(ee>>>7|Q<<25),N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,Q=c[(j+14)%16],ee=m[(j+14)%16],S=(Q>>>19|ee<<13)^(ee>>>29|Q<<3)^Q>>>6,C=(ee>>>19|Q<<13)^(Q>>>29|ee<<3)^(ee>>>6|Q<<26),N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,c[j]=T&65535|U<<16,m[j]=N&65535|$<<16;S=ce,C=Ce,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[0],C=i[0],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[0]=ce=T&65535|U<<16,i[0]=Ce=N&65535|$<<16,S=ye,C=Ee,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[1],C=i[1],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[1]=ye=T&65535|U<<16,i[1]=Ee=N&65535|$<<16,S=ve,C=Ae,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[2],C=i[2],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[2]=ve=T&65535|U<<16,i[2]=Ae=N&65535|$<<16,S=we,C=Le,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[3],C=i[3],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[3]=we=T&65535|U<<16,i[3]=Le=N&65535|$<<16,S=u,C=Te,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[4],C=i[4],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[4]=u=T&65535|U<<16,i[4]=Te=N&65535|$<<16,S=Pe,C=Ue,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[5],C=i[5],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[5]=Pe=T&65535|U<<16,i[5]=Ue=N&65535|$<<16,S=_e,C=Be,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[6],C=i[6],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[6]=_e=T&65535|U<<16,i[6]=Be=N&65535|$<<16,S=$e,C=We,N=C&65535,$=C>>>16,T=S&65535,U=S>>>16,S=o[7],C=i[7],N+=C&65535,$+=C>>>16,T+=S&65535,U+=S>>>16,$+=N>>>16,T+=$>>>16,U+=T>>>16,o[7]=$e=T&65535|U<<16,i[7]=We=N&65535|$<<16,He+=128,e-=128}return e}f(ze,"crypto_hashblocks_hl");function et(o,i,s){var e=new Int32Array(8),c=new Int32Array(8),m=new Uint8Array(256),b,I=s;for(e[0]=1779033703,e[1]=3144134277,e[2]=1013904242,e[3]=2773480762,e[4]=1359893119,e[5]=2600822924,e[6]=528734635,e[7]=1541459225,c[0]=4089235720,c[1]=2227873595,c[2]=4271175723,c[3]=1595750129,c[4]=2917565137,c[5]=725511199,c[6]=4215389547,c[7]=327033209,ze(e,c,i,s),s%=128,b=0;b<s;b++)m[b]=i[I-s+b];for(m[s]=128,s=256-128*(s<112?1:0),m[s-9]=0,k(m,s-8,I/536870912|0,I<<3),ze(e,c,m,s),b=0;b<8;b++)k(o,8*b,e[b],c[b]);return 0}f(et,"crypto_hash");function It(o,i){var s=r(),e=r(),c=r(),m=r(),b=r(),I=r(),O=r(),oe=r(),G=r();ke(s,o[1],o[0]),ke(G,i[1],i[0]),ne(s,s,G),xe(e,o[0],o[1]),xe(G,i[0],i[1]),ne(e,e,G),ne(c,o[3],i[3]),ne(c,c,g),ne(m,o[2],i[2]),xe(m,m,m),ke(b,e,s),ke(I,m,c),xe(O,m,c),xe(oe,e,s),ne(o[0],b,I),ne(o[1],oe,O),ne(o[2],O,I),ne(o[3],b,oe)}f(It,"add");function ar(o,i,s){var e;for(e=0;e<4;e++)ie(o[e],i[e],s)}f(ar,"cswap");function Kt(o,i){var s=r(),e=r(),c=r();_t(c,i[2]),ne(s,i[0],c),ne(e,i[1],c),Se(o,e),o[31]^=fe(s)<<7}f(Kt,"pack");function De(o,i,s){var e,c;for(Y(o[0],h),Y(o[1],d),Y(o[2],d),Y(o[3],h),c=255;c>=0;--c)e=s[c/8|0]>>(c&7)&1,ar(o,i,e),It(i,o),It(o,o),ar(o,i,e)}f(De,"scalarmult");function Ie(o,i){var s=[r(),r(),r(),r()];Y(s[0],y),Y(s[1],w),Y(s[2],d),ne(s[3],y,w),De(o,s,i)}f(Ie,"scalarbase");function st(o,i,s){var e=new Uint8Array(64),c=[r(),r(),r(),r()],m;for(s||a(i,32),et(e,i,32),e[0]&=248,e[31]&=127,e[31]|=64,Ie(c,e),Kt(o,c),m=0;m<32;m++)i[m+32]=o[m];return 0}f(st,"crypto_sign_keypair");var ot=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Ct(o,i){var s,e,c,m;for(e=63;e>=32;--e){for(s=0,c=e-32,m=e-12;c<m;++c)i[c]+=s-16*i[e]*ot[c-(e-32)],s=Math.floor((i[c]+128)/256),i[c]-=s*256;i[c]+=s,i[e]=0}for(s=0,c=0;c<32;c++)i[c]+=s-(i[31]>>4)*ot[c],s=i[c]>>8,i[c]&=255;for(c=0;c<32;c++)i[c]-=s*ot[c];for(e=0;e<32;e++)i[e+1]+=i[e]>>8,o[e]=i[e]&255}f(Ct,"modL");function Tt(o){var i=new Float64Array(64),s;for(s=0;s<64;s++)i[s]=o[s];for(s=0;s<64;s++)o[s]=0;Ct(o,i)}f(Tt,"reduce");function nr(o,i,s,e){var c=new Uint8Array(64),m=new Uint8Array(64),b=new Uint8Array(64),I,O,oe=new Float64Array(64),G=[r(),r(),r(),r()];et(c,e,32),c[0]&=248,c[31]&=127,c[31]|=64;var Re=s+64;for(I=0;I<s;I++)o[64+I]=i[I];for(I=0;I<32;I++)o[32+I]=c[32+I];for(et(b,o.subarray(32),s+32),Tt(b),Ie(G,b),Kt(o,G),I=32;I<64;I++)o[I]=e[I];for(et(m,o,s+64),Tt(m),I=0;I<64;I++)oe[I]=0;for(I=0;I<32;I++)oe[I]=b[I];for(I=0;I<32;I++)for(O=0;O<32;O++)oe[I+O]+=m[I]*c[O];return Ct(o.subarray(32),oe),Re}f(nr,"crypto_sign");function co(o,i){var s=r(),e=r(),c=r(),m=r(),b=r(),I=r(),O=r();return Y(o[2],d),me(o[1],i),Fe(c,o[1]),ne(m,c,p),ke(c,c,o[2]),xe(m,o[2],m),Fe(b,m),Fe(I,b),ne(O,I,b),ne(s,O,c),ne(s,s,m),$t(s,s),ne(s,s,c),ne(s,s,m),ne(s,s,m),ne(o[0],s,m),Fe(e,o[0]),ne(e,e,m),te(e,c)&&ne(o[0],o[0],_),Fe(e,o[0]),ne(e,e,m),te(e,c)?-1:(fe(o[0])===i[31]>>7&&ke(o[0],h,o[0]),ne(o[3],o[0],o[1]),0)}f(co,"unpackneg");function Rr(o,i,s,e){var c,m=new Uint8Array(32),b=new Uint8Array(64),I=[r(),r(),r(),r()],O=[r(),r(),r(),r()];if(s<64||co(O,e))return-1;for(c=0;c<s;c++)o[c]=i[c];for(c=0;c<32;c++)o[c+32]=e[c];if(et(b,o,s),Tt(b),De(I,O,b),Ie(O,i.subarray(32)),It(I,O),Kt(m,I),s-=64,V(i,0,m,0)){for(c=0;c<s;c++)o[c]=0;return-1}for(c=0;c<s;c++)o[c]=i[c+64];return s}f(Rr,"crypto_sign_open");var _r=32,sr=24,zt=32,Dt=16,Vt=32,ir=32,Jt=32,jt=32,$r=32,lo=sr,ua=zt,pa=Dt,ut=64,Pt=32,Nt=64,Ir=32,Tr=64;t.lowlevel={crypto_core_hsalsa20:X,crypto_stream_xor:E,crypto_stream:D,crypto_stream_salsa20_xor:x,crypto_stream_salsa20:A,crypto_onetimeauth:R,crypto_onetimeauth_verify:J,crypto_verify_16:z,crypto_verify_32:V,crypto_secretbox:P,crypto_secretbox_open:F,crypto_scalarmult:ft,crypto_scalarmult_base:dt,crypto_box_beforenm:xt,crypto_box_afternm:Ht,crypto_box:or,crypto_box_open:Oe,crypto_box_keypair:rr,crypto_hash:et,crypto_sign:nr,crypto_sign_keypair:st,crypto_sign_open:Rr,crypto_secretbox_KEYBYTES:_r,crypto_secretbox_NONCEBYTES:sr,crypto_secretbox_ZEROBYTES:zt,crypto_secretbox_BOXZEROBYTES:Dt,crypto_scalarmult_BYTES:Vt,crypto_scalarmult_SCALARBYTES:ir,crypto_box_PUBLICKEYBYTES:Jt,crypto_box_SECRETKEYBYTES:jt,crypto_box_BEFORENMBYTES:$r,crypto_box_NONCEBYTES:lo,crypto_box_ZEROBYTES:ua,crypto_box_BOXZEROBYTES:pa,crypto_sign_BYTES:ut,crypto_sign_PUBLICKEYBYTES:Pt,crypto_sign_SECRETKEYBYTES:Nt,crypto_sign_SEEDBYTES:Ir,crypto_hash_BYTES:Tr,gf:r,D:p,L:ot,pack25519:Se,unpack25519:me,M:ne,A:xe,S:Fe,Z:ke,pow2523:$t,add:It,set25519:Y,modL:Ct,scalarmult:De,scalarbase:Ie};function fo(o,i){if(o.length!==_r)throw new Error("bad key size");if(i.length!==sr)throw new Error("bad nonce size")}f(fo,"checkLengths");function ha(o,i){if(o.length!==Jt)throw new Error("bad public key size");if(i.length!==jt)throw new Error("bad secret key size")}f(ha,"checkBoxLengths");function tt(){for(var o=0;o<arguments.length;o++)if(!(arguments[o]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}f(tt,"checkArrayTypes");function uo(o){for(var i=0;i<o.length;i++)o[i]=0}f(uo,"cleanup"),t.randomBytes=function(o){var i=new Uint8Array(o);return a(i,o),i},t.secretbox=function(o,i,s){tt(o,i,s),fo(s,i);for(var e=new Uint8Array(zt+o.length),c=new Uint8Array(e.length),m=0;m<o.length;m++)e[m+zt]=o[m];return P(c,e,e.length,i,s),c.subarray(Dt)},t.secretbox.open=function(o,i,s){tt(o,i,s),fo(s,i);for(var e=new Uint8Array(Dt+o.length),c=new Uint8Array(e.length),m=0;m<o.length;m++)e[m+Dt]=o[m];return e.length<32||F(c,e,e.length,i,s)!==0?null:c.subarray(zt)},t.secretbox.keyLength=_r,t.secretbox.nonceLength=sr,t.secretbox.overheadLength=Dt,t.scalarMult=function(o,i){if(tt(o,i),o.length!==ir)throw new Error("bad n size");if(i.length!==Vt)throw new Error("bad p size");var s=new Uint8Array(Vt);return ft(s,o,i),s},t.scalarMult.base=function(o){if(tt(o),o.length!==ir)throw new Error("bad n size");var i=new Uint8Array(Vt);return dt(i,o),i},t.scalarMult.scalarLength=ir,t.scalarMult.groupElementLength=Vt,t.box=function(o,i,s,e){var c=t.box.before(s,e);return t.secretbox(o,i,c)},t.box.before=function(o,i){tt(o,i),ha(o,i);var s=new Uint8Array($r);return xt(s,o,i),s},t.box.after=t.secretbox,t.box.open=function(o,i,s,e){var c=t.box.before(s,e);return t.secretbox.open(o,i,c)},t.box.open.after=t.secretbox.open,t.box.keyPair=function(){var o=new Uint8Array(Jt),i=new Uint8Array(jt);return rr(o,i),{publicKey:o,secretKey:i}},t.box.keyPair.fromSecretKey=function(o){if(tt(o),o.length!==jt)throw new Error("bad secret key size");var i=new Uint8Array(Jt);return dt(i,o),{publicKey:i,secretKey:new Uint8Array(o)}},t.box.publicKeyLength=Jt,t.box.secretKeyLength=jt,t.box.sharedKeyLength=$r,t.box.nonceLength=lo,t.box.overheadLength=t.secretbox.overheadLength,t.sign=function(o,i){if(tt(o,i),i.length!==Nt)throw new Error("bad secret key size");var s=new Uint8Array(ut+o.length);return nr(s,o,o.length,i),s},t.sign.open=function(o,i){if(tt(o,i),i.length!==Pt)throw new Error("bad public key size");var s=new Uint8Array(o.length),e=Rr(s,o,o.length,i);if(e<0)return null;for(var c=new Uint8Array(e),m=0;m<c.length;m++)c[m]=s[m];return c},t.sign.detached=function(o,i){for(var s=t.sign(o,i),e=new Uint8Array(ut),c=0;c<e.length;c++)e[c]=s[c];return e},t.sign.detached.verify=function(o,i,s){if(tt(o,i,s),i.length!==ut)throw new Error("bad signature size");if(s.length!==Pt)throw new Error("bad public key size");var e=new Uint8Array(ut+o.length),c=new Uint8Array(ut+o.length),m;for(m=0;m<ut;m++)e[m]=i[m];for(m=0;m<o.length;m++)e[m+ut]=o[m];return Rr(c,e,e.length,s)>=0},t.sign.keyPair=function(){var o=new Uint8Array(Pt),i=new Uint8Array(Nt);return st(o,i),{publicKey:o,secretKey:i}},t.sign.keyPair.fromSecretKey=function(o){if(tt(o),o.length!==Nt)throw new Error("bad secret key size");for(var i=new Uint8Array(Pt),s=0;s<i.length;s++)i[s]=o[32+s];return{publicKey:i,secretKey:new Uint8Array(o)}},t.sign.keyPair.fromSeed=function(o){if(tt(o),o.length!==Ir)throw new Error("bad seed size");for(var i=new Uint8Array(Pt),s=new Uint8Array(Nt),e=0;e<32;e++)s[e]=o[e];return st(i,s,!0),{publicKey:i,secretKey:s}},t.sign.publicKeyLength=Pt,t.sign.secretKeyLength=Nt,t.sign.seedLength=Ir,t.sign.signatureLength=ut,t.hash=function(o){tt(o);var i=new Uint8Array(Tr);return et(i,o,o.length),i},t.hash.hashLength=Tr,t.verify=function(o,i){return tt(o,i),o.length===0||i.length===0||o.length!==i.length?!1:M(o,0,i,0,o.length)===0},t.setPRNG=function(o){a=o},function(){var o=typeof self<"u"?self.crypto||self.msCrypto:null;if(o&&o.getRandomValues){var i=65536;t.setPRNG((function(s,e){var c,m=new Uint8Array(e);for(c=0;c<e;c+=i)o.getRandomValues(m.subarray(c,c+Math.min(e-c,i)));for(c=0;c<e;c++)s[c]=m[c];uo(m)}))}else typeof po<"u"&&(o=Yr(),o&&o.randomBytes&&t.setPRNG((function(s,e){var c,m=o.randomBytes(e);for(c=0;c<e;c++)s[c]=m[c];uo(m)})))}()})(typeof wr<"u"&&wr.exports?wr.exports:self.nacl=self.nacl||{})}));var zo=cr((()=>{}));var Vo=cr(((Ec,Ar)=>{(function(){"use strict";var t="input is invalid type",r=typeof window=="object",a=r?window:{};a.JS_SHA256_NO_WINDOW&&(r=!1);var n=!r&&typeof self=="object",l=!a.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;l?a=global:n&&(a=self);var h=!a.JS_SHA256_NO_COMMON_JS&&typeof Ar=="object"&&Ar.exports,d=typeof define=="function"&&define.amd,v=!a.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",p="0123456789abcdef".split(""),g=[-2147483648,8388608,32768,128],y=[24,16,8,0],w=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],_=["hex","array","digest","arrayBuffer"],k=[];(a.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}),v&&(a.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(x){return typeof x=="object"&&x.buffer&&x.buffer.constructor===ArrayBuffer});var M=f((function(x,A){return function(D){return new H(A,!0).update(D)[x]()}}),"createOutputMethod"),z=f((function(x){var A=M("hex",x);l&&(A=V(A,x)),A.create=function(){return new H(x)},A.update=function(L){return A.create().update(L)};for(var D=0;D<_.length;++D){var E=_[D];A[E]=M(E,x)}return A}),"createMethod"),V=f((function(x,A){var D=Yr(),E=zo().Buffer,L=A?"sha224":"sha256",R;E.from&&!a.JS_SHA256_NO_BUFFER_FROM?R=E.from:R=f((function(P){return new E(P)}),"bufferFrom");var J=f((function(P){if(typeof P=="string")return D.createHash(L).update(P,"utf8").digest("hex");if(P==null)throw new Error(t);return P.constructor===ArrayBuffer&&(P=new Uint8Array(P)),Array.isArray(P)||ArrayBuffer.isView(P)||P.constructor===E?D.createHash(L).update(R(P)).digest("hex"):x(P)}),"nodeMethod");return J}),"nodeWrap"),W=f((function(x,A){return function(D,E){return new X(D,A,!0).update(E)[x]()}}),"createHmacOutputMethod"),B=f((function(x){var A=W("hex",x);A.create=function(L){return new X(L,x)},A.update=function(L,R){return A.create(L).update(R)};for(var D=0;D<_.length;++D){var E=_[D];A[E]=W(E,x)}return A}),"createHmacMethod");function H(x,A){A?(k[0]=k[16]=k[1]=k[2]=k[3]=k[4]=k[5]=k[6]=k[7]=k[8]=k[9]=k[10]=k[11]=k[12]=k[13]=k[14]=k[15]=0,this.blocks=k):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=x}f(H,"Sha256"),H.prototype.update=function(x){if(!this.finalized){var A,D=typeof x;if(D!=="string"){if(D==="object"){if(x===null)throw new Error(t);if(v&&x.constructor===ArrayBuffer)x=new Uint8Array(x);else if(!Array.isArray(x)&&(!v||!ArrayBuffer.isView(x)))throw new Error(t)}else throw new Error(t);A=!0}for(var E,L=0,R,J=x.length,P=this.blocks;L<J;){if(this.hashed&&(this.hashed=!1,P[0]=this.block,this.block=P[16]=P[1]=P[2]=P[3]=P[4]=P[5]=P[6]=P[7]=P[8]=P[9]=P[10]=P[11]=P[12]=P[13]=P[14]=P[15]=0),A)for(R=this.start;L<J&&R<64;++L)P[R>>>2]|=x[L]<<y[R++&3];else for(R=this.start;L<J&&R<64;++L)E=x.charCodeAt(L),E<128?P[R>>>2]|=E<<y[R++&3]:E<2048?(P[R>>>2]|=(192|E>>>6)<<y[R++&3],P[R>>>2]|=(128|E&63)<<y[R++&3]):E<55296||E>=57344?(P[R>>>2]|=(224|E>>>12)<<y[R++&3],P[R>>>2]|=(128|E>>>6&63)<<y[R++&3],P[R>>>2]|=(128|E&63)<<y[R++&3]):(E=65536+((E&1023)<<10|x.charCodeAt(++L)&1023),P[R>>>2]|=(240|E>>>18)<<y[R++&3],P[R>>>2]|=(128|E>>>12&63)<<y[R++&3],P[R>>>2]|=(128|E>>>6&63)<<y[R++&3],P[R>>>2]|=(128|E&63)<<y[R++&3]);this.lastByteIndex=R,this.bytes+=R-this.start,R>=64?(this.block=P[16],this.start=R-64,this.hash(),this.hashed=!0):this.start=R}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},H.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var x=this.blocks,A=this.lastByteIndex;x[16]=this.block,x[A>>>2]|=g[A&3],this.block=x[16],A>=56&&(this.hashed||this.hash(),x[0]=this.block,x[16]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=x[8]=x[9]=x[10]=x[11]=x[12]=x[13]=x[14]=x[15]=0),x[14]=this.hBytes<<3|this.bytes>>>29,x[15]=this.bytes<<3,this.hash()}},H.prototype.hash=function(){var x=this.h0,A=this.h1,D=this.h2,E=this.h3,L=this.h4,R=this.h5,J=this.h6,P=this.h7,F=this.blocks,Y,se,ie,Se,te,fe,me,xe,ke,ne,Fe;for(Y=16;Y<64;++Y)te=F[Y-15],se=(te>>>7|te<<25)^(te>>>18|te<<14)^te>>>3,te=F[Y-2],ie=(te>>>17|te<<15)^(te>>>19|te<<13)^te>>>10,F[Y]=F[Y-16]+se+F[Y-7]+ie<<0;for(Fe=A&D,Y=0;Y<64;Y+=4)this.first?(this.is224?(xe=300032,te=F[0]-1413257819,P=te-150054599<<0,E=te+24177077<<0):(xe=704751109,te=F[0]-210244248,P=te-1521486534<<0,E=te+143694565<<0),this.first=!1):(se=(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10),ie=(L>>>6|L<<26)^(L>>>11|L<<21)^(L>>>25|L<<7),xe=x&A,Se=xe^x&D^Fe,me=L&R^~L&J,te=P+ie+me+w[Y]+F[Y],fe=se+Se,P=E+te<<0,E=te+fe<<0),se=(E>>>2|E<<30)^(E>>>13|E<<19)^(E>>>22|E<<10),ie=(P>>>6|P<<26)^(P>>>11|P<<21)^(P>>>25|P<<7),ke=E&x,Se=ke^E&A^xe,me=P&L^~P&R,te=J+ie+me+w[Y+1]+F[Y+1],fe=se+Se,J=D+te<<0,D=te+fe<<0,se=(D>>>2|D<<30)^(D>>>13|D<<19)^(D>>>22|D<<10),ie=(J>>>6|J<<26)^(J>>>11|J<<21)^(J>>>25|J<<7),ne=D&E,Se=ne^D&x^ke,me=J&P^~J&L,te=R+ie+me+w[Y+2]+F[Y+2],fe=se+Se,R=A+te<<0,A=te+fe<<0,se=(A>>>2|A<<30)^(A>>>13|A<<19)^(A>>>22|A<<10),ie=(R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7),Fe=A&D,Se=Fe^A&E^ne,me=R&J^~R&P,te=L+ie+me+w[Y+3]+F[Y+3],fe=se+Se,L=x+te<<0,x=te+fe<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+x<<0,this.h1=this.h1+A<<0,this.h2=this.h2+D<<0,this.h3=this.h3+E<<0,this.h4=this.h4+L<<0,this.h5=this.h5+R<<0,this.h6=this.h6+J<<0,this.h7=this.h7+P<<0},H.prototype.hex=function(){this.finalize();var x=this.h0,A=this.h1,D=this.h2,E=this.h3,L=this.h4,R=this.h5,J=this.h6,P=this.h7,F=p[x>>>28&15]+p[x>>>24&15]+p[x>>>20&15]+p[x>>>16&15]+p[x>>>12&15]+p[x>>>8&15]+p[x>>>4&15]+p[x&15]+p[A>>>28&15]+p[A>>>24&15]+p[A>>>20&15]+p[A>>>16&15]+p[A>>>12&15]+p[A>>>8&15]+p[A>>>4&15]+p[A&15]+p[D>>>28&15]+p[D>>>24&15]+p[D>>>20&15]+p[D>>>16&15]+p[D>>>12&15]+p[D>>>8&15]+p[D>>>4&15]+p[D&15]+p[E>>>28&15]+p[E>>>24&15]+p[E>>>20&15]+p[E>>>16&15]+p[E>>>12&15]+p[E>>>8&15]+p[E>>>4&15]+p[E&15]+p[L>>>28&15]+p[L>>>24&15]+p[L>>>20&15]+p[L>>>16&15]+p[L>>>12&15]+p[L>>>8&15]+p[L>>>4&15]+p[L&15]+p[R>>>28&15]+p[R>>>24&15]+p[R>>>20&15]+p[R>>>16&15]+p[R>>>12&15]+p[R>>>8&15]+p[R>>>4&15]+p[R&15]+p[J>>>28&15]+p[J>>>24&15]+p[J>>>20&15]+p[J>>>16&15]+p[J>>>12&15]+p[J>>>8&15]+p[J>>>4&15]+p[J&15];return this.is224||(F+=p[P>>>28&15]+p[P>>>24&15]+p[P>>>20&15]+p[P>>>16&15]+p[P>>>12&15]+p[P>>>8&15]+p[P>>>4&15]+p[P&15]),F},H.prototype.toString=H.prototype.hex,H.prototype.digest=function(){this.finalize();var x=this.h0,A=this.h1,D=this.h2,E=this.h3,L=this.h4,R=this.h5,J=this.h6,P=this.h7,F=[x>>>24&255,x>>>16&255,x>>>8&255,x&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255,D>>>24&255,D>>>16&255,D>>>8&255,D&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255,R>>>24&255,R>>>16&255,R>>>8&255,R&255,J>>>24&255,J>>>16&255,J>>>8&255,J&255];return this.is224||F.push(P>>>24&255,P>>>16&255,P>>>8&255,P&255),F},H.prototype.array=H.prototype.digest,H.prototype.arrayBuffer=function(){this.finalize();var x=new ArrayBuffer(this.is224?28:32),A=new DataView(x);return A.setUint32(0,this.h0),A.setUint32(4,this.h1),A.setUint32(8,this.h2),A.setUint32(12,this.h3),A.setUint32(16,this.h4),A.setUint32(20,this.h5),A.setUint32(24,this.h6),this.is224||A.setUint32(28,this.h7),x};function X(x,A,D){var E,L=typeof x;if(L==="string"){var R=[],J=x.length,P=0,F;for(E=0;E<J;++E)F=x.charCodeAt(E),F<128?R[P++]=F:F<2048?(R[P++]=192|F>>>6,R[P++]=128|F&63):F<55296||F>=57344?(R[P++]=224|F>>>12,R[P++]=128|F>>>6&63,R[P++]=128|F&63):(F=65536+((F&1023)<<10|x.charCodeAt(++E)&1023),R[P++]=240|F>>>18,R[P++]=128|F>>>12&63,R[P++]=128|F>>>6&63,R[P++]=128|F&63);x=R}else if(L==="object"){if(x===null)throw new Error(t);if(v&&x.constructor===ArrayBuffer)x=new Uint8Array(x);else if(!Array.isArray(x)&&(!v||!ArrayBuffer.isView(x)))throw new Error(t)}else throw new Error(t);x.length>64&&(x=new H(A,!0).update(x).array());var Y=[],se=[];for(E=0;E<64;++E){var ie=x[E]||0;Y[E]=92^ie,se[E]=54^ie}H.call(this,A,D),this.update(se),this.oKeyPad=Y,this.inner=!0,this.sharedMemory=D}f(X,"HmacSha256"),X.prototype=new H,X.prototype.finalize=function(){if(H.prototype.finalize.call(this),this.inner){this.inner=!1;var x=this.array();H.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(x),H.prototype.finalize.call(this)}};var K=z();K.sha256=K,K.sha224=z(!0),K.sha256.hmac=B(),K.sha224.hmac=B(!0),h?Ar.exports=K:(a.sha256=K.sha256,a.sha224=K.sha224,d&&define((function(){return K})))})()}));var bt=crypto,lr=f((t=>t instanceof CryptoKey),"isCryptoKey");var qe=new TextEncoder,at=new TextDecoder,vn=2**32;function fr(...t){let r=t.reduce(((l,{length:h})=>l+h),0),a=new Uint8Array(r),n=0;for(let l of t)a.set(l,n),n+=l.length;return a}f(fr,"concat");var va=f((t=>{let r=t;typeof r=="string"&&(r=qe.encode(r));let a=32768,n=[];for(let l=0;l<r.length;l+=a)n.push(String.fromCharCode.apply(null,r.subarray(l,l+a)));return btoa(n.join(""))}),"encodeBase64"),dr=f((t=>va(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")),"encode"),Sa=f((t=>{let r=atob(t),a=new Uint8Array(r.length);for(let n=0;n<r.length;n++)a[n]=r.charCodeAt(n);return a}),"decodeBase64"),it=f((t=>{let r=t;r instanceof Uint8Array&&(r=at.decode(r)),r=r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Sa(r)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}),"decode");var Ve=class extends Error{static{f(this,"JOSEError")}constructor(r,a){super(r,a),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}};Ve.code="ERR_JOSE_GENERIC";var Ze=class extends Ve{static{f(this,"JWTClaimValidationFailed")}constructor(r,a,n="unspecified",l="unspecified"){super(r,{cause:{claim:n,reason:l,payload:a}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=l,this.payload=a}};Ze.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var Mt=class extends Ve{static{f(this,"JWTExpired")}constructor(r,a,n="unspecified",l="unspecified"){super(r,{cause:{claim:n,reason:l,payload:a}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=l,this.payload=a}};Mt.code="ERR_JWT_EXPIRED";var Gt=class extends Ve{static{f(this,"JOSEAlgNotAllowed")}constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}};Gt.code="ERR_JOSE_ALG_NOT_ALLOWED";var Xe=class extends Ve{static{f(this,"JOSENotSupported")}constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}};Xe.code="ERR_JOSE_NOT_SUPPORTED";var Mr=class extends Ve{static{f(this,"JWEDecryptionFailed")}constructor(r="decryption operation failed",a){super(r,a),this.code="ERR_JWE_DECRYPTION_FAILED"}};Mr.code="ERR_JWE_DECRYPTION_FAILED";var Fr=class extends Ve{static{f(this,"JWEInvalid")}constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}};Fr.code="ERR_JWE_INVALID";var Ne=class extends Ve{static{f(this,"JWSInvalid")}constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}};Ne.code="ERR_JWS_INVALID";var pt=class extends Ve{static{f(this,"JWTInvalid")}constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}};pt.code="ERR_JWT_INVALID";var Ur=class extends Ve{static{f(this,"JWKInvalid")}constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}};Ur.code="ERR_JWK_INVALID";var Br=class extends Ve{static{f(this,"JWKSInvalid")}constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}};Br.code="ERR_JWKS_INVALID";var Wr=class extends Ve{static{f(this,"JWKSNoMatchingKey")}constructor(r="no applicable key found in the JSON Web Key Set",a){super(r,a),this.code="ERR_JWKS_NO_MATCHING_KEY"}};Wr.code="ERR_JWKS_NO_MATCHING_KEY";var Lr=class extends Ve{static{f(this,"JWKSMultipleMatchingKeys")}constructor(r="multiple matching keys found in the JSON Web Key Set",a){super(r,a),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}};Lr.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var Or=class extends Ve{static{f(this,"JWKSTimeout")}constructor(r="request timed out",a){super(r,a),this.code="ERR_JWKS_TIMEOUT"}};Or.code="ERR_JWKS_TIMEOUT";var Yt=class extends Ve{static{f(this,"JWSSignatureVerificationFailed")}constructor(r="signature verification failed",a){super(r,a),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};Yt.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function ct(t,r="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${r} must be ${t}`)}f(ct,"unusable");function Xt(t,r){return t.name===r}f(Xt,"isAlgorithm");function Hr(t){return parseInt(t.name.slice(4),10)}f(Hr,"getHashLength");function Pa(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}f(Pa,"getNamedCurve");function Ea(t,r){if(r.length&&!r.some((a=>t.usages.includes(a)))){let a="CryptoKey does not support this operation, its usages must include ";if(r.length>2){let n=r.pop();a+=`one of ${r.join(", ")}, or ${n}.`}else r.length===2?a+=`one of ${r[0]} or ${r[1]}.`:a+=`${r[0]}.`;throw new TypeError(a)}}f(Ea,"checkUsage");function ho(t,r,...a){switch(r){case"HS256":case"HS384":case"HS512":{if(!Xt(t.algorithm,"HMAC"))throw ct("HMAC");let n=parseInt(r.slice(2),10);if(Hr(t.algorithm.hash)!==n)throw ct(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Xt(t.algorithm,"RSASSA-PKCS1-v1_5"))throw ct("RSASSA-PKCS1-v1_5");let n=parseInt(r.slice(2),10);if(Hr(t.algorithm.hash)!==n)throw ct(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Xt(t.algorithm,"RSA-PSS"))throw ct("RSA-PSS");let n=parseInt(r.slice(2),10);if(Hr(t.algorithm.hash)!==n)throw ct(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw ct("Ed25519 or Ed448");break}case"Ed25519":{if(!Xt(t.algorithm,"Ed25519"))throw ct("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Xt(t.algorithm,"ECDSA"))throw ct("ECDSA");let n=Pa(r);if(t.algorithm.namedCurve!==n)throw ct(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ea(t,a)}f(ho,"checkSigCryptoKey");function mo(t,r,...a){if(a=a.filter(Boolean),a.length>2){let n=a.pop();t+=`one of type ${a.join(", ")}, or ${n}.`}else a.length===2?t+=`one of type ${a[0]} or ${a[1]}.`:t+=`of type ${a[0]}.`;return r==null?t+=` Received ${r}`:typeof r=="function"&&r.name?t+=` Received function ${r.name}`:typeof r=="object"&&r!=null&&r.constructor?.name&&(t+=` Received an instance of ${r.constructor.name}`),t}f(mo,"message");var Kr=f(((t,...r)=>mo("Key must be ",t,...r)),"default");function zr(t,r,...a){return mo(`Key for the ${t} algorithm must be `,r,...a)}f(zr,"withAlg");var Vr=f((t=>lr(t)?!0:t?.[Symbol.toStringTag]==="KeyObject"),"default"),Ft=["CryptoKey"];var Aa=f(((...t)=>{let r=t.filter(Boolean);if(r.length===0||r.length===1)return!0;let a;for(let n of r){let l=Object.keys(n);if(!a||a.size===0){a=new Set(l);continue}for(let h of l){if(a.has(h))return!1;a.add(h)}}return!0}),"isDisjoint"),ur=Aa;function ka(t){return typeof t=="object"&&t!==null}f(ka,"isObjectLike");function rt(t){if(!ka(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let r=t;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(t)===r}f(rt,"isObject");var pr=f(((t,r)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:a}=r.algorithm;if(typeof a!="number"||a<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}}),"default");function ht(t){return rt(t)&&typeof t.kty=="string"}f(ht,"isJWK");function xo(t){return t.kty!=="oct"&&typeof t.d=="string"}f(xo,"isPrivateJWK");function bo(t){return t.kty!=="oct"&&typeof t.d>"u"}f(bo,"isPublicJWK");function go(t){return ht(t)&&t.kty==="oct"&&typeof t.k=="string"}f(go,"isSecretJWK");function _a(t){let r,a;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},a=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},a=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},a=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":r={name:"ECDSA",namedCurve:"P-256"},a=t.d?["sign"]:["verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},a=t.d?["sign"]:["verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},a=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:"ECDH",namedCurve:t.crv},a=t.d?["deriveBits"]:[];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":r={name:"Ed25519"},a=t.d?["sign"]:["verify"];break;case"EdDSA":r={name:t.crv},a=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:t.crv},a=t.d?["deriveBits"]:[];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Xe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:r,keyUsages:a}}f(_a,"subtleMapping");var $a=f((async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:a}=_a(t),n=[r,t.ext??!1,t.key_ops??a],l={...t};return delete l.alg,delete l.use,bt.subtle.importKey("jwk",l,...n)}),"parse"),hr=$a;var yo=f((t=>it(t)),"exportKeyValue"),Ut,Bt,wo=f((t=>t?.[Symbol.toStringTag]==="KeyObject"),"isKeyObject"),mr=f((async(t,r,a,n,l=!1)=>{let h=t.get(r);if(h?.[n])return h[n];let d=await hr({...a,alg:n});return l&&Object.freeze(r),h?h[n]=d:t.set(r,{[n]:d}),d}),"importAndCache"),Ia=f(((t,r)=>{if(wo(t)){let a=t.export({format:"jwk"});return delete a.d,delete a.dp,delete a.dq,delete a.p,delete a.q,delete a.qi,a.k?yo(a.k):(Bt||(Bt=new WeakMap),mr(Bt,t,a,r))}return ht(t)?t.k?it(t.k):(Bt||(Bt=new WeakMap),mr(Bt,t,t,r,!0)):t}),"normalizePublicKey"),Ta=f(((t,r)=>{if(wo(t)){let a=t.export({format:"jwk"});return a.k?yo(a.k):(Ut||(Ut=new WeakMap),mr(Ut,t,a,r))}return ht(t)?t.k?it(t.k):(Ut||(Ut=new WeakMap),mr(Ut,t,t,r,!0)):t}),"normalizePrivateKey"),Jr={normalizePublicKey:Ia,normalizePrivateKey:Ta};async function vo(t,r){if(!rt(t))throw new TypeError("JWK must be an object");switch(r||(r=t.alg),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return it(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new Xe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return hr({...t,alg:r});default:throw new Xe('Unsupported "kty" (Key Type) Parameter value')}}f(vo,"importJWK");var Wt=f((t=>t?.[Symbol.toStringTag]),"tag"),jr=f(((t,r,a)=>{if(r.use!==void 0&&r.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(r.key_ops!==void 0&&r.key_ops.includes?.(a)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${a}`);if(r.alg!==void 0&&r.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0}),"jwkMatchesOp"),Da=f(((t,r,a,n)=>{if(!(r instanceof Uint8Array)){if(n&&ht(r)){if(go(r)&&jr(t,r,a))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Vr(r))throw new TypeError(zr(t,r,...Ft,"Uint8Array",n?"JSON Web Key":null));if(r.type!=="secret")throw new TypeError(`${Wt(r)} instances for symmetric algorithms must be of type "secret"`)}}),"symmetricTypeCheck"),Na=f(((t,r,a,n)=>{if(n&&ht(r))switch(a){case"sign":if(xo(r)&&jr(t,r,a))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(bo(r)&&jr(t,r,a))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Vr(r))throw new TypeError(zr(t,r,...Ft,n?"JSON Web Key":null));if(r.type==="secret")throw new TypeError(`${Wt(r)} instances for asymmetric algorithms must not be of type "secret"`);if(a==="sign"&&r.type==="public")throw new TypeError(`${Wt(r)} instances for asymmetric algorithm signing must be of type "private"`);if(a==="decrypt"&&r.type==="public")throw new TypeError(`${Wt(r)} instances for asymmetric algorithm decryption must be of type "private"`);if(r.algorithm&&a==="verify"&&r.type==="private")throw new TypeError(`${Wt(r)} instances for asymmetric algorithm verifying must be of type "public"`);if(r.algorithm&&a==="encrypt"&&r.type==="private")throw new TypeError(`${Wt(r)} instances for asymmetric algorithm encryption must be of type "public"`)}),"asymmetricTypeCheck");function So(t,r,a,n){r.startsWith("HS")||r==="dir"||r.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(r)?Da(r,a,n,t):Na(r,a,n,t)}f(So,"checkKeyType");var ss=So.bind(void 0,!1),Qt=So.bind(void 0,!0);function Ma(t,r,a,n,l){if(l.crit!==void 0&&n?.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some((d=>typeof d!="string"||d.length===0)))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let h;a!==void 0?h=new Map([...Object.entries(a),...r.entries()]):h=r;for(let d of n.crit){if(!h.has(d))throw new Xe(`Extension Header Parameter "${d}" is not recognized`);if(l[d]===void 0)throw new t(`Extension Header Parameter "${d}" is missing`);if(h.get(d)&&n[d]===void 0)throw new t(`Extension Header Parameter "${d}" MUST be integrity protected`)}return new Set(n.crit)}f(Ma,"validateCrit");var xr=Ma;var Fa=f(((t,r)=>{if(r!==void 0&&(!Array.isArray(r)||r.some((a=>typeof a!="string"))))throw new TypeError(`"${t}" option must be an array of strings`);if(r)return new Set(r)}),"validateAlgorithms"),Co=Fa;function qt(t,r){let a=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:a,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:a,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:a,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:a,name:"ECDSA",namedCurve:r.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:r.name};default:throw new Xe(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}f(qt,"subtleDsa");async function Zt(t,r,a){if(a==="sign"&&(r=await Jr.normalizePrivateKey(r,t)),a==="verify"&&(r=await Jr.normalizePublicKey(r,t)),lr(r))return ho(r,t,a),r;if(r instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Kr(r,...Ft));return bt.subtle.importKey("raw",r,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[a])}throw new TypeError(Kr(r,...Ft,"Uint8Array","JSON Web Key"))}f(Zt,"getCryptoKey");var Ua=f((async(t,r,a,n)=>{let l=await Zt(t,r,"verify");pr(t,l);let h=qt(t,l.algorithm);try{return await bt.subtle.verify(h,l,a,n)}catch{return!1}}),"verify"),Po=Ua;async function Eo(t,r,a){if(!rt(t))throw new Ne("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new Ne('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new Ne("JWS Protected Header incorrect type");if(t.payload===void 0)throw new Ne("JWS Payload missing");if(typeof t.signature!="string")throw new Ne("JWS Signature missing or incorrect type");if(t.header!==void 0&&!rt(t.header))throw new Ne("JWS Unprotected Header incorrect type");let n={};if(t.protected)try{let z=it(t.protected);n=JSON.parse(at.decode(z))}catch{throw new Ne("JWS Protected Header is invalid")}if(!ur(n,t.header))throw new Ne("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let l={...n,...t.header},h=xr(Ne,new Map([["b64",!0]]),a?.crit,n,l),d=!0;if(h.has("b64")&&(d=n.b64,typeof d!="boolean"))throw new Ne('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:v}=l;if(typeof v!="string"||!v)throw new Ne('JWS "alg" (Algorithm) Header Parameter missing or invalid');let p=a&&Co("algorithms",a.algorithms);if(p&&!p.has(v))throw new Gt('"alg" (Algorithm) Header Parameter value not allowed');if(d){if(typeof t.payload!="string")throw new Ne("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new Ne("JWS Payload must be a string or an Uint8Array instance");let g=!1;typeof r=="function"?(r=await r(n,t),g=!0,Qt(v,r,"verify"),ht(r)&&(r=await vo(r,v))):Qt(v,r,"verify");let y=fr(qe.encode(t.protected??""),qe.encode("."),typeof t.payload=="string"?qe.encode(t.payload):t.payload),w;try{w=it(t.signature)}catch{throw new Ne("Failed to base64url decode the signature")}if(!await Po(v,r,w,y))throw new Yt;let k;if(d)try{k=it(t.payload)}catch{throw new Ne("Failed to base64url decode the payload")}else typeof t.payload=="string"?k=qe.encode(t.payload):k=t.payload;let M={payload:k};return t.protected!==void 0&&(M.protectedHeader=n),t.header!==void 0&&(M.unprotectedHeader=t.header),g?{...M,key:r}:M}f(Eo,"flattenedVerify");async function Ao(t,r,a){if(t instanceof Uint8Array&&(t=at.decode(t)),typeof t!="string")throw new Ne("Compact JWS must be a string or Uint8Array");let{0:n,1:l,2:h,length:d}=t.split(".");if(d!==3)throw new Ne("Invalid Compact JWS");let v=await Eo({payload:l,protected:n,signature:h},r,a),p={payload:v.payload,protectedHeader:v.protectedHeader};return typeof r=="function"?{...p,key:v.key}:p}f(Ao,"compactVerify");var lt=f((t=>Math.floor(t.getTime()/1e3)),"default");var Ba=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Et=f((t=>{let r=Ba.exec(t);if(!r||r[4]&&r[1])throw new TypeError("Invalid time period format");let a=parseFloat(r[2]),n=r[3].toLowerCase(),l;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":l=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":l=Math.round(a*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":l=Math.round(a*3600);break;case"day":case"days":case"d":l=Math.round(a*86400);break;case"week":case"weeks":case"w":l=Math.round(a*604800);break;default:l=Math.round(a*31557600);break}return r[1]==="-"||r[4]==="ago"?-l:l}),"default");var ko=f((t=>t.toLowerCase().replace(/^application\//,"")),"normalizeTyp"),Wa=f(((t,r)=>typeof t=="string"?r.includes(t):Array.isArray(t)?r.some(Set.prototype.has.bind(new Set(t))):!1),"checkAudiencePresence"),Ro=f(((t,r,a={})=>{let n;try{n=JSON.parse(at.decode(r))}catch{}if(!rt(n))throw new pt("JWT Claims Set must be a top-level JSON object");let{typ:l}=a;if(l&&(typeof t.typ!="string"||ko(t.typ)!==ko(l)))throw new Ze('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:h=[],issuer:d,subject:v,audience:p,maxTokenAge:g}=a,y=[...h];g!==void 0&&y.push("iat"),p!==void 0&&y.push("aud"),v!==void 0&&y.push("sub"),d!==void 0&&y.push("iss");for(let M of new Set(y.reverse()))if(!(M in n))throw new Ze(`missing required "${M}" claim`,n,M,"missing");if(d&&!(Array.isArray(d)?d:[d]).includes(n.iss))throw new Ze('unexpected "iss" claim value',n,"iss","check_failed");if(v&&n.sub!==v)throw new Ze('unexpected "sub" claim value',n,"sub","check_failed");if(p&&!Wa(n.aud,typeof p=="string"?[p]:p))throw new Ze('unexpected "aud" claim value',n,"aud","check_failed");let w;switch(typeof a.clockTolerance){case"string":w=Et(a.clockTolerance);break;case"number":w=a.clockTolerance;break;case"undefined":w=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:_}=a,k=lt(_||new Date);if((n.iat!==void 0||g)&&typeof n.iat!="number")throw new Ze('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new Ze('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>k+w)throw new Ze('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new Ze('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=k-w)throw new Mt('"exp" claim timestamp check failed',n,"exp","check_failed")}if(g){let M=k-n.iat,z=typeof g=="number"?g:Et(g);if(M-w>z)throw new Mt('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(M<0-w)throw new Ze('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}),"default");async function Gr(t,r,a){let n=await Ao(t,r,a);if(n.protectedHeader.crit?.includes("b64")&&n.protectedHeader.b64===!1)throw new pt("JWTs MUST NOT use unencoded payload");let h={payload:Ro(n.protectedHeader,n.payload,a),protectedHeader:n.protectedHeader};return typeof r=="function"?{...h,key:n.key}:h}f(Gr,"jwtVerify");var La=f((async(t,r,a)=>{let n=await Zt(t,r,"sign");pr(t,n);let l=await bt.subtle.sign(qt(t,n.algorithm),n,a);return new Uint8Array(l)}),"sign"),_o=La;var br=class{static{f(this,"FlattenedSign")}constructor(r){if(!(r instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=r}setProtectedHeader(r){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=r,this}setUnprotectedHeader(r){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=r,this}async sign(r,a){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Ne("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ur(this._protectedHeader,this._unprotectedHeader))throw new Ne("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},l=xr(Ne,new Map([["b64",!0]]),a?.crit,this._protectedHeader,n),h=!0;if(l.has("b64")&&(h=this._protectedHeader.b64,typeof h!="boolean"))throw new Ne('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=n;if(typeof d!="string"||!d)throw new Ne('JWS "alg" (Algorithm) Header Parameter missing or invalid');Qt(d,r,"sign");let v=this._payload;h&&(v=qe.encode(dr(v)));let p;this._protectedHeader?p=qe.encode(dr(JSON.stringify(this._protectedHeader))):p=qe.encode("");let g=fr(p,qe.encode("."),v),y=await _o(d,r,g),w={signature:dr(y),payload:""};return h&&(w.payload=at.decode(v)),this._unprotectedHeader&&(w.header=this._unprotectedHeader),this._protectedHeader&&(w.protected=at.decode(p)),w}};var gr=class{static{f(this,"CompactSign")}constructor(r){this._flattened=new br(r)}setProtectedHeader(r){return this._flattened.setProtectedHeader(r),this}async sign(r,a){let n=await this._flattened.sign(r,a);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}};function At(t,r){if(!Number.isFinite(r))throw new TypeError(`Invalid ${t} input`);return r}f(At,"validateInput");var yr=class{static{f(this,"ProduceJWT")}constructor(r={}){if(!rt(r))throw new TypeError("JWT Claims Set MUST be an object");this._payload=r}setIssuer(r){return this._payload={...this._payload,iss:r},this}setSubject(r){return this._payload={...this._payload,sub:r},this}setAudience(r){return this._payload={...this._payload,aud:r},this}setJti(r){return this._payload={...this._payload,jti:r},this}setNotBefore(r){return typeof r=="number"?this._payload={...this._payload,nbf:At("setNotBefore",r)}:r instanceof Date?this._payload={...this._payload,nbf:At("setNotBefore",lt(r))}:this._payload={...this._payload,nbf:lt(new Date)+Et(r)},this}setExpirationTime(r){return typeof r=="number"?this._payload={...this._payload,exp:At("setExpirationTime",r)}:r instanceof Date?this._payload={...this._payload,exp:At("setExpirationTime",lt(r))}:this._payload={...this._payload,exp:lt(new Date)+Et(r)},this}setIssuedAt(r){return typeof r>"u"?this._payload={...this._payload,iat:lt(new Date)}:r instanceof Date?this._payload={...this._payload,iat:At("setIssuedAt",lt(r))}:typeof r=="string"?this._payload={...this._payload,iat:At("setIssuedAt",lt(new Date)+Et(r))}:this._payload={...this._payload,iat:At("setIssuedAt",r)},this}};var er=class extends yr{static{f(this,"SignJWT")}setProtectedHeader(r){return this._protectedHeader=r,this}async sign(r,a){let n=new gr(qe.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new pt("JWTs MUST NOT use unencoded payload");return n.sign(r,a)}};var Io=Nr(Xr());async function $o(){let t=`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${atob("QlBC")} Login</title>\n    <style>\n        :root {\n            --color: black;\n            --primary-color: #09639f;\n            --header-color: #09639f; \n            --background-color: #fff;\n            --form-background-color: #f9f9f9;\n            --lable-text-color: #333;\n            --h2-color: #3b3b3b;\n            --border-color: #ddd;\n            --input-background-color: white;\n            --header-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);\n        }\n        html, body { height: 100%; margin: 0; }\n        body {\n            font-family: system-ui;\n            background-color: var(--background-color);\n            position: relative;\n            overflow: hidden;\n        }\n        body.dark-mode {\n            --color: white;\n            --primary-color: #09639F;\n            --header-color: #3498DB; \n            --background-color: #121212;\n            --form-background-color: #121212;\n            --lable-text-color: #DFDFDF;\n            --h2-color: #D5D5D5;\n            --border-color: #353535;\n            --input-background-color: #252525;\n            --header-shadow: 2px 2px 4px rgba(255, 255, 255, 0.25);\n        }\n        html, body { height: 100%; margin: 0; }\n        .container {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            width: 90%;\n        }\n        h1 { font-size: 2.5rem; text-align: center; color: var(--header-color); margin: 0 auto 30px; text-shadow: var(--header-shadow); }        \n        h2 { text-align: center; color: var(--h2-color) }\n        .form-container {\n            background: var(--form-background-color);\n            border: 1px solid var(--border-color);\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n            padding: 20px;\n        }\n        .form-control { margin-bottom: 15px; display: flex; align-items: center; }\n        label {\n            display: block;\n            margin-bottom: 5px;\n            padding-right: 20px;\n            font-size: 110%;\n            font-weight: 600;\n            color: var(--lable-text-color);\n        }\n        input[type="text"],\n        input[type="password"] {\n            width: 100%;\n            padding: 10px;\n            border: 1px solid var(--border-color);\n            border-radius: 5px;\n            color: var(--lable-text-color);\n            background-color: var(--input-background-color);\n        }\n        button {\n            display: block;\n            width: 100%;\n            padding: 10px;\n            font-size: 16px;\n            font-weight: 600;\n            border: none;\n            border-radius: 5px;\n            color: white;\n            background-color: var(--primary-color);\n            cursor: pointer;\n            transition: background-color 0.3s ease;\n        }\n        .button:hover,\n        button:focus {\n            background-color: #2980b9;\n            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);\n            transform: translateY(-2px);\n        }\n        button.button:hover { color: white; }\n        .button:active { transform: translateY(1px); box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); }\n        @media only screen and (min-width: 768px) {\n            .container { width: 30%; }\n        }\n    </style>\n    </head>\n    <body>\n        <div class="container">\n            <h1>${atob("QlBC")} Panel <span style="font-size: smaller;">${globalThis.panelVersion}</span> </h1>\n            <div class="form-container">\n                <h2>User Login</h2>\n                <form id="loginForm">\n                    <div class="form-control">\n                        <label for="password">Password</label>\n                        <input type="password" id="password" name="password" required>\n                    </div>\n                    <div id="passwordError" style="color: red; margin-bottom: 10px;"></div>\n                    <button type="submit" class="button">Login</button>\n                </form>\n            </div>\n        </div>\n    <script>\n        localStorage.getItem('darkMode') === 'enabled' && document.body.classList.add('dark-mode');\n        document.getElementById('loginForm').addEventListener('submit', async (event) => {\n            event.preventDefault();\n            const password = document.getElementById('password').value;\n\n            try {\n                const response = await fetch('/login', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'text/plain'\n                    },\n                    body: password\n                });\n            \n                if (!response.ok) {\n                    passwordError.textContent = ' Wrong Password!';\n                    const errorMessage = await response.text();\n                    console.error('Login failed:', errorMessage);\n                    return;\n                }\n                window.location.href = '/panel';\n            } catch (error) {\n                console.error('Error during login:', error);\n            }\n        });\n    <\/script>\n    </body>\n    </html>`;return new Response(t,{status:200,headers:{"Content-Type":"text/html;charset=utf-8","Access-Control-Allow-Origin":globalThis.urlOrigin,"Access-Control-Allow-Methods":"GET, POST","Access-Control-Allow-Headers":"Content-Type, Authorization","X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","Referrer-Policy":"strict-origin-when-cross-origin","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate, no-transform","CDN-Cache-Control":"no-store"}})}f($o,"renderLoginPage");async function Oa(t,r){let a=await t.text(),n=await r.kv.get("pwd");if(a!==n)return new Response("Method Not Allowed",{status:405});let l=await r.kv.get("secretKey");l||(l=Ha(),await r.kv.put("secretKey",l));let h=(new TextEncoder).encode(l),d=await new er({userID:globalThis.userID}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("24h").sign(h);return new Response("Success",{status:200,headers:{"Set-Cookie":`jwtToken=${d}; HttpOnly; Secure; Max-Age=${7*24*60*60}; Path=/; SameSite=Strict`,"Content-Type":"text/plain"}})}f(Oa,"generateJWTToken");function Ha(){let t=Io.default.randomBytes(32);return Array.from(t,(r=>r.toString(16).padStart(2,"0"))).join("")}f(Ha,"generateSecretKey");async function kt(t,r){try{let a=await r.kv.get("secretKey"),n=(new TextEncoder).encode(a),l=t.headers.get("Cookie")?.match(/(^|;\s*)jwtToken=([^;]*)/),h=l?l[2]:null;if(!h)return console.log("Unauthorized: Token not available!"),!1;let{payload:d}=await Gr(h,n);return console.log(`Successfully authenticated, User ID: ${d.userID}`),!0}catch(a){return console.log(a),!1}}f(kt,"Authenticate");function To(){return new Response("Success",{status:200,headers:{"Set-Cookie":"jwtToken=; Secure; SameSite=None; Expires=Thu, 01 Jan 1970 00:00:00 GMT","Content-Type":"text/plain"}})}f(To,"logout");async function Do(t,r){let a=await kt(t,r),n=await r.kv.get("pwd");if(n&&!a)return new Response("Unauthorized!",{status:401});let l=await t.text();return l===n?new Response("Please enter a new Password!",{status:400}):(await r.kv.put("pwd",l),new Response("Success",{status:200,headers:{"Set-Cookie":"jwtToken=; Path=/; Secure; SameSite=None; Expires=Thu, 01 Jan 1970 00:00:00 GMT","Content-Type":"text/plain"}}))}f(Do,"resetPassword");async function No(t,r){return await kt(t,r)?Response.redirect(`${globalThis.urlOrigin}/panel`,302):t.method==="POST"?await Oa(t,r):await $o()}f(No,"login");async function gt(t,r){let a=await tr(globalThis.hostName),n=r?a.ipv6.map((l=>`[${l}]`)):[];return[globalThis.hostName,"www.speedtest.net",...a.ipv4,...n,...t?t.split(","):[]]}f(gt,"getConfigAddresses");function yt(t,r){let a=r?1:0,n=t[a].account.config;return{warpIPv6:`${n.interface.addresses.v6}/128`,reserved:n.client_id,publicKey:n.peers[0].public_key,privateKey:t[a].privateKey}}f(yt,"extractWireguardParams");function mt(t,r,a,n,l,h){let d,v=h?` ${h}`:"";return n.includes(a)?d="Clean IP":d=Me(a)?"Domain":Sr(a)?"IPv4":Rt(a)?"IPv6":"",` ${t} - ${l}${v} - ${d} : ${r}`}f(mt,"generateRemark");function wt(t){let r="";for(let a=0;a<t.length;a++)r+=Math.random()<.5?t[a].toUpperCase():t[a];return r}f(wt,"randomUpperCase");function nt(t){let r="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length;for(let l=0;l<t;l++)r+=a.charAt(Math.floor(Math.random()*n));return r}f(nt,"getRandomPath");function vr(t){let r=atob(t);return Array.from(r).map((l=>l.charCodeAt(0).toString(16).padStart(2,"0"))).join("").match(/.{2}/g).map((l=>parseInt(l,16)))}f(vr,"base64ToDecimal");function Sr(t){return/^(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\/([0-9]|[1-2][0-9]|3[0-2]))?$/.test(t)}f(Sr,"isIPv4");function Rt(t){return/^\[(?:(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}|(?:[a-fA-F0-9]{1,4}:){1,7}:|::(?:[a-fA-F0-9]{1,4}:){0,7}|(?:[a-fA-F0-9]{1,4}:){1,6}:[a-fA-F0-9]{1,4}|(?:[a-fA-F0-9]{1,4}:){1,5}(?::[a-fA-F0-9]{1,4}){1,2}|(?:[a-fA-F0-9]{1,4}:){1,4}(?::[a-fA-F0-9]{1,4}){1,3}|(?:[a-fA-F0-9]{1,4}:){1,3}(?::[a-fA-F0-9]{1,4}){1,4}|(?:[a-fA-F0-9]{1,4}:){1,2}(?::[a-fA-F0-9]{1,4}){1,5}|[a-fA-F0-9]{1,4}:(?::[a-fA-F0-9]{1,4}){1,6})\](?:\/(1[0-1][0-9]|12[0-8]|[0-9]?[0-9]))?$/.test(t)}f(Rt,"isIPv6");function Lt(t){let a=new URL(t).hostname,n=Me(a);return{host:a,isHostDomain:n}}f(Lt,"getDomain");var Qr=Nr(Xr());async function qr(t){let r=[],a="https://api.cloudflareclient.com/v0a4005/reg",n=[Mo(),Mo()],l={install_id:"",fcm_token:"",tos:(new Date).toISOString(),type:"Android",model:"PC",locale:"en_US",warp_enabled:!0},h=f((async v=>await(await fetch(a,{method:"POST",headers:{"User-Agent":"insomnia/8.6.1","Content-Type":"application/json"},body:JSON.stringify({...l,key:v.publicKey})})).json()),"fetchAccount");for(let v of n){let p=await h(v);r.push({privateKey:v.privateKey,account:p})}let d=JSON.stringify(r);return await t.kv.put("warpConfigs",d),{error:null,configs:d}}f(qr,"fetchWarpConfigs");var Mo=f((()=>{let t=f((h=>btoa(String.fromCharCode.apply(null,h))),"base64Encode"),r=Qr.default.randomBytes(32);r[0]&=248,r[31]&=127,r[31]|=64;let a=Qr.default.scalarMult.base(r),n=t(a),l=t(r);return{publicKey:n,privateKey:l}}),"generateKeyPair");async function Qe(t,r){let a,n;try{a=await r.kv.get("proxySettings",{type:"json"}),n=await r.kv.get("warpConfigs",{type:"json"})}catch(l){throw console.log(l),new Error(`An error occurred while getting KV - ${l}`)}if(!a){a=await Cr(t,r);let{error:l,configs:h}=await qr(r,a);if(l)throw new Error(`An error occurred while getting Warp configs - ${l}`);n=h}return globalThis.panelVersion!==a.panelVersion&&(a=await Cr(t,r)),{proxySettings:a,warpConfigs:n}}f(Qe,"getDataset");async function Cr(t,r){let a=t.method==="POST"?await t.formData():null,n=a?.get("resetSettings")==="true",l,h=[];if(n)a=null;else{try{l=await r.kv.get("proxySettings",{type:"json"})}catch(k){throw console.log(k),new Error(`An error occurred while getting current KV settings - ${k}`)}let p=a?.getAll("udpXrayNoiseMode")||[],g=a?.getAll("udpXrayNoisePacket")||[],y=a?.getAll("udpXrayNoiseDelayMin")||[],w=a?.getAll("udpXrayNoiseDelayMax")||[],_=a?.getAll("udpXrayNoiseCount")||[];h.push(...p.map(((k,M)=>({type:k,packet:g[M],delay:`${y[M]}-${w[M]}`,count:_[M]}))))}let d=f((p=>{let g=a?.get(p);return g===void 0?null:g==="true"?!0:g==="false"?!1:g}),"validateField"),v={remoteDNS:d("remoteDNS")??l?.remoteDNS??"https://8.8.8.8/dns-query",localDNS:d("localDNS")??l?.localDNS??"8.8.8.8",VLTRFakeDNS:d("VLTRFakeDNS")??l?.VLTRFakeDNS??!1,proxyIP:d("proxyIP")?.replaceAll(" ","")??l?.proxyIP??"",outProxy:d("outProxy")??l?.outProxy??"",outProxyParams:Ka(d("outProxy"))??l?.outProxyParams??{},cleanIPs:d("cleanIPs")?.replaceAll(" ","")??l?.cleanIPs??"",enableIPv6:d("enableIPv6")??l?.enableIPv6??!0,customCdnAddrs:d("customCdnAddrs")?.replaceAll(" ","")??l?.customCdnAddrs??"",customCdnHost:d("customCdnHost")?.trim()??l?.customCdnHost??"",customCdnSni:d("customCdnSni")?.trim()??l?.customCdnSni??"",bestVLTRInterval:d("bestVLTRInterval")??l?.bestVLTRInterval??"30",VLConfigs:d("VLConfigs")??l?.VLConfigs??!0,TRConfigs:d("TRConfigs")??l?.TRConfigs??!1,ports:d("ports")?.split(",")??l?.ports??["443"],lengthMin:d("fragmentLengthMin")??l?.lengthMin??"100",lengthMax:d("fragmentLengthMax")??l?.lengthMax??"200",intervalMin:d("fragmentIntervalMin")??l?.intervalMin??"1",intervalMax:d("fragmentIntervalMax")??l?.intervalMax??"1",fragmentPackets:d("fragmentPackets")??l?.fragmentPackets??"tlshello",bypassLAN:d("bypass-lan")??l?.bypassLAN??!1,bypassIran:d("bypass-iran")??l?.bypassIran??!1,bypassChina:d("bypass-china")??l?.bypassChina??!1,bypassRussia:d("bypass-russia")??l?.bypassRussia??!1,blockAds:d("block-ads")??l?.blockAds??!1,blockPorn:d("block-porn")??l?.blockPorn??!1,blockUDP443:d("block-udp-443")??l?.blockUDP443??!1,customBypassRules:d("customBypassRules")?.replaceAll(" ","")??l?.customBypassRules??"",customBlockRules:d("customBlockRules")?.replaceAll(" ","")??l?.customBlockRules??"",warpEndpoints:d("warpEndpoints")?.replaceAll(" ","")??l?.warpEndpoints??"engage.cloudflareclient.com:2408",warpFakeDNS:d("warpFakeDNS")??l?.warpFakeDNS??!1,warpEnableIPv6:d("warpEnableIPv6")??l?.warpEnableIPv6??!0,bestWarpInterval:d("bestWarpInterval")??l?.bestWarpInterval??"30",xrayUdpNoises:(h.length?JSON.stringify(h):l?.xrayUdpNoises)??JSON.stringify([{type:"base64",packet:btoa(globalThis.userID),delay:"1-1",count:"1"}]),hiddifyNoiseMode:d("hiddifyNoiseMode")??l?.hiddifyNoiseMode??"m4",nikaNGNoiseMode:d("nikaNGNoiseMode")??l?.nikaNGNoiseMode??"quic",noiseCountMin:d("noiseCountMin")??l?.noiseCountMin??"10",noiseCountMax:d("noiseCountMax")??l?.noiseCountMax??"15",noiseSizeMin:d("noiseSizeMin")??l?.noiseSizeMin??"5",noiseSizeMax:d("noiseSizeMax")??l?.noiseSizeMax??"10",noiseDelayMin:d("noiseDelayMin")??l?.noiseDelayMin??"1",noiseDelayMax:d("noiseDelayMax")??l?.noiseDelayMax??"1",amneziaNoiseCount:d("amneziaNoiseCount")??l?.amneziaNoiseCount??"5",amneziaNoiseSizeMin:d("amneziaNoiseSizeMin")??l?.amneziaNoiseSizeMin??"50",amneziaNoiseSizeMax:d("amneziaNoiseSizeMax")??l?.amneziaNoiseSizeMax??"100",panelVersion:globalThis.panelVersion};try{await r.kv.put("proxySettings",JSON.stringify(v)),n&&await Zr(t,r)}catch(p){throw console.log(p),new Error(`An error occurred while updating KV - ${p}`)}return v}f(Cr,"updateDataset");function Ka(t){let r={};if(!t)return{};let a=new URL(t),n=a.protocol.slice(0,-1);if(n===atob("dmxlc3M=")){let l=new URLSearchParams(a.search);r={protocol:n,uuid:a.username,server:a.hostname,port:a.port},l.forEach(((h,d)=>{r[d]=h}))}else r={protocol:n,user:a.username,pass:a.password,server:a.host,port:a.port};return JSON.stringify(r)}f(Ka,"extractChainProxyParams");async function Zr(t,r){if(!await kt(t,r))return new Response("Unauthorized",{status:401});if(t.method==="POST")try{let{error:n}=await qr(r);return n?new Response(n,{status:400}):new Response("Warp configs updated successfully",{status:200})}catch(n){return console.log(n),new Response(`An error occurred while updating Warp configs! - ${n}`,{status:500})}else return new Response("Unsupported request",{status:405})}f(Zr,"updateWarpConfigs");async function Fo(t,r){let{remoteDNS:a,localDNS:n,VLTRFakeDNS:l,proxyIP:h,outProxy:d,cleanIPs:v,enableIPv6:p,customCdnAddrs:g,customCdnHost:y,customCdnSni:w,bestVLTRInterval:_,VLConfigs:k,TRConfigs:M,ports:z,lengthMin:V,lengthMax:W,intervalMin:B,intervalMax:H,fragmentPackets:X,warpEndpoints:K,warpFakeDNS:x,warpEnableIPv6:A,bestWarpInterval:D,xrayUdpNoises:E,hiddifyNoiseMode:L,nikaNGNoiseMode:R,noiseCountMin:J,noiseCountMax:P,noiseSizeMin:F,noiseSizeMax:Y,noiseDelayMin:se,noiseDelayMax:ie,amneziaNoiseCount:Se,amneziaNoiseSizeMin:te,amneziaNoiseSizeMax:fe,bypassLAN:me,bypassIran:xe,bypassChina:ke,bypassRussia:ne,blockAds:Fe,blockPorn:_t,blockUDP443:$t,customBypassRules:ft,customBlockRules:dt}=t,rr=(k?1:0)+(M?1:0),xt="",Ht="";[...globalThis.hostName.includes("workers.dev")?globalThis.defaultHttpPorts:[],...globalThis.defaultHttpsPorts].forEach((De=>{let Ie=`port-${De}`,st=z.includes(De)?"checked":"",ot=`\n            <div class="routing" style="grid-template-columns: 1fr 2fr; margin-right: 10px;">\n                <input type="checkbox" id=${Ie} name=${De} onchange="handlePortChange(event)" value="true" ${st}>\n                <label style="margin-bottom: 3px;" for=${Ie}>${De}</label>\n            </div>`;globalThis.defaultHttpsPorts.includes(De)?Ht+=ot:xt+=ot}));let or="";JSON.parse(E).forEach(((De,Ie)=>{or+=`\n            <div id="udp-noise-container-${Ie}" class="udp-noise">\n                <div class="header-container">\n                    <h4 style="margin: 0 5px;">Noise ${Ie+1}</h4>\n                    <button type="button" onclick="deleteUdpNoise(this)" style="background: none; margin: 0; border: none; cursor: pointer;">\n                        <i class="fa fa-minus-circle fa-2x" style="color: var(--button-color);" aria-hidden="true"></i>\n                    </button>      \n                </div>\n                <div class="form-control">\n                    <label for="udpXrayNoiseMode-${Ie}"> v2ray Mode</label>\n                    <div class="input-with-select">\n                        <select id="udpXrayNoiseMode-${Ie}" name="udpXrayNoiseMode">\n                            <option value="base64" ${De.type==="base64"?"selected":""}>Base64</option>\n                            <option value="rand" ${De.type==="rand"?"selected":""}>Random</option>\n                            <option value="str" ${De.type==="str"?"selected":""}>String</option>\n                            <option value="hex" ${De.type==="hex"?"selected":""}>Hex</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="form-control">\n                    <label for="udpXrayNoisePacket-${Ie}"> Noise Packet</label>\n                    <input type="text" id="udpXrayNoisePacket-${Ie}" name="udpXrayNoisePacket" value="${De.packet}">\n                </div>\n                <div class="form-control">\n                    <label for="udpXrayNoiseDelayMin-${Ie}"> Noise Delay</label>\n                    <div class="min-max">\n                        <input type="number" id="udpXrayNoiseDelayMin-${Ie}" name="udpXrayNoiseDelayMin"\n                            value="${De.delay.split("-")[0]}" min="1" required>\n                        <span> - </span>\n                        <input type="number" id="udpXrayNoiseDelayMax-${Ie}" name="udpXrayNoiseDelayMax"\n                            value="${De.delay.split("-")[1]}" min="1" required>\n                    </div>\n                </div>\n                <div class="form-control">\n                    <label for="udpXrayNoiseCount-${Ie}"> Noise Count</label>\n                    <input type="number" id="udpXrayNoiseCount-${Ie}" name="udpXrayNoiseCount" value="${De.count}" min="1" required>\n                </div>\n            </div>`}));let Oe=f((De=>De.map((Ie=>`\n        <div>\n            <span class="material-symbols-outlined symbol">verified</span>\n            <span>${Ie}</span>\n        </div>`)).join("")),"supportedApps"),Ke=f(((De,Ie,st,ot,Ct,Tt)=>{let nr=`${Ct?"sing-box://import-remote-profile?url=":""}${Tt?"hiddify://import/":""}https://${globalThis.hostName}/${De}/${globalThis.subPath}${Ie?`?app=${Ie}`:""}#${st}`;return`\n            <button onclick="openQR('${encodeURI(nr)}', '${ot}')">\n                QR Code&nbsp;<span class="material-symbols-outlined">qr_code</span>\n            </button>`}),"subQR"),ze=f(((De,Ie,st,ot)=>{let Ct=`${ot?"hiddify://import/":""}https://${globalThis.hostName}/${De}/${globalThis.subPath}${Ie?`?app=${Ie}`:""}#${st}`;return`\n            <button onclick="copyToClipboard('${encodeURI(Ct)}')">\n                Copy Sub<span class="material-symbols-outlined">format_list_bulleted</span>\n            </button>`}),"subURL"),et=f(((De,Ie)=>`\n            <button onclick="dlURL('${`https://${globalThis.hostName}/${De}/${globalThis.subPath}${Ie?`?app=${Ie}`:""}`}')">\n                Get config<span class="material-symbols-outlined">download</span>\n            </button>`),"dlConfig"),It=`\n    :root {\n        --color: black;\n        --primary-color: #09639f;\n        --secondary-color: #3498db;\n        --header-color: #09639f; \n        --background-color: #fff;\n        --form-background-color: #f9f9f9;\n        --table-active-color: #f2f2f2;\n        --hr-text-color: #3b3b3b;\n        --lable-text-color: #333;\n        --border-color: #ddd;\n        --button-color: #09639f;\n        --input-background-color: white;\n        --header-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);\n    }\n    body { font-family: Twemoji Country Flags, system-ui; background-color: var(--background-color); color: var(--color) }\n    body.dark-mode {\n        --color: white;\n        --primary-color: #09639F;\n        --secondary-color: #3498DB;\n        --header-color: #3498DB; \n        --background-color: #121212;\n        --form-background-color: #121212;\n        --table-active-color: #252525;\n        --hr-text-color: #D5D5D5;\n        --lable-text-color: #DFDFDF;\n        --border-color: #353535;\n        --button-color: #3498DB;\n        --input-background-color: #252525;\n        --header-shadow: 2px 2px 4px rgba(255, 255, 255, 0.25);\n    }\n    .material-symbols-outlined {\n        margin-left: 5px;\n        font-variation-settings:\n        'FILL' 0,\n        'wght' 400,\n        'GRAD' 0,\n        'opsz' 24\n    }\n    details { border-bottom: 1px solid var(--border-color); }\n    summary {\n        font-weight: bold;\n        cursor: pointer;\n        text-align: center;\n        text-wrap: nowrap;\n    }\n    summary::marker { font-size: 1.5rem; color: var(--secondary-color); }\n    summary h2 { display: inline-flex; }\n    h1 { font-size: 2.5em; text-align: center; color: var(--header-color); text-shadow: var(--header-shadow); }\n    h2,h3 { margin: 30px 0; text-align: center; color: var(--hr-text-color); }\n    hr { border: 1px solid var(--border-color); margin: 20px 0; }\n    .footer {\n        display: flex;\n        font-weight: 600;\n        margin: 10px auto 0 auto;\n        justify-content: center;\n        align-items: center;\n    }\n    .footer button {margin: 0 20px; background: #212121; max-width: fit-content;}\n    .footer button:hover, .footer button:focus { background: #3b3b3b;}\n    .form-control a, a.link { text-decoration: none; }\n    .form-control {\n        margin: 20px auto;\n        font-family: Arial, sans-serif;\n        display: flex;\n        flex-direction: column;\n    }\n    .form-control button {\n        background-color: var(--form-background-color);\n        font-size: 1.1rem;\n        font-weight: 600;\n        color: var(--button-color);\n        border-color: var(--primary-color);\n        border: 1px solid;\n        width: 100%;\n    }\n    label {\n        display: block;\n        margin-bottom: 5px;\n        font-size: 110%;\n        font-weight: 600;\n        color: var(--lable-text-color);\n    }\n    input[type="text"],\n    input[type="number"],\n    input[type="url"],\n    textarea,\n    select {\n        width: 100%;\n        text-align: center;\n        padding: 10px;\n        border: 1px solid var(--border-color);\n        border-radius: 5px;\n        font-size: 16px;\n        color: var(--lable-text-color);\n        background-color: var(--input-background-color);\n        box-sizing: border-box;\n        transition: border-color 0.3s ease;\n    }\t\n    input[type="text"]:focus,\n    input[type="number"]:focus,\n    input[type="url"]:focus,\n    textarea:focus,\n    select:focus { border-color: var(--secondary-color); outline: none; }\n    .button,\n    table button {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 135px;\n        white-space: nowrap;\n        padding: 10px 0;\n        font-size: 16px;\n        font-weight: 600;\n        letter-spacing: 1px;\n        border: none;\n        border-radius: 5px;\n        color: white;\n        background-color: var(--primary-color);\n        cursor: pointer;\n        outline: none;\n        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\n        transition: all 0.3s ease;\n    }\n    .button {font-weight: 600; padding: 15px 15px; font-size: 1.1rem; width: max-content; }\n    input[type="checkbox"] { \n        background-color: var(--input-background-color);\n        style="margin: 0; \n        grid-column: 2;"\n    }\n    .button.disabled {\n        background-color: #ccc;\n        cursor: not-allowed;\n        box-shadow: none;\n        pointer-events: none;\n    }\n    .button:hover,\n    table button:hover,\n    table button:focus {\n        background-color: #2980b9;\n        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);\n        transform: translateY(-2px);\n    }\n    .header-container button:hover {\n        transform: scale(1.1);\n    }\n    button.button:hover { color: white; }\n    .button:active,\n    table button:active { transform: translateY(1px); box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); }\n    .form-container {\n        max-width: 90%;\n        margin: 0 auto;\n        padding: 20px;\n        background: var(--form-background-color);\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        margin-bottom: 100px;\n    }\n    .table-container { overflow-x: auto; }\n    table { \n        width: 100%;\n        border: 1px solid var(--border-color);\n        border-collapse: separate;\n        border-spacing: 0; \n        border-radius: 10px;\n        margin-bottom: 20px;\n        overflow: hidden;\n    }\n    tbody { display: flex; flex-direction: column; }\n    tr { display: flex; flex-direction: row; }\n    th, td { \n        display: flex; \n        flex-direction: column;\n        justify-content: center; \n        padding: 10px; \n        width: 100%;\n        gap: 10px;\n        border-bottom: 1px solid var(--border-color); \n    }\n    td div { display: flex; align-items: center; }\n    th { background-color: var(--secondary-color); color: white; font-weight: bold; font-size: 1.1rem; width: 50%;}\n    td:last-child { \n        background-color: var(--table-active-color); \n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-direction: column;\n        gap: 10px;\n    }               \n    tr:hover { background-color: var(--table-active-color); }\n    .modal {\n        display: none;\n        position: fixed;\n        z-index: 1;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        background-color: rgba(0, 0, 0, 0.4);\n    }\n    .modal-content {\n        background-color: var(--form-background-color);\n        margin: auto;\n        padding: 10px 20px 20px;\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        width: 80%;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n    }\n    .close { color: var(--color); float: right; font-size: 28px; font-weight: bold; }\n    .close:hover,\n    .close:focus { color: black; text-decoration: none; cursor: pointer; }\n    .form-control label {\n        display: block;\n        margin-bottom: 8px;\n        font-size: 110%;\n        font-weight: 600;\n        color: var(--lable-text-color);\n        line-height: 1.3em;\n    }\n    .form-control input[type="password"] {\n        width: 100%;\n        padding: 10px;\n        border: 1px solid var(--border-color);\n        border-radius: 5px;\n        font-size: 16px;\n        color: var(--lable-text-color);\n        background-color: var(--input-background-color);\n        box-sizing: border-box;\n        margin-bottom: 15px;\n        transition: border-color 0.3s ease;\n    }\n    .routing { \n        display: grid;\n        justify-content: flex-start;\n        grid-template-columns: 1fr 1fr 10fr 1fr;\n        margin-bottom: 15px;\n    }\n    .form-control .routing input { grid-column: 2 / 3; }\n    #routing-rules.form-control { display: grid; grid-template-columns: 1fr 1fr; }\n    .routing label {\n        text-align: left;\n        margin: 0 0 0 10px;\n        font-weight: 400;\n        font-size: 100%;\n        text-wrap: nowrap;\n    }\n    .form-control input[type="password"]:focus { border-color: var(--secondary-color); outline: none; }\n    #passwordError { color: red; margin-bottom: 10px; }\n    .symbol { margin-right: 8px; }\n    .modalQR {\n        display: none;\n        position: fixed;\n        z-index: 1;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        background-color: rgba(0, 0, 0, 0.4);\n    }\n    .floating-button {\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n        background-color: var(--color);\n        color: white;\n        border: none;\n        border-radius: 50%;\n        width: 60px;\n        height: 60px;\n        font-size: 24px;\n        cursor: pointer;\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n        transition: background-color 0.3s, transform 0.3s;\n    }\n    .floating-button:hover { transform: scale(1.1); }\n    .min-max { display: grid; grid-template-columns: 1fr auto 1fr; align-items: baseline; width: 100%; }\n    .min-max span { text-align: center; white-space: pre; }\n    .input-with-select { width: 100%; }\n    body.dark-mode .floating-button { background-color: var(--color); }\n    body.dark-mode .floating-button:hover { transform: scale(1.1); }\n    #ips th { \n        background-color: var(--hr-text-color);\n        color: var(--background-color);\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        flex: 1; \n    }\n    #ips td { \n        background-color: unset; \n        overflow: hidden;\n        flex: 1;\n        text-overflow: clip;\n        white-space: nowrap;\n    }\n    #ips tr { flex-wrap: wrap; }\n    #ips td:first-child { background-color: var(--table-active-color); }\n    .header-container { display: flex; justify-content: center; margin-bottom: 20px; }\n    .udp-noise { border: 1px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 10px;}\n    @media only screen and (min-width: 768px) {\n        .form-container { max-width: 70%; }\n        .form-control { \n            margin-bottom: 15px;\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            align-items: baseline;\n            justify-content: flex-end;\n            font-family: Arial, sans-serif;\n        }\n        #apply { display: block; margin: 20px auto; max-width: 50%; }\n        .modal-content { width: 30% }\n        .routing { display: grid; grid-template-columns: 4fr 1fr 3fr 4fr; }\n    }`,ar=`\n    const defaultHttpsPorts = ['443', '8443', '2053', '2083', '2087', '2096'];\n    let activePortsNo = ${z.length};\n    let activeHttpsPortsNo = ${z.filter((De=>globalThis.defaultHttpsPorts.includes(De))).length};\n    let activeProtocols = ${rr};\n    localStorage.getItem('darkMode') === 'enabled' && document.body.classList.add('dark-mode');\n\n    document.addEventListener('DOMContentLoaded', async () => {\n        const configForm = document.getElementById('configForm');            \n        const changePass = document.getElementById('openModalBtn');\n        const closeBtn = document.querySelector(".close");\n        const passwordChangeForm = document.getElementById('passwordChangeForm');                    \n        const initialFormData = new FormData(configForm);\n        const modal = document.getElementById('myModal');\n        const closeQR = document.getElementById('closeQRModal');\n        const resetSettings = document.getElementById('resetSettings');\n        let modalQR = document.getElementById('myQRModal');\n        let qrcodeContainer = document.getElementById('qrcode-container');\n        let forcedPassChange = false;\n        const darkModeToggle = document.getElementById('darkModeToggle');\n                \n        const hasFormDataChanged = () => {\n            const currentFormData = new FormData(configForm);\n            const currentFormDataEntries = [...currentFormData.entries()];\n\n            const nonCheckboxFieldsChanged = currentFormDataEntries.some(\n                ([key, value]) => !initialFormData.has(key) || initialFormData.get(key) !== value\n            );\n\n            const checkboxFieldsChanged = Array.from(configForm.elements)\n                .filter((element) => element.type === 'checkbox')\n                .some((checkbox) => {\n                const initialValue = initialFormData.has(checkbox.name)\n                    ? initialFormData.get(checkbox.name)\n                    : false;\n                const currentValue = currentFormDataEntries.find(([key]) => key === checkbox.name)?.[1] || false;\n                return initialValue !== currentValue;\n            });\n\n            return nonCheckboxFieldsChanged || checkboxFieldsChanged;\n        };\n        \n        const enableApplyButton = () => {\n            const isChanged = hasFormDataChanged();\n            applyButton.disabled = !isChanged;\n            applyButton.classList.toggle('disabled', !isChanged);\n        };\n                    \n        passwordChangeForm.addEventListener('submit', event => resetPassword(event));\n        document.getElementById('logout').addEventListener('click', event => logout(event));\n        configForm.addEventListener('submit', (event) => applySettings(event, configForm));\n        configForm.addEventListener('input', enableApplyButton);\n        configForm.addEventListener('change', enableApplyButton);\n        changePass.addEventListener('click', () => {\n            forcedPassChange ? closeBtn.style.display = 'none' : closeBtn.style.display = '';\n            modal.style.display = "block";\n            document.body.style.overflow = "hidden";\n            forcedPassChange = false;\n        });        \n        closeBtn.addEventListener('click', () => {\n            modal.style.display = "none";\n            document.body.style.overflow = "";\n        });\n        closeQR.addEventListener('click', () => {\n            modalQR.style.display = "none";\n            qrcodeContainer.lastElementChild.remove();\n        });\n        resetSettings.addEventListener('click', async () => {\n            const confirmReset = confirm(' This will reset all panel settings.\\nAre you sure?');\n            if(!confirmReset) return;\n            const formData = new FormData();\n            formData.append('resetSettings', 'true');\n            try {\n                document.body.style.cursor = 'wait';\n                const refreshButtonVal = refreshBtn.innerHTML;\n                refreshBtn.innerHTML = ' Loading...';\n\n                const response = await fetch('/panel', {\n                    method: 'POST',\n                    body: formData,\n                    credentials: 'include'\n                });\n\n                document.body.style.cursor = 'default';\n                refreshBtn.innerHTML = refreshButtonVal;\n                if (!response.ok) {\n                    const errorMessage = await response.text();\n                    console.error(errorMessage, response.status);\n                    alert(' An error occured, Please try again!\\n ' + errorMessage);\n                    return;\n                }       \n                alert(' Panel settings reset to default successfully! ');\n                window.location.reload(true);\n            } catch (error) {\n                console.error('Error:', error);\n            }\n        });\n        window.onclick = (event) => {\n            if (event.target == modalQR) {\n                modalQR.style.display = "none";\n                qrcodeContainer.lastElementChild.remove();\n            }\n        }\n        darkModeToggle.addEventListener('click', () => {\n            const isDarkMode = document.body.classList.toggle('dark-mode');\n            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');\n        });\n\n        const isPassSet = ${r};\n        if (!isPassSet) {\n            forcedPassChange = true;\n            changePass.click();\n        }\n\n        await fetchIPInfo();\n    });\n\n    const downloadWarpConfigs = async (isAmnezia) => {\n        try {\n            const client = isAmnezia ? "?app=amnezia" : "";\n            const response = await fetch("/get-warp-configs" + client);\n            const configs = await response.json();\n            const zip = new JSZip();\n            configs.forEach( (config, index) => {\n                zip.file('BPB-Warp-' + String(index + 1) + '.conf', config);\n            });\n\n            zip.generateAsync({ type: "blob" }).then(function (blob) {\n                const link = document.createElement("a");\n                link.href = URL.createObjectURL(blob);\n                link.download = "BPB Warp configs.zip";\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n            });\n        } catch (error) {\n            console.error("Error fetching configs:", error);\n        }\n    }\n\n    const dlURL = async (url) => {\n        try {\n            const response = await fetch(url);\n            if (!response.ok) {\n                throw new Error('Network response was not ok');\n            }\n            const data = await response.json();\n            const blob = new Blob([JSON.stringify(data, null, 4)], { type: 'application/json' });\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(blob);\n            link.download = 'config.json';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n        } catch (error) {\n            console.error('There was a problem with the fetch operation:', error);\n        }\n    };\n\n    const fetchIPInfo = async () => {\n        const updateUI = (ip = '-', country = '-', countryCode = '-', city = '-', isp = '-', cfIP) => {\n            const flag = countryCode !== '-' ? String.fromCodePoint(...[...countryCode].map(c => 0x1F1E6 + c.charCodeAt(0) - 65)) : '';\n            document.getElementById(cfIP ? 'cf-ip' : 'ip').textContent = ip;\n            document.getElementById(cfIP ? 'cf-country' : 'country').textContent = country + ' ' + flag;\n            document.getElementById(cfIP ? 'cf-city' : 'city').textContent = city;\n            document.getElementById(cfIP ? 'cf-isp' : 'isp').textContent = isp;\n        };\n\n        const refreshIcon = document.getElementById("refresh-geo-location").querySelector('i');\n        refreshIcon.classList.add('fa-spin');\n        document.body.style.cursor = 'wait';\n\n        try {\n            const ipResponse = await fetch('https://ipwho.is/' + '?nocache=' + Date.now(), { cache: "no-store" });\n            const ipResponseObj = await ipResponse.json();\n            const geoResponse = await fetch('/my-ip', { \n                method: 'POST',\n                body: ipResponseObj.ip\n            });\n            const ipGeoLocation = await geoResponse.json();\n            updateUI(ipResponseObj.ip, ipGeoLocation.country, ipGeoLocation.countryCode, ipGeoLocation.city, ipGeoLocation.isp);\n            const cfIPresponse = await fetch('https://ipv4.icanhazip.com/?nocache=' + Date.now(), { cache: "no-store" });\n            const cfIP = await cfIPresponse.text();\n            const cfGeoResponse = await fetch('/my-ip', { \n                method: 'POST',\n                body: cfIP.trim()\n            });\n            const cfIPGeoLocation = await cfGeoResponse.json();\n            updateUI(cfIP, cfIPGeoLocation.country, cfIPGeoLocation.countryCode, cfIPGeoLocation.city, cfIPGeoLocation.isp, true);\n            refreshIcon.classList.remove('fa-spin');\n            document.body.style.cursor = 'default';\n        } catch (error) {\n            console.error('Error fetching IP address:', error);\n        }\n    }\n\n    const addUdpNoise = () => {\n        const container = document.getElementById("udp-noise-container");\n        const noiseBlock = document.getElementById("udp-noise-container-0");\n        const index = container.children.length;\n        const clone = noiseBlock.cloneNode(true);\n        clone.querySelector("h4").textContent = "Noise " + String(index + 1);\n        container.appendChild(clone);\n        document.getElementById("configForm").dispatchEvent(new Event("change"));\n    }\n    \n    const deleteUdpNoise = (button) => {\n        const container = document.getElementById("udp-noise-container");\n        if (container.children.length === 1) {\n            alert(' You cannot delete all noises!');\n            return;\n        }   \n        const confirmReset = confirm(' This will delete the noise.\\nAre you sure?');\n        if(!confirmReset) return;\n        button.closest(".udp-noise").remove();\n        document.getElementById("configForm").dispatchEvent(new Event("change"));\n    }\n\n    const getWarpConfigs = async () => {\n        const confirmReset = confirm(' Are you sure?');\n        if(!confirmReset) return;\n        const refreshBtn = document.getElementById('refreshBtn');\n\n        try {\n            document.body.style.cursor = 'wait';\n            const refreshButtonVal = refreshBtn.innerHTML;\n            refreshBtn.innerHTML = ' Loading...';\n\n            const response = await fetch('/update-warp', {\n                method: 'POST',\n                credentials: 'include'\n            });\n\n            document.body.style.cursor = 'default';\n            refreshBtn.innerHTML = refreshButtonVal;\n            if (!response.ok) {\n                const errorMessage = await response.text();\n                console.error(errorMessage, response.status);\n                alert(' An error occured, Please try again!\\n ' + errorMessage);\n                return;\n            }          \n            alert(' Warp configs updated successfully! ');\n        } catch (error) {\n            console.error('Error:', error);\n        } \n    }\n\n    const handlePortChange = (event) => {\n        \n        if(event.target.checked) { \n            activePortsNo++ \n            defaultHttpsPorts.includes(event.target.name) && activeHttpsPortsNo++;\n        } else {\n            activePortsNo--;\n            defaultHttpsPorts.includes(event.target.name) && activeHttpsPortsNo--;\n        }\n\n        if (activePortsNo === 0) {\n            event.preventDefault();\n            event.target.checked = !event.target.checked;\n            alert(" At least one port should be selected! ");\n            activePortsNo = 1;\n            defaultHttpsPorts.includes(event.target.name) && activeHttpsPortsNo++;\n            return false;\n        }\n            \n        if (activeHttpsPortsNo === 0) {\n            event.preventDefault();\n            event.target.checked = !event.target.checked;\n            alert(" At least one TLS(https) port should be selected! ");\n            activeHttpsPortsNo = 1;\n            return false;\n        }\n    }\n    \n    const handleProtocolChange = (event) => {\n        \n        if(event.target.checked) { \n            activeProtocols++ \n        } else {\n            activeProtocols--;\n        }\n\n        if (activeProtocols === 0) {\n            event.preventDefault();\n            event.target.checked = !event.target.checked;\n            alert(" At least one Protocol should be selected! ");\n            activeProtocols = 1;\n            return false;\n        }\n    }\n\n    const openQR = (url, title) => {\n        let qrcodeContainer = document.getElementById("qrcode-container");\n        let qrcodeTitle = document.getElementById("qrcodeTitle");\n        const modalQR = document.getElementById("myQRModal");\n        qrcodeTitle.textContent = title;\n        modalQR.style.display = "block";\n        let qrcodeDiv = document.createElement("div");\n        qrcodeDiv.className = "qrcode";\n        qrcodeDiv.style.padding = "2px";\n        qrcodeDiv.style.backgroundColor = "#ffffff";\n        new QRCode(qrcodeDiv, {\n            text: url,\n            width: 256,\n            height: 256,\n            colorDark: "#000000",\n            colorLight: "#ffffff",\n            correctLevel: QRCode.CorrectLevel.H\n        });\n        qrcodeContainer.appendChild(qrcodeDiv);\n    }\n\n    const copyToClipboard = (text) => {\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        document.execCommand('copy');\n        document.body.removeChild(textarea);\n        alert(' Copied to clipboard:\\n\\n' +  text);\n    }\n\n    const applySettings = async (event, configForm) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const applyButton = document.getElementById('applyButton');\n        const getValue = (id) => parseInt(document.getElementById(id).value, 10);              \n        const lengthMin = getValue('fragmentLengthMin');\n        const lengthMax = getValue('fragmentLengthMax');\n        const intervalMin = getValue('fragmentIntervalMin');\n        const intervalMax = getValue('fragmentIntervalMax');\n        const customCdnAddrs = document.getElementById('customCdnAddrs').value?.split(',').filter(addr => addr !== '');\n        const customCdnHost = document.getElementById('customCdnHost').value;\n        const customCdnSni = document.getElementById('customCdnSni').value;\n        const isCustomCdn = customCdnAddrs.length || customCdnHost !== '' || customCdnSni !== '';\n        const warpEndpoints = document.getElementById('warpEndpoints').value?.replaceAll(' ', '').split(',');\n        const noiseCountMin = getValue('noiseCountMin');\n        const noiseCountMax = getValue('noiseCountMax');\n        const noiseSizeMin = getValue('noiseSizeMin');\n        const noiseSizeMax = getValue('noiseSizeMax');\n        const noiseDelayMin = getValue('noiseDelayMin');\n        const noiseDelayMax = getValue('noiseDelayMax');\n        const cleanIPs = document.getElementById('cleanIPs').value?.split(',');\n        const proxyIPs = document.getElementById('proxyIP').value?.split(',');\n        const chainProxy = document.getElementById('outProxy').value?.trim();\n        const customBypassRules = document.getElementById('customBypassRules').value?.split(',');                    \n        const customBlockRules = document.getElementById('customBlockRules').value?.split(',');                    \n        const formData = new FormData(configForm);\n        const is${atob("Vmxlc3M=")} = /${atob("dmxlc3M=")}:\\/\\/[^s@]+@[^\\s:]+:[^\\s]+/.test(chainProxy);\n        const isSocksHttp = /^(http|socks):\\/\\/(?:([^:@]+):([^:@]+)@)?([^:@]+):(\\d+)$/.test(chainProxy);\n        const hasSecurity = /security=/.test(chainProxy);\n        const securityRegex = /security=(tls|none|reality)/;\n        const validSecurityType = securityRegex.test(chainProxy);\n        let match = chainProxy.match(securityRegex);\n        const securityType = match ? match[1] : null;\n        match = chainProxy.match(/:(\\d+)\\?/);\n        const ${atob("dmxlc3M=")}Port = match ? match[1] : null;\n        const validTransmission = /type=(tcp|grpc|ws)/.test(chainProxy);\n        const validIPDomain = /^((?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,})|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)(?:\\/(?:\\d|[12]\\d|3[0-2]))?|\\[(?:(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}|(?:[a-fA-F0-9]{1,4}:){1,7}:|(?:[a-fA-F0-9]{1,4}:){1,6}:[a-fA-F0-9]{1,4}|(?:[a-fA-F0-9]{1,4}:){1,5}(?::[a-fA-F0-9]{1,4}){1,2}|(?:[a-fA-F0-9]{1,4}:){1,4}(?::[a-fA-F0-9]{1,4}){1,3}|(?:[a-fA-F0-9]{1,4}:){1,3}(?::[a-fA-F0-9]{1,4}){1,4}|(?:[a-fA-F0-9]{1,4}:){1,2}(?::[a-fA-F0-9]{1,4}){1,5}|[a-fA-F0-9]{1,4}:(?::[a-fA-F0-9]{1,4}){1,6}|:(?::[a-fA-F0-9]{1,4}){1,7})\\](?:\\/(?:12[0-8]|1[0-1]\\d|[0-9]?\\d))?)$/i;\n        const validEndpoint = /^(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|\\[(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,7}:\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,6}:[a-fA-F0-9]{1,4}\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,5}(?::[a-fA-F0-9]{1,4}){1,2}\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,4}(?::[a-fA-F0-9]{1,4}){1,3}\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,3}(?::[a-fA-F0-9]{1,4}){1,4}\\]|\\[(?:[a-fA-F0-9]{1,4}:){1,2}(?::[a-fA-F0-9]{1,4}){1,5}\\]|\\[[a-fA-F0-9]{1,4}:(?::[a-fA-F0-9]{1,4}){1,6}\\]|\\[:(?::[a-fA-F0-9]{1,4}){1,7}\\]|\\[::(?::[a-fA-F0-9]{1,4}){0,7}\\]):(?:[0-9]{1,5})$/;\n        const checkedPorts = Array.from(document.querySelectorAll('input[id^="port-"]:checked')).map(input => input.id.split('-')[1]);\n        formData.append('ports', checkedPorts);\n        configForm.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {\n            !formData.has(checkbox.name) && formData.append(checkbox.name, 'false');    \n        });\n        const base64Regex = /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;\n        const udpNoiseModes = formData.getAll('udpXrayNoiseMode') || [];\n        const udpNoisePackets = formData.getAll('udpXrayNoisePacket') || [];\n        const udpNoiseDelaysMin = formData.getAll('udpXrayNoiseDelayMin') || [];\n        const udpNoiseDelaysMax = formData.getAll('udpXrayNoiseDelayMax') || [];\n\n        const invalidIPs = [...cleanIPs, ...proxyIPs, ...customCdnAddrs, ...customBypassRules, ...customBlockRules, customCdnHost, customCdnSni]?.filter(value => {\n            if (value) {\n                const trimmedValue = value.trim();\n                return !validIPDomain.test(trimmedValue);\n            }\n        });\n\n        const invalidEndpoints = warpEndpoints?.filter(value => {\n            if (value) {\n                const trimmedValue = value.trim();\n                return !validEndpoint.test(trimmedValue);\n            }\n        });\n\n        if (invalidIPs.length) {\n            alert(' Invalid IPs or Domains \\n\\n' + invalidIPs.map(ip => ' ' + ip).join('\\n'));\n            return false;\n        }\n        \n        if (invalidEndpoints.length) {\n            alert(' Invalid endpoint \\n\\n' + invalidEndpoints.map(endpoint => ' ' + endpoint).join('\\n'));\n            return false;\n        }\n\n        if (lengthMin >= lengthMax || intervalMin > intervalMax || noiseCountMin > noiseCountMax || noiseSizeMin > noiseSizeMax || noiseDelayMin > noiseDelayMax) {\n            alert(' Minimum should be smaller or equal to Maximum! ');               \n            return false;\n        }\n\n        if (!(is${atob("Vmxlc3M=")} && (hasSecurity && validSecurityType || !hasSecurity) && validTransmission) && !isSocksHttp && chainProxy) {\n            alert(' Invalid Config!  \\n - The chain proxy should be ${atob("VkxFU1M=")}, Socks or Http!\\n - ${atob("VkxFU1M=")} transmission should be GRPC,WS or TCP\\n - ${atob("VkxFU1M=")} security should be TLS,Reality or None\\n - socks or http should be like:\\n + (socks or http)://user:pass@host:port\\n + (socks or http)://host:port');               \n            return false;\n        }\n\n        if (is${atob("Vmxlc3M=")} && securityType === 'tls' && ${atob("dmxlc3M=")}Port !== '443') {\n            alert(' ${atob("VkxFU1M=")} TLS port can be only 443 to be used as a proxy chain! ');               \n            return false;\n        }\n\n        if (isCustomCdn && !(customCdnAddrs.length && customCdnHost && customCdnSni)) {\n            alert(' All "Custom" fields should be filled or deleted together! ');               \n            return false;\n        }\n        \n        let submisionError = false;\n        for (const [index, mode] of udpNoiseModes.entries()) {\n            if (udpNoiseDelaysMin[index] > udpNoiseDelaysMax[index]) {\n                alert(' The minimum noise delay should be smaller or equal to maximum! ');\n                submisionError = true;\n                break;\n            }\n            \n            switch (mode) {\n                case 'base64':\n                    if (!base64Regex.test(udpNoisePackets[index])) {\n                        alert(' The Base64 noise packet is not a valid base64 value! ');\n                        submisionError = true;\n                    }\n                    break;\n\n                case 'rand':\n                    if (!(/^\\d+-\\d+$/.test(udpNoisePackets[index]))) {\n                        alert(' The Random noise packet should be a range like 0-10 or 10-30! ');\n                        submisionError = true;\n                    }\n                    const [min, max] = udpNoisePackets[index].split("-").map(Number);\n                    if (min > max) {\n                        alert(' The minimum Random noise packet should be smaller or equal to maximum! ');\n                        submisionError = true;\n                    }\n                    break;\n\n                case 'hex':\n                    if (!(/^(?=(?:[0-9A-Fa-f]{2})*$)[0-9A-Fa-f]+$/.test(udpNoisePackets[index]))) {\n                        alert(' The Hex noise packet is not a valid hex value! It should have even length and consisted of 0-9, a-f and A-F. ');\n                        submisionError = true;\n                    }\n                    break;\n            }\n        }\n        if (submisionError) return false;\n\n        try {\n            document.body.style.cursor = 'wait';\n            const applyButtonVal = applyButton.value;\n            applyButton.value = ' Loading...';\n\n            const response = await fetch('/panel', {\n                method: 'POST',\n                body: formData,\n                credentials: 'include'\n            });\n\n            document.body.style.cursor = 'default';\n            applyButton.value = applyButtonVal;\n\n            if (!response.ok) {\n                const errorMessage = await response.text();\n                console.error(errorMessage, response.status);\n                alert(' Session expired! Please login again.');\n                window.location.href = '/login';\n                return;\n            }                \n            alert(' Parameters applied successfully ');\n            window.location.reload();\n        } catch (error) {\n            console.error('Error:', error);\n        }\n    }\n\n    const logout = async (event) => {\n        event.preventDefault();\n\n        try {\n            const response = await fetch('/logout', {\n                method: 'GET',\n                credentials: 'same-origin'\n            });\n        \n            if (!response.ok) {\n                console.error('Failed to log out:', response.status);\n                return;\n            }\n            window.location.href = '/login';\n        } catch (error) {\n            console.error('Error:', error);\n        }\n    }\n\n    const resetPassword = async (event) => {\n        event.preventDefault();\n        const modal = document.getElementById('myModal');\n        const newPasswordInput = document.getElementById('newPassword');\n        const confirmPasswordInput = document.getElementById('confirmPassword');\n        const passwordError = document.getElementById('passwordError');             \n        const newPassword = newPasswordInput.value;\n        const confirmPassword = confirmPasswordInput.value;\n\n        if (newPassword !== confirmPassword) {\n            passwordError.textContent = "Passwords do not match";\n            return false;\n        }\n\n        const hasCapitalLetter = /[A-Z]/.test(newPassword);\n        const hasNumber = /[0-9]/.test(newPassword);\n        const isLongEnough = newPassword.length >= 8;\n\n        if (!(hasCapitalLetter && hasNumber && isLongEnough)) {\n            passwordError.textContent = ' Password must contain at least one capital letter, one number, and be at least 8 characters long.';\n            return false;\n        }\n                \n        try {\n            const response = await fetch('/panel/password', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'text/plain'\n                },\n                body: newPassword,\n                credentials: 'same-origin'\n            });\n        \n            if (response.ok) {\n                modal.style.display = "none";\n                document.body.style.overflow = "";\n                alert(" Password changed successfully! ");\n                window.location.href = '/login';\n            } else if (response.status === 401) {\n                const errorMessage = await response.text();\n                passwordError.textContent = ' ' + errorMessage;\n                console.error(errorMessage, response.status);\n                alert(' Session expired! Please login again.');\n                window.location.href = '/login';\n            } else {\n                const errorMessage = await response.text();\n                passwordError.textContent = ' ' + errorMessage;\n                console.error(errorMessage, response.status);\n                return false;\n            }\n        } catch (error) {\n            console.error('Error:', error);\n        }\n    }`,Kt=`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <meta name="timestamp" content=${Date.now()}>\n        <title>${atob("QlBC")} Panel ${globalThis.panelVersion}</title>\n        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">\n        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />\n        <title>Collapsible Sections</title>\n        <style>\n            ${It}\n        </style>\n    </head>\n    <body>\n        <h1>${atob("QlBC")} Panel <span style="font-size: smaller;">${globalThis.panelVersion}</span> </h1>\n        <div class="form-container">\n            <form id="configForm">\n                <details open>\n                    <summary><h2>${atob("VkxFU1M=")} - ${atob("VFJPSkFO")} </h2></summary>\n                    <div class="form-control">\n                        <label for="remoteDNS"> Remote DNS</label>\n                        <input type="url" id="remoteDNS" name="remoteDNS" value="${a}" required>\n                    </div>\n                    <div class="form-control">\n                        <label for="localDNS"> Local DNS</label>\n                        <input type="text" id="localDNS" name="localDNS" value="${n}"\n                            pattern="^(localhost|(?:\\d{1,3}\\.){3}\\d{1,3})$"\n                            title="Please enter a valid DNS IP Address!"  required>\n                    </div>\n                    <div class="form-control">\n                        <label for="VLTRFakeDNS"> Fake DNS</label>\n                        <div class="input-with-select">\n                            <select id="VLTRFakeDNS" name="VLTRFakeDNS">\n                                <option value="true" ${l?"selected":""}>Enabled</option>\n                                <option value="false" ${l?"":"selected"}>Disabled</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="proxyIP"> Proxy IPs / Domains</label>\n                        <input type="text" id="proxyIP" name="proxyIP" value="${h.replaceAll(","," , ")}">\n                    </div>\n                    <div class="form-control">\n                        <label for="outProxy"> Chain Proxy</label>\n                        <input type="text" id="outProxy" name="outProxy" value="${d}">\n                    </div>\n                    <div class="form-control">\n                        <label for="cleanIPs"> Clean IPs / Domains</label>\n                        <input type="text" id="cleanIPs" name="cleanIPs" value="${v.replaceAll(","," , ")}">\n                    </div>\n                    <div class="form-control">\n                        <label for="scanner"> Clean IP Scanner</label>\n                        <a href="https://github.com/bia-pain-bache/Cloudflare-Clean-IP-Scanner/releases/tag/v2.2.5" name="scanner" target="_blank" style="width: 100%;">\n                            <button type="button" id="scanner" class="button">\n                                Download Scanner\n                                <span class="material-symbols-outlined">open_in_new</span>\n                            </button>\n                        </a>\n                    </div>\n                    <div class="form-control">\n                        <label for="enableIPv6"> IPv6</label>\n                        <div class="input-with-select">\n                            <select id="enableIPv6" name="enableIPv6">\n                                <option value="true" ${p?"selected":""}>Enabled</option>\n                                <option value="false" ${p?"":"selected"}>Disabled</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="customCdnAddrs"> Custom CDN Addrs</label>\n                        <input type="text" id="customCdnAddrs" name="customCdnAddrs" value="${g.replaceAll(","," , ")}">\n                    </div>\n                    <div class="form-control">\n                        <label for="customCdnHost"> Custom CDN Host</label> \n                        <input type="text" id="customCdnHost" name="customCdnHost" value="${y}">\n                    </div>\n                    <div class="form-control">\n                        <label for="customCdnSni"> Custom CDN SNI</label>\n                        <input type="text" id="customCdnSni" name="customCdnSni" value="${w}">\n                    </div>\n                    <div class="form-control">\n                        <label for="bestVLTRInterval"> Best Interval</label>\n                        <input type="number" id="bestVLTRInterval" name="bestVLTRInterval" min="10" max="90" value="${_}">\n                    </div>\n                    <div class="form-control" style="padding-top: 10px;">\n                        <label for="VLConfigs"> Protocols</label>\n                        <div style="width: 100%; display: grid; grid-template-columns: 1fr 1fr; align-items: baseline; margin-top: 10px;">\n                            <div style = "display: flex; justify-content: center; align-items: center;">\n                                <input type="checkbox" id="VLConfigs" name="VLConfigs" onchange="handleProtocolChange(event)" value="true" ${k?"checked":""}>\n                                <label for="VLConfigs" style="margin: 0 5px; font-weight: normal; font-size: unset;">${atob("VkxFU1M=")}</label>\n                            </div>\n                            <div style = "display: flex; justify-content: center; align-items: center;">\n                                <input type="checkbox" id="TRConfigs" name="TRConfigs" onchange="handleProtocolChange(event)" value="true" ${M?"checked":""}>\n                                <label for="TRConfigs" style="margin: 0 5px; font-weight: normal; font-size: unset;">${atob("VHJvamFu")}</label>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="table-container">\n                        <table id="ports-block">\n                            <tr>\n                                <th style="text-wrap: nowrap; background-color: gray;">Config type</th>\n                                <th style="text-wrap: nowrap; background-color: gray;">Ports</th>\n                            </tr>\n                            <tr>\n                                <td style="text-align: center; font-size: larger;"><b>TLS</b></td>\n                                <td>\n                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr;">${Ht}</div>\n                                </td>    \n                            </tr>\n                            ${xt?`<tr>\n                                <td style="text-align: center; font-size: larger;"><b>Non TLS</b></td>\n                                <td>\n                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr;">${xt}</div>\n                                </td>    \n                            </tr>`:""}        \n                        </table>\n                    </div>\n                </details>\n                <details>\n                    <summary><h2>FRAGMENT </h2></summary>\t\n                    <div class="form-control">\n                        <label for="fragmentLengthMin"> Length</label>\n                        <div class="min-max">\n                            <input type="number" id="fragmentLengthMin" name="fragmentLengthMin" value="${V}" min="10" required>\n                            <span> - </span>\n                            <input type="number" id="fragmentLengthMax" name="fragmentLengthMax" value="${W}" max="500" required>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="fragmentIntervalMin"> Interval</label>\n                        <div class="min-max">\n                            <input type="number" id="fragmentIntervalMin" name="fragmentIntervalMin"\n                                value="${B}" min="1" max="30" required>\n                            <span> - </span>\n                            <input type="number" id="fragmentIntervalMax" name="fragmentIntervalMax"\n                                value="${H}" min="1" max="30" required>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="fragmentPackets"> Packets</label>\n                        <div class="input-with-select">\n                            <select id="fragmentPackets" name="fragmentPackets">\n                                <option value="tlshello" ${X==="tlshello"?"selected":""}>tlshello</option>\n                                <option value="1-1" ${X==="1-1"?"selected":""}>1-1</option>\n                                <option value="1-2" ${X==="1-2"?"selected":""}>1-2</option>\n                                <option value="1-3" ${X==="1-3"?"selected":""}>1-3</option>\n                                <option value="1-5" ${X==="1-5"?"selected":""}>1-5</option>\n                            </select>\n                        </div>\n                    </div>\n                </details>\n                <details>\n                    <summary><h2>WARP GENERAL </h2></summary>\n                    <div class="form-control">\n                        <label for="warpEndpoints"> Endpoints</label>\n                        <input type="text" id="warpEndpoints" name="warpEndpoints" value="${K.replaceAll(","," , ")}" required>\n                    </div>\n                    <div class="form-control">\n                        <label for="endpointScanner" style="line-height: 1.5;"> Scan Endpoint</label>\n                        <button type="button" id="endpointScanner" class="button" style="padding: 10px 0;" onclick="copyToClipboard('bash <(curl -fsSL https://raw.githubusercontent.com/bia-pain-bache/warp-script/refs/heads/main/endip/install.sh)', false)">\n                            Copy Script<span class="material-symbols-outlined">terminal</span>\n                        </button>\n                    </div>\n                    <div class="form-control">\n                        <label for="warpFakeDNS"> Fake DNS</label>\n                        <div class="input-with-select">\n                            <select id="warpFakeDNS" name="warpFakeDNS">\n                                <option value="true" ${x?"selected":""}>Enabled</option>\n                                <option value="false" ${x?"":"selected"}>Disabled</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="warpEnableIPv6"> IPv6</label>\n                        <div class="input-with-select">\n                            <select id="warpEnableIPv6" name="warpEnableIPv6">\n                                <option value="true" ${A?"selected":""}>Enabled</option>\n                                <option value="false" ${A?"":"selected"}>Disabled</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="refreshBtn"> Warp Configs</label>\n                        <button id="refreshBtn" type="button" class="button" style="padding: 10px 0;" onclick="getWarpConfigs()">\n                            Update<span class="material-symbols-outlined">autorenew</span>\n                        </button>\n                    </div>\n                    <div class="form-control">\n                        <label for="bestWarpInterval"> Best Interval</label>\n                        <input type="number" id="bestWarpInterval" name="bestWarpInterval" min="10" max="90" value="${D}">\n                    </div>\n                </details>\n                <details>\n                    <summary><h2>WARP PRO </h2></summary>\n                    <div class="header-container">\n                        <h3 style="margin: 0 5px;">V2RAYNG - V2RAYN</h3>\n                        <button type="button" id="add-udp-noise" onclick="addUdpNoise()" style="background: none; margin: 0; border: none; cursor: pointer;">\n                            <i class="fa fa-plus-circle fa-2x" style="color: var(--button-color);" aria-hidden="true"></i>\n                        </button>       \n                    </div>\n                    <div id="udp-noise-container">\n                        ${or}\n                    </div>\n                    <h3>MAHSANG - NIKANG - HIDDIFY </h3>\n                    <div class="form-control">\n                        <label for="hiddifyNoiseMode"> Hiddify Mode</label>\n                        <input type="text" id="hiddifyNoiseMode" name="hiddifyNoiseMode" \n                            pattern="^(m[1-6]|h_[0-9A-Fa-f]{2}|g_([0-9A-Fa-f]{2}_){2}[0-9A-Fa-f]{2})$" \n                            title="Enter 'm1-m6', 'h_HEX', 'g_HEX_HEX_HEX' which HEX can be between 00 to ff"\n                            value="${L}" required>\n                    </div>\n                    <div class="form-control">\n                        <label for="nikaNGNoiseMode"> NikaNG Mode</label>\n                        <input type="text" id="nikaNGNoiseMode" name="nikaNGNoiseMode" \n                            pattern="^(none|quic|random|[0-9A-Fa-f]+)$" \n                            title="Enter 'none', 'quic', 'random', or any HEX string like 'ee0000000108aaaa'"\n                            value="${R}" required>\n                    </div>\n                    <div class="form-control">\n                        <label for="noiseCountMin"> Noise Count</label>\n                        <div class="min-max">\n                            <input type="number" id="noiseCountMin" name="noiseCountMin"\n                                value="${J}" min="1" required>\n                            <span> - </span>\n                            <input type="number" id="noiseCountMax" name="noiseCountMax"\n                                value="${P}" min="1" required>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="noiseSizeMin"> Noise Size</label>\n                        <div class="min-max">\n                            <input type="number" id="noiseSizeMin" name="noiseSizeMin"\n                                value="${F}" min="1" required>\n                            <span> - </span>\n                            <input type="number" id="noiseSizeMax" name="noiseSizeMax"\n                                value="${Y}" min="1" required>\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="noiseDelayMin"> Noise Delay</label>\n                        <div class="min-max">\n                            <input type="number" id="noiseDelayMin" name="noiseDelayMin"\n                                value="${se}" min="1" required>\n                            <span> - </span>\n                            <input type="number" id="noiseDelayMax" name="noiseDelayMax"\n                                value="${ie}" min="1" required>\n                        </div>\n                    </div>\n                    <h3>CLASH - AMNEZIA </h3>\n                    <div class="form-control">\n                        <label for="amneziaNoiseCount"> Noise Count</label>\n                        <input type="number" id="amneziaNoiseCount" name="amneziaNoiseCount"\n                            value="${Se}" min="1" required>\n                    </div>\n                    <div class="form-control">\n                        <label for="amneziaNoiseSizeMin"> Noise Size</label>\n                        <div class="min-max">\n                            <input type="number" id="amneziaNoiseSizeMin" name="amneziaNoiseSizeMin"\n                                value="${te}" min="1" required>\n                            <span> - </span>\n                            <input type="number" id="amneziaNoiseSizeMax" name="amneziaNoiseSizeMax"\n                                value="${fe}" min="1" required>\n                        </div>\n                    </div>\n                </details>\n                <details>\n                    <summary><h2>ROUTING RULES </h2></summary>\n                    <div id="routing-rules" class="form-control" style="margin-bottom: 20px;">\t\t\t\n                        <div class="routing">\n                            <input type="checkbox" id="bypass-lan" name="bypass-lan" value="true" ${me?"checked":""}>\n                            <label for="bypass-lan">Bypass LAN</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="block-ads" name="block-ads" value="true" ${Fe?"checked":""}>\n                            <label for="block-ads">Block Ads.</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="bypass-iran" name="bypass-iran" value="true" ${xe?"checked":""}>\n                            <label for="bypass-iran">Bypass Iran</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="block-porn" name="block-porn" value="true" ${_t?"checked":""}>\n                            <label for="block-porn">Block Porn</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="bypass-china" name="bypass-china" value="true" ${ke?"checked":""}>\n                            <label for="bypass-china">Bypass China</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="block-udp-443" name="block-udp-443" value="true" ${$t?"checked":""}>\n                            <label for="block-udp-443">Block QUIC</label>\n                        </div>\n                        <div class="routing">\n                            <input type="checkbox" id="bypass-russia" name="bypass-russia" value="true" ${ne?"checked":""}>\n                            <label for="bypass-russia">Bypass Russia</label>\n                        </div>\n                    </div>\n                    <h3>CUSTOM RULES </h3>\n                    <div class="form-control">\n                        <label for="customBypassRules"> Bypass IPs / Domains</label>\n                        <input type="text" id="customBypassRules" name="customBypassRules" value="${ft.replaceAll(","," , ")}">\n                    </div>\n                    <div class="form-control">\n                        <label for="customBlockRules"> Block IPs / Domains</label>\n                        <input type="text" id="customBlockRules" name="customBlockRules" value="${dt.replaceAll(","," , ")}">\n                    </div>\n                </details>\n                <div id="apply" class="form-control">\n                    <div style="grid-column: 2; width: 100%; display: flex; justify-content: center; gap: 10px;">\n                        <input type="submit" id="applyButton" style="margin-right: 10px;" class="button disabled" value="APPLY SETTINGS " form="configForm">\n                        <button type="button" id="resetSettings" style="background: none; margin: 0; border: none; cursor: pointer; width: max-content;">\n                            <i class="fa fa-refresh fa-2x fa-border" style="border-radius: .2em; border-color: var(--border-color);" aria-hidden="true"></i>\n                        </button>\n                    </div>\n                </div>\n            </form>\n            <hr>            \n            <h2> NORMAL SUB</h2>\n            <div class="table-container">\n                <table id="normal-configs-table">\n                    <tr>\n                        <th>Application</th>\n                        <th>Subscription</th>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["v2rayNG","NikaNG","MahsaNG","v2rayN","v2rayN-PRO","Shadowrocket","Streisand","Hiddify"])}\n                        </td>\n                        <td>\n                            ${Ke("sub","",`${atob("QlBC")}-Normal`,"Normal Subscription")}\n                            ${ze("sub","",`${atob("QlBC")}-Normal`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["husi","Nekobox","Nekoray","Karing"])}\n                        </td>\n                        <td>\n                            ${Ke("sub","singbox",`${atob("QlBC")}-Normal`,"Normal Subscription",!0)}\n                            ${ze("sub","singbox",`${atob("QlBC")}-Normal`)}\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <h2> FULL NORMAL SUB</h2>\n            <div class="table-container">\n                <table id="full-normal-configs-table">\n                    <tr>\n                        <th>Application</th>\n                        <th>Subscription</th>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["v2rayNG","NikaNG","MahsaNG","v2rayN","v2rayN-PRO","Streisand"])}\n                        </td>\n                        <td>\n                            ${Ke("sub","xray",`${atob("QlBC")}-Full-Normal`,"Full normal Subscription")}\n                            ${ze("sub","xray",`${atob("QlBC")}-Full-Normal`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["sing-box","v2rayN (sing-box)"])}\n                        </td>\n                        <td>\n                            ${Ke("sub","sfa",`${atob("QlBC")}-Full-Normal`,"Full normal Subscription",!0)}\n                            ${ze("sub","sfa",`${atob("QlBC")}-Full-Normal`)}\n                            ${et("sub","sfa")}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Clash Meta","Clash Verge","FlClash","Stash","v2rayN (mihomo)"])}\n                        </td>\n                        <td>\n                            ${Ke("sub","clash",`${atob("QlBC")}-Full-Normal`,"Full normal Subscription")}\n                            ${ze("sub","clash",`${atob("QlBC")}-Full-Normal`)}\n                            ${et("sub","clash")}\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <h2> FRAGMENT SUB</h2>\n            <div class="table-container">\n                <table id="frag-sub-table">\n                    <tr>\n                        <th style="text-wrap: nowrap;">Application</th>\n                        <th style="text-wrap: nowrap;">Subscription</th>\n                    </tr>\n                    <tr>\n                        <td style="text-wrap: nowrap;">\n                            ${Oe(["v2rayNG","NikaNG","MahsaNG","v2rayN","v2rayN-PRO","Streisand"])}\n                        </td>\n                        <td>\n                            ${Ke("fragsub","",`${atob("QlBC")}-Fragment`,"Fragment Subscription")}\n                            ${ze("fragsub","",`${atob("QlBC")}-Fragment`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style="text-wrap: nowrap;">\n                            ${Oe(["Hiddify"])}\n                        </td>\n                        <td>\n                            ${Ke("fragsub","hiddify-frag",`${atob("QlBC")}-Fragment`,"Fragment Subscription",!1,!0)}\n                            ${ze("fragsub","hiddify-frag",`${atob("QlBC")}-Fragment`,!0)}\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <h2> WARP SUB</h2>\n            <div class="table-container">\n                <table id="normal-configs-table">\n                    <tr>\n                        <th>Application</th>\n                        <th>Subscription</th>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["v2rayNG","v2rayN","Streisand"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","xray",`${atob("QlBC")}-Warp`,"Warp Subscription")}\n                            ${ze("warpsub","xray",`${atob("QlBC")}-Warp`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["sing-box","v2rayN (sing-box)"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","singbox",`${atob("QlBC")}-Warp`,"Warp Subscription",!0)}\n                            ${ze("warpsub","singbox",`${atob("QlBC")}-Warp`)}\n                            ${et("sub","singbox")}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Hiddify"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","hiddify",`${atob("QlBC")}-Warp`,"Warp Subscription",!1,!0)}\n                            ${ze("warpsub","hiddify",`${atob("QlBC")}-Warp`,!0)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Clash Meta","Clash Verge","FlClash","Stash","v2rayN (mihomo)"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","clash",`${atob("QlBC")}-Warp`,"Warp Subscription")}\n                            ${ze("warpsub","clash",`${atob("QlBC")}-Warp`)}\n                            ${et("warpsub","clash")}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Wireguard"])}\n                        </td>\n                        <td>\n                            <button id="dlConfigsBtn" type="button" onclick="downloadWarpConfigs()">\n                                Download<span class="material-symbols-outlined">download</span>\n                            </button>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <h2> WARP PRO SUB</h2>\n            <div class="table-container">\n                <table id="warp-pro-configs-table">\n                    <tr>\n                        <th>Application</th>\n                        <th>Subscription</th>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["v2rayNG","v2rayN","Streisand"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","xray-pro",`${atob("QlBC")}-Warp-Pro`,"Warp Pro Subscription")}\n                            ${ze("warpsub","xray-pro",`${atob("QlBC")}-Warp-Pro`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["NikaNG","MahsaNG","v2rayN-PRO"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","nikang",`${atob("QlBC")}-Warp-Pro`,"Warp Pro Subscription")}\n                            ${ze("warpsub","nikang",`${atob("QlBC")}-Warp-Pro`)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Clash Meta","Clash Verge","FlClash","Stash","v2rayN (mihomo)"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","clash-pro",`${atob("QlBC")}-Warp-Pro`,"Warp Pro Subscription")}\n                            ${ze("warpsub","clash-pro",`${atob("QlBC")}-Warp-Pro`)}\n                            ${et("warpsub","clash-pro")}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Hiddify"])}\n                        </td>\n                        <td>\n                            ${Ke("warpsub","hiddify-pro",`${atob("QlBC")}-Warp-Pro`,"Warp Pro Subscription",!1,!0)}\n                            ${ze("warpsub","hiddify-pro",`${atob("QlBC")}-Warp-Pro`,!0)}\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            ${Oe(["Amnezia","WG Tunnel"])}\n                        </td>\n                        <td>\n                            <button id="dlAmneziaConfigsBtn" type="button" onclick="downloadWarpConfigs('amnezia')">\n                                Download<span class="material-symbols-outlined">download</span>\n                            </button>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <div id="myModal" class="modal">\n                <div class="modal-content">\n                    <span class="close">&times;</span>\n                    <form id="passwordChangeForm">\n                        <h2>Change Password</h2>\n                        <div class="form-control">\n                            <label for="newPassword">New Password</label>\n                            <input type="password" id="newPassword" name="newPassword" required>\n                            </div>\n                        <div class="form-control">\n                            <label for="confirmPassword">Confirm Password</label>\n                            <input type="password" id="confirmPassword" name="confirmPassword" required>\n                        </div>\n                        <div id="passwordError" style="color: red; margin-bottom: 10px;"></div>\n                        <button id="changePasswordBtn" type="submit" class="button">Change Password</button>\n                    </form>\n                </div>\n            </div>\n            <div id="myQRModal" class="modalQR">\n                <div class="modal-content" style="width: auto; text-align: center;">\n                    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 10px;">\n                        <span id="closeQRModal" class="close" style="align-self: flex-end;">&times;</span>\n                        <span id="qrcodeTitle" style="align-self: center; font-weight: bold;"></span>\n                    </div>\n                    <div id="qrcode-container"></div>\n                </div>\n            </div>\n            <hr>\n            <div class="header-container">\n                <h2 style="margin: 0 5px;"> MY IP</h2>\n                <button type="button" id="refresh-geo-location" onclick="fetchIPInfo()" style="background: none; margin: 0; border: none; cursor: pointer;">\n                    <i class="fa fa-refresh fa-2x" style="color: var(--button-color);" aria-hidden="true"></i>\n                </button>       \n            </div>\n            <div class="table-container">\n                <table id="ips" style="text-align: center; margin-bottom: 15px; text-wrap-mode: nowrap;">\n                    <tr>\n                        <th>Target Address</th>\n                        <th>IP</th>\n                        <th>Country</th>\n                        <th>City</th>\n                        <th>ISP</th>\n                    </tr>\n                    <tr>\n                        <td>Cloudflare CDN</td>\n                        <td id="cf-ip"></td>\n                        <td><b id="cf-country"></b></td>\n                        <td><b id="cf-city"></b></td>\n                        <td><b id="cf-isp"></b></td>\n                    </tr>\n                    <tr>\n                        <td>Others</td>\n                        <td id="ip"></td>\n                        <td><b id="country"></b></td>\n                        <td><b id="city"></b></td>\n                        <td><b id="isp"></b></td>\n                    </tr>\n                </table>\n            </div>\n            <hr>\n            <div class="footer">\n                <i class="fa fa-github" style="font-size:36px; margin-right: 10px;"></i>\n                <a class="link" href="https://github.com/bia-pain-bache/${atob("QlBC")}-Worker-Panel" style="color: var(--color); text-decoration: underline;" target="_blank">Github</a>\n                <button id="openModalBtn" class="button">Change Password</button>\n                <button type="button" id="logout" style="background: none; color: var(--color); margin: 0; border: none; cursor: pointer;">\n                    <i class="fa fa-power-off fa-2x" aria-hidden="true"></i>\n                </button>\n            </div>\n        </div>\n        <button id="darkModeToggle" class="floating-button">\n            <i id="modeIcon" class="fa fa-2x fa-adjust" style="color: var(--background-color);" aria-hidden="true"></i>\n        </button>\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"><\/script>\n    <script type="module" defer>\n        import { polyfillCountryFlagEmojis } from "https://cdn.skypack.dev/country-flag-emoji-polyfill";\n        polyfillCountryFlagEmojis();\n    <\/script>\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>\n    <script>\n        ${ar}\n    <\/script>\n    </body>\t\n    </html>`;return new Response(Kt,{status:200,headers:{"Content-Type":"text/html;charset=utf-8","Access-Control-Allow-Origin":globalThis.urlOrigin,"Access-Control-Allow-Methods":"GET, POST","Access-Control-Allow-Headers":"Content-Type, Authorization","X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","Referrer-Policy":"strict-origin-when-cross-origin","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate, no-transform","CDN-Cache-Control":"no-store"}})}f(Fo,"renderHomePage");function Pr(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}f(Pr,"isValidUUID");async function tr(t){let r="https://cloudflare-dns.com/dns-query",a=`${r}?name=${encodeURIComponent(t)}&type=A`,n=`${r}?name=${encodeURIComponent(t)}&type=AAAA`;try{let[l,h]=await Promise.all([fetch(a,{headers:{accept:"application/dns-json"}}),fetch(n,{headers:{accept:"application/dns-json"}})]),d=await l.json(),v=await h.json(),p=d.Answer?d.Answer.map((y=>y.data)):[],g=v.Answer?v.Answer.map((y=>y.data)):[];return{ipv4:p,ipv6:g}}catch(l){throw console.error("Error resolving DNS:",l),new Error(`An error occurred while resolving DNS - ${l}`)}}f(tr,"resolveDNS");function Me(t){return/^(?!\-)(?:[A-Za-z0-9\-]{1,63}\.)+[A-Za-z]{2,}$/.test(t)}f(Me,"isDomain");async function Uo(t,r){let a=await kt(t,r);if(t.method==="POST")return a?(await Cr(t,r),new Response("Success",{status:200})):new Response("Unauthorized or expired session!",{status:401});let{proxySettings:n}=await Qe(t,r),l=await r.kv.get("pwd");if(l&&!a)return Response.redirect(`${globalThis.urlOrigin}/login`,302);let h=l?.length>=8;return await Fo(n,h)}f(Uo,"handlePanel");async function Bo(t){let r=new URL(t.url);r.hostname=globalThis.fallbackDomain,r.protocol="https:";let a=new Request(r.toString(),{method:t.method,headers:t.headers,body:t.body,redirect:"manual"});return await fetch(a)}f(Bo,"fallback");async function Wo(t){let r=await t.text();try{let n=await(await fetch(`http://ip-api.com/json/${r}?nocache=${Date.now()}`)).json();return new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8"}})}catch(a){console.error("Error fetching IP address:",a)}}f(Wo,"getMyIP");async function eo(t,r,a){if(!await kt(t,r))return new Response("Unauthorized or expired session!",{status:401});let{warpConfigs:l,proxySettings:h}=await Qe(t,r),{warpEndpoints:d,amneziaNoiseCount:v,amneziaNoiseSizeMin:p,amneziaNoiseSizeMax:g}=h,y=yt(l,!1),{warpIPv6:w,publicKey:_,privateKey:k}=y,M=[],z=f((W=>W.split(`\n`).map((B=>B.trim())).join(`\n`)),"trimLines"),V=a?z(`Jc = ${v}\n        Jmin = ${p}\n        Jmax = ${g}\n        S1 = 0\n        S2 = 0\n        H1 = 0\n        H2 = 0\n        H3 = 0\n        H4 = 0`):"";return d.split(",").forEach((W=>{M.push(z(`[Interface]\n            PrivateKey = ${k}\n            Address = 172.16.0.2/32, ${w}\n            DNS = 1.1.1.1, 1.0.0.1\n            MTU = 1280\n            ${V}\n            [Peer]\n            PublicKey = ${_}\n            AllowedIPs = 0.0.0.0/0, ::/0\n            Endpoint = ${W}\n            PersistentKeepalive = 25`))})),new Response(JSON.stringify(M),{status:200,headers:{"Content-Type":"application/json"}})}f(eo,"getWarpConfigFiles");function Lo(t,r){let a=r.PROXYIP?.split(",").map((h=>h.trim())),n=new URL(t.url),l=new URLSearchParams(n.search);if(globalThis.panelVersion="3.1.3",globalThis.defaultHttpPorts=["80","8080","2052","2082","2086","2095","8880"],globalThis.defaultHttpsPorts=["443","8443","2053","2083","2087","2096"],globalThis.userID=r.UUID,globalThis.TRPassword=r.TR_PASS,globalThis.proxyIP=a?a[Math.floor(Math.random()*a.length)]:atob("YnBiLnlvdXNlZi5pc2VnYXJvLmNvbQ=="),globalThis.hostName=t.headers.get("Host"),globalThis.pathName=n.pathname,globalThis.client=l.get("app"),globalThis.urlOrigin=n.origin,globalThis.dohURL=r.DOH_URL||"https://cloudflare-dns.com/dns-query",globalThis.fallbackDomain=r.FALLBACK||"speed.cloudflare.com",globalThis.subPath=r.SUB_PATH||userID,pathName!=="/secrets"){if(!userID||!globalThis.TRPassword)throw new Error(`Please set UUID and ${atob("VHJvamFu")} password first. Please visit <a href="https://${hostName}/secrets" target="_blank">here</a> to generate them.`,{cause:"init"});if(userID&&!Pr(userID))throw new Error(`Invalid UUID: ${userID}`,{cause:"init"});if(typeof r.kv!="object")throw new Error("KV Dataset is not properly set! Please refer to tutorials.",{cause:"init"})}}f(Lo,"initializeParams");import{connect as za}from"cloudflare:sockets";async function Ko(t){let r=new WebSocketPair,[a,n]=Object.values(r);n.accept();let l="",h="",d=f(((_,k)=>{console.log(`[${l}:${h}] ${_}`,k||"")}),"log"),v=t.headers.get("sec-websocket-protocol")||"",p=Ja(n,v,d),g={value:null},y=null,w=!1;return p.pipeTo(new WritableStream({async write(_,k){if(w&&y)return y(_);if(g.value){let A=g.value.writable.getWriter();await A.write(_),A.releaseLock();return}let{hasError:M,message:z,portRemote:V=443,addressRemote:W="",rawDataIndex:B,VLVersion:H=new Uint8Array([0,0]),isUDP:X}=await ja(_,globalThis.userID);if(l=W,h=`${V}--${Math.random()} ${X?"udp ":"tcp "} `,M)throw new Error(z);if(X)if(V===53)w=!0;else throw new Error("UDP proxy only enable for DNS which is port 53");let K=new Uint8Array([H[0],0]),x=_.slice(B);if(w){let{write:A}=await qa(n,K,d);y=A,y(x);return}Va(g,W,V,x,n,K,d)},close(){d("readableWebSocketStream is close")},abort(_){d("readableWebSocketStream is abort",JSON.stringify(_))}})).catch((_=>{d("readableWebSocketStream pipeTo error",_)})),new Response(null,{status:101,webSocket:a})}f(Ko,"VLOverWSHandler");async function Oo(t){try{let r=await getApiResponse();return r?r.users.some((n=>n.uuid===t)):!1}catch(r){return console.error("Error:",r),!1}}f(Oo,"checkUuidInApiResponse");async function Va(t,r,a,n,l,h,d){async function v(y,w){/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(y)&&(y=`${atob("d3d3Lg==")}${y}${atob("LnNzbGlwLmlv")}`);let _=za({hostname:y,port:w});t.value=_,d(`connected to ${y}:${w}`);let k=_.writable.getWriter();return await k.write(n),k.releaseLock(),_}f(v,"connectAndWrite");async function p(){let y=globalThis.pathName.split("/")[2],w=y?atob(y).split(","):void 0,_=w?w[Math.floor(Math.random()*w.length)]:globalThis.proxyIP||r,k=await v(_,a);k.closed.catch((M=>{console.log("retry tcpSocket closed error",M)})).finally((()=>{Er(l)})),Ho(k,l,h,null,d)}f(p,"retry");let g=await v(r,a);Ho(g,l,h,p,d)}f(Va,"handleTCPOutBound");function Ja(t,r,a){let n=!1;return new ReadableStream({start(h){t.addEventListener("message",(p=>{if(n)return;let g=p.data;h.enqueue(g)})),t.addEventListener("close",(()=>{Er(t),!n&&h.close()})),t.addEventListener("error",(p=>{a("webSocketServer has error"),h.error(p)}));let{earlyData:d,error:v}=Ga(r);v?h.error(v):d&&h.enqueue(d)},pull(h){},cancel(h){n||(a(`ReadableStream was canceled, due to ${h}`),n=!0,Er(t))}})}f(Ja,"makeReadableWebSocketStream");async function ja(t,r){if(t.byteLength<24)return{hasError:!0,message:"invalid data"};let a=new Uint8Array(t.slice(0,1)),n=!1,l=!1,h=new Uint8Array(t.slice(1,17)),d=Qa(h),v=r.includes(",")?r.split(","):[r],p=await Oo(d);if(n=v.some((X=>p||d===X.trim())),console.log(`checkUuidInApi: ${await Oo(d)}, userID: ${d}`),!n)return{hasError:!0,message:"invalid user"};let g=new Uint8Array(t.slice(17,18))[0],y=new Uint8Array(t.slice(18+g,18+g+1))[0];if(y!==1)if(y===2)l=!0;else return{hasError:!0,message:`command ${y} is not support, command 01-tcp,02-udp,03-mux`};let w=18+g+1,_=t.slice(w,w+2),k=new DataView(_).getUint16(0),M=w+2,V=new Uint8Array(t.slice(M,M+1))[0],W=0,B=M+1,H="";switch(V){case 1:W=4,H=new Uint8Array(t.slice(B,B+W)).join(".");break;case 2:W=new Uint8Array(t.slice(B,B+1))[0],B+=1,H=(new TextDecoder).decode(t.slice(B,B+W));break;case 3:W=16;let X=new DataView(t.slice(B,B+W)),K=[];for(let x=0;x<8;x++)K.push(X.getUint16(x*2).toString(16));H=K.join(":");break;default:return{hasError:!0,message:`invild  addressType is ${V}`}}return H?{hasError:!1,addressRemote:H,addressType:V,portRemote:k,rawDataIndex:B+W,VLVersion:a,isUDP:l}:{hasError:!0,message:`addressValue is empty, addressType is ${V}`}}f(ja,"processVLHeader");async function Ho(t,r,a,n,l){let h=0,d=[],v=a,p=!1;await t.readable.pipeTo(new WritableStream({start(){},async write(g,y){p=!0,r.readyState!==to&&y.error("webSocket.readyState is not open, maybe close"),v?(r.send(await new Blob([v,g]).arrayBuffer()),v=null):r.send(g)},close(){l(`remoteConnection!.readable is close with hasIncomingData is ${p}`)},abort(g){console.error("remoteConnection!.readable abort",g)}})).catch((g=>{console.error(`${atob("dmxlc3M=")}RemoteSocketToWS has exception `,g.stack||g),Er(r)})),p===!1&&n&&(l("retry"),n())}f(Ho,"VLRemoteSocketToWS");function Ga(t){if(!t)return{earlyData:null,error:null};try{t=t.replace(/-/g,"+").replace(/_/g,"/");let r=atob(t);return{earlyData:Uint8Array.from(r,(n=>n.charCodeAt(0))).buffer,error:null}}catch(r){return{earlyData:null,error:r}}}f(Ga,"base64ToArrayBuffer");var to=1,Ya=2;function Er(t){try{(t.readyState===to||t.readyState===Ya)&&t.close()}catch(r){console.error("safeCloseWebSocket error",r)}}f(Er,"safeCloseWebSocket");var Je=[];for(let t=0;t<256;++t)Je.push((t+256).toString(16).slice(1));function Xa(t,r=0){return(Je[t[r+0]]+Je[t[r+1]]+Je[t[r+2]]+Je[t[r+3]]+"-"+Je[t[r+4]]+Je[t[r+5]]+"-"+Je[t[r+6]]+Je[t[r+7]]+"-"+Je[t[r+8]]+Je[t[r+9]]+"-"+Je[t[r+10]]+Je[t[r+11]]+Je[t[r+12]]+Je[t[r+13]]+Je[t[r+14]]+Je[t[r+15]]).toLowerCase()}f(Xa,"unsafeStringify");function Qa(t,r=0){let a=Xa(t,r);if(!Pr(a))throw TypeError("Stringified UUID is invalid");return a}f(Qa,"stringify");async function qa(t,r,a){let n=!1,l=new TransformStream({start(d){},transform(d,v){for(let p=0;p<d.byteLength;){let g=d.slice(p,p+2),y=new DataView(g).getUint16(0),w=new Uint8Array(d.slice(p+2,p+2+y));p=p+2+y,v.enqueue(w)}},flush(d){}});l.readable.pipeTo(new WritableStream({async write(d){let p=await(await fetch(globalThis.dohURL,{method:"POST",headers:{"content-type":"application/dns-message"},body:d})).arrayBuffer(),g=p.byteLength,y=new Uint8Array([g>>8&255,g&255]);t.readyState===to&&(a(`doh success and dns message length is ${g}`),n?t.send(await new Blob([y,p]).arrayBuffer()):(t.send(await new Blob([r,y,p]).arrayBuffer()),n=!0))}})).catch((d=>{a("dns udp has error"+d)}));let h=l.writable.getWriter();return{write(d){h.write(d)}}}f(qa,"handleUDPOutBound");var jo=Nr(Vo());import{connect as Za}from"cloudflare:sockets";async function Go(t){let r=new WebSocketPair,[a,n]=Object.values(r);n.accept();let l="",h="",d=f(((w,_)=>{console.log(`[${l}:${h}] ${w}`,_||"")}),"log"),v=t.headers.get("sec-websocket-protocol")||"",p=rn(n,v,d),g={value:null},y=null;return p.pipeTo(new WritableStream({async write(w,_){if(y)return y(w);if(g.value){let B=g.value.writable.getWriter();await B.write(w),B.releaseLock();return}let{hasError:k,message:M,portRemote:z=443,addressRemote:V="",rawClientData:W}=await en(w);if(l=V,h=`${z}--${Math.random()} tcp`,k)throw new Error(M);tn(g,V,z,W,n,d)},close(){d("readableWebSocketStream is closed")},abort(w){d("readableWebSocketStream is aborted",JSON.stringify(w))}})).catch((w=>{d("readableWebSocketStream pipeTo error",w)})),new Response(null,{status:101,webSocket:a})}f(Go,"TROverWSHandler");async function en(t){if(t.byteLength<56)return{hasError:!0,message:"invalid data"};let r=56;if(new Uint8Array(t.slice(56,57))[0]!==13||new Uint8Array(t.slice(57,58))[0]!==10)return{hasError:!0,message:"invalid header format (missing CR LF)"};if((new TextDecoder).decode(t.slice(0,r))!==jo.default.sha224(globalThis.TRPassword))return{hasError:!0,message:"invalid password"};let n=t.slice(r+2);if(n.byteLength<6)return{hasError:!0,message:"invalid SOCKS5 request data"};let l=new DataView(n);if(l.getUint8(0)!==1)return{hasError:!0,message:"unsupported command, only TCP (CONNECT) is allowed"};let d=l.getUint8(1),v=0,p=2,g="";switch(d){case 1:v=4,g=new Uint8Array(n.slice(p,p+v)).join(".");break;case 3:v=new Uint8Array(n.slice(p,p+1))[0],p+=1,g=(new TextDecoder).decode(n.slice(p,p+v));break;case 4:v=16;let k=new DataView(n.slice(p,p+v)),M=[];for(let z=0;z<8;z++)M.push(k.getUint16(z*2).toString(16));g=M.join(":");break;default:return{hasError:!0,message:`invalid addressType is ${d}`}}if(!g)return{hasError:!0,message:`address is empty, addressType is ${d}`};let y=p+v,w=n.slice(y,y+2),_=new DataView(w).getUint16(0);return{hasError:!1,addressRemote:g,portRemote:_,rawClientData:n.slice(y+4)}}f(en,"parseTRHeader");async function tn(t,r,a,n,l,h){async function d(g,y){/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(g)&&(g=`${atob("d3d3Lg==")}${g}${atob("LnNzbGlwLmlv")}`);let w=Za({hostname:g,port:y});t.value=w,h(`connected to ${g}:${y}`);let _=w.writable.getWriter();return await _.write(n),_.releaseLock(),w}f(d,"connectAndWrite");async function v(){let g=globalThis.pathName.split("/")[2],y=g?atob(g).split(","):void 0,w=y?y[Math.floor(Math.random()*y.length)]:globalThis.proxyIP||r,_=await d(w,a);_.closed.catch((k=>{console.log("retry tcpSocket closed error",k)})).finally((()=>{kr(l)})),Jo(_,l,null,h)}f(v,"retry");let p=await d(r,a);Jo(p,l,v,h)}f(tn,"handleTCPOutBound");function rn(t,r,a){let n=!1;return new ReadableStream({start(h){t.addEventListener("message",(p=>{if(n)return;let g=p.data;h.enqueue(g)})),t.addEventListener("close",(()=>{kr(t),!n&&h.close()})),t.addEventListener("error",(p=>{a("webSocketServer has error"),h.error(p)}));let{earlyData:d,error:v}=on(r);v?h.error(v):d&&h.enqueue(d)},pull(h){},cancel(h){n||(a(`ReadableStream was canceled, due to ${h}`),n=!0,kr(t))}})}f(rn,"makeReadableWebSocketStream");async function Jo(t,r,a,n){let l=!1;await t.readable.pipeTo(new WritableStream({start(){},async write(h,d){l=!0,r.readyState!==Yo&&d.error("webSocket connection is not open"),r.send(h)},close(){n(`remoteSocket.readable is closed, hasIncomingData: ${l}`)},abort(h){console.error("remoteSocket.readable abort",h)}})).catch((h=>{console.error(`${atob("dHJvamFu")}RemoteSocketToWS error:`,h.stack||h),kr(r)})),l===!1&&a&&(n("retry"),a())}f(Jo,"TRRemoteSocketToWS");function on(t){if(!t)return{earlyData:null,error:null};try{t=t.replace(/-/g,"+").replace(/_/g,"/");let r=atob(t);return{earlyData:Uint8Array.from(r,(n=>n.charCodeAt(0))).buffer,error:null}}catch(r){return{earlyData:null,error:r}}}f(on,"base64ToArrayBuffer");var Yo=1,an=2;function kr(t){try{(t.readyState===Yo||t.readyState===an)&&t.close()}catch(r){console.error("safeCloseWebSocket error",r)}}f(kr,"safeCloseWebSocket");async function Xo(t){let r=`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>${atob("QlBC")} Error</title>\n        <style>\n            :root {\n                --color: black;\n                --header-color: #09639f; \n                --background-color: #fff;\n                --border-color: #ddd;\n                --header-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);\n            }\n            body, html {\n                height: 100%;\n                width: 100%;\n                margin: 0;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                font-family: system-ui;\n                color: var(--color);\n                background-color: var(--background-color);\n            }\n            body.dark-mode {\n                --color: white;\n                --header-color: #3498DB; \n                --background-color: #121212;\n                --header-shadow: 2px 2px 4px rgba(255, 255, 255, 0.25);          \n            }\n            h1 { font-size: 2.5rem; text-align: center; color: var(--header-color); text-shadow: var(--header-shadow); }\n            #error-container { text-align: center; }\n        </style>\n    </head>\n    <body>\n        <div id="error-container">\n            <h1>${atob("QlBC")} Panel <span style="font-size: smaller;">${globalThis.panelVersion}</span> </h1>\n            <div id="error-message">\n                <h2> Something went wrong!</h2>\n                <p><b>${t?` ${t.cause?t.message.toString():t.stack.toString()}`:""}</b></p>\n            </div>\n        </div>\n    <script>\n        localStorage.getItem('darkMode') === 'enabled' && document.body.classList.add('dark-mode');\n    <\/script>\n    </body>\n    </html>`;return new Response(r,{status:200,headers:{"Content-Type":"text/html"}})}f(Xo,"renderErrorPage");async function Ot(t,r,a,n,l){let{remoteDNS:h,localDNS:d,VLTRFakeDNS:v,enableIPv6:p,warpFakeDNS:g,warpEnableIPv6:y,blockAds:w,bypassIran:_,bypassChina:k,blockPorn:M,bypassRussia:z,customBypassRules:V,customBlockRules:W}=t,B=[{rule:_,domain:"geosite:category-ir",ip:"geoip:ir"},{rule:k,domain:"geosite:cn",ip:"geoip:cn"},{rule:z,domain:"geosite:category-ru",ip:"geoip:ru"}],H=[{rule:w,host:"geosite:category-ads-all"},{rule:w,host:"geosite:category-ads-ir"},{rule:M,host:"geosite:category-porn"}],X=v&&!l||g&&l,K=p&&!l||y&&l,x=r.filter((fe=>Me(fe))),A=V.split(",").filter((fe=>Me(fe))),D=W.split(",").filter((fe=>Me(fe))),E=[...new Set(x)],L=[...E,...A].length>0,R=_||k||z,J=w||M||D.length>0,P=n?["https://cloudflare-dns.com/dns-query"]:l?y?["1.1.1.1","1.0.0.1","2606:4700:4700::1111","2606:4700:4700::1001"]:["1.1.1.1","1.0.0.1"]:[h],F={};J&&(H.forEach((({rule:fe,host:me})=>{fe&&(F[me]=["127.0.0.1"])})),D.forEach((fe=>{F[`domain:${fe}`]=["127.0.0.1"]})));let Y=a?await tr(a):void 0;if(Y&&(F[a]=p?[...Y.ipv4,...Y.ipv6]:Y.ipv4),n){let fe=["cloudflare-dns.com","cloudflare.com","dash.cloudflare.com"],me=await Promise.all(fe.map(tr)),xe=me.flatMap((ne=>ne.ipv4)),ke=p?me.flatMap((ne=>ne.ipv6)):[];F["cloudflare-dns.com"]=[...xe,...ke]}let ie={...Object.keys(F).length?{hosts:F}:{},servers:P,queryStrategy:K?"UseIP":"UseIPv4",tag:"dns"},Se=Lt(h);if(Se.isHostDomain&&!n&&!l&&ie.servers.push({address:"https://8.8.8.8/dns-query",domains:[`full:${Se.host}`],skipFallback:!0}),L){let fe=E.map((xe=>`full:${xe}`)),me=A.map((xe=>`domain:${xe}`));ie.servers.push({address:d,domains:[...fe,...me],skipFallback:!0})}let te={address:d,domains:[],expectIPs:[],skipFallback:!0};if(!n&&R&&(B.forEach((({rule:fe,domain:me,ip:xe})=>{fe&&(te.domains.push(me),te.expectIPs.push(xe))})),ie.servers.push(te)),X){let fe=R&&!n?{address:"fakedns",domains:te.domains}:"fakedns";ie.servers.unshift(fe)}return ie}f(Ot,"buildXrayDNS");function vt(t,r,a,n,l){let{localDNS:h,bypassLAN:d,bypassIran:v,bypassChina:p,bypassRussia:g,blockAds:y,blockPorn:w,blockUDP443:_,customBypassRules:k,customBlockRules:M}=t,z=[{rule:d,type:"direct",domain:"geosite:private",ip:"geoip:private"},{rule:v,type:"direct",domain:"geosite:category-ir",ip:"geoip:ir"},{rule:p,type:"direct",domain:"geosite:cn",ip:"geoip:cn"},{rule:y,type:"block",domain:"geosite:category-ads-all"},{rule:y,type:"block",domain:"geosite:category-ads-ir"},{rule:w,type:"block",domain:"geosite:category-porn"}],V=r.filter((E=>Me(E))),W=k?k.split(","):[],B=M?M.split(","):[],H=W.filter((E=>Me(E))),X=[...V,...H].length>0,K=y||w||B.length>0,x=v||p||g||W.length>0,A=a?"chain":l?"fragment":"proxy",D=[{inboundTag:["dns-in"],outboundTag:"dns-out",type:"field"},{inboundTag:["socks-in"],port:"53",outboundTag:"dns-out",type:"field"}];if(!l&&(X||x)&&h!=="localhost"&&D.push({inboundTag:["dns"],ip:[h],port:"53",outboundTag:"direct",type:"field"}),l||D.push({inboundTag:["dns"],[n?"balancerTag":"outboundTag"]:n?"all":A,type:"field"}),_&&D.push({network:"udp",port:"443",outboundTag:"block",type:"field"}),x||K){let E=f(((F,Y)=>({[F]:[],outboundTag:Y,type:"field"})),"createRule"),L,R;l||(L=E("domain","direct"),R=E("ip","direct"));let J=E("domain","block"),P=E("ip","block");z.forEach((({rule:F,type:Y,domain:se,ip:ie})=>{F&&(Y==="direct"?(L?.domain.push(se),R?.ip?.push(ie)):J.domain.push(se))})),W.forEach((F=>{Me(F)?L?.domain.push(`domain:${F}`):R?.ip.push(F)})),B.forEach((F=>{Me(F)?J.domain.push(`domain:${F}`):P.ip.push(F)})),J.domain.length&&D.push(J),P.ip.length&&D.push(P),l||(L.domain.length&&D.push(L),R.ip.length&&D.push(R))}return n?D.push({network:"tcp,udp",balancerTag:"all",type:"field"}):D.push({network:"tcp,udp",outboundTag:A,type:"field"}),D}f(vt,"buildXrayRoutingRules");function qo(t,r,a,n,l,h,d,v,p){let{userID:g,defaultHttpsPorts:y}=globalThis,w={protocol:atob("dmxlc3M="),settings:{vnext:[{address:r,port:+a,users:[{id:g,encryption:"none",level:8}]}]},streamSettings:{network:"ws",security:"none",sockopt:{},wsSettings:{host:n,path:`/${nt(16)}${h?`/${btoa(h)}`:""}?ed=2560`}},tag:t};y.includes(a)&&(w.streamSettings.security="tls",w.streamSettings.tlsSettings={allowInsecure:v,fingerprint:"randomized",alpn:["http/1.1"],serverName:l});let _=w.streamSettings.sockopt;return d?_.dialerProxy="fragment":_.domainStrategy=p?"UseIPv4v6":"UseIPv4",w}f(qo,"buildXrayVLOutbound");function nn(t,r,a,n,l,h,d,v,p){let{TRPassword:g,defaultHttpsPorts:y}=globalThis,w={protocol:atob("dHJvamFu"),settings:{servers:[{address:r,port:+a,password:g,level:8}]},streamSettings:{network:"ws",security:"none",sockopt:{},wsSettings:{host:n,path:`/tr${nt(16)}${h?`/${btoa(h)}`:""}?ed=2560`}},tag:t};y.includes(a)&&(w.streamSettings.security="tls",w.streamSettings.tlsSettings={allowInsecure:v,fingerprint:"randomized",alpn:["http/1.1"],serverName:l});let _=w.streamSettings.sockopt;return d?_.dialerProxy="fragment":_.domainStrategy=p?"UseIPv4v6":"UseIPv4",w}f(nn,"buildXrayTROutbound");function Qo(t,r,a,n,l){let{nikaNGNoiseMode:h,noiseCountMin:d,noiseCountMax:v,noiseSizeMin:p,noiseSizeMax:g,noiseDelayMin:y,noiseDelayMax:w}=t,_=n==="proxy",{warpIPv6:k,reserved:M,publicKey:z,privateKey:V}=yt(r,_),W={protocol:"wireguard",settings:{address:["172.16.0.2/32",k],mtu:1280,peers:[{endpoint:_?"162.159.192.1:2408":a,publicKey:z,keepAlive:5}],reserved:vr(M),secretKey:V},streamSettings:{sockopt:{dialerProxy:n}},tag:_?"chain":"proxy"};return!n&&delete W.streamSettings,l==="nikang"&&!_&&delete W.streamSettings&&Object.assign(W.settings,{wnoise:h,wnoisecount:d===v?d:`${d}-${v}`,wpayloadsize:p===g?p:`${p}-${g}`,wnoisedelay:y===w?y:`${y}-${w}`}),W}f(Qo,"buildXrayWarpOutbound");function sn(t,r){if(["socks","http"].includes(t.protocol)){let{protocol:K,server:x,port:A,user:D,pass:E}=t;return{protocol:K,settings:{servers:[{address:x,port:+A,users:[{user:D,pass:E,level:8}]}]},streamSettings:{network:"tcp",sockopt:{dialerProxy:"proxy",domainStrategy:r?"UseIPv4v6":"UseIPv4"}},mux:{enabled:!0,concurrency:8,xudpConcurrency:16,xudpProxyUDP443:"reject"},tag:"chain"}}let{server:a,port:n,uuid:l,flow:h,security:d,type:v,sni:p,fp:g,alpn:y,pbk:w,sid:_,spx:k,headerType:M,host:z,path:V,authority:W,serviceName:B,mode:H}=t,X={mux:{concurrency:8,enabled:!0,xudpConcurrency:16,xudpProxyUDP443:"reject"},protocol:atob("dmxlc3M="),settings:{vnext:[{address:a,port:+n,users:[{encryption:"none",flow:h,id:l,level:8,security:"auto"}]}]},streamSettings:{network:v,security:d,sockopt:{dialerProxy:"proxy",domainStrategy:r?"UseIPv4v6":"UseIPv4"}},tag:"chain"};if(d==="tls"){let K=y?y?.split(","):[];X.streamSettings.tlsSettings={allowInsecure:!1,fingerprint:g,alpn:K,serverName:p}}if(d==="reality"&&(delete X.mux,X.streamSettings.realitySettings={fingerprint:g,publicKey:w,serverName:p,shortId:_,spiderX:k}),M==="http"){let K=V?.split(","),x=z?.split(",");X.streamSettings.tcpSettings={header:{request:{headers:{Host:x},method:"GET",path:K,version:"1.1"},response:{headers:{"Content-Type":["application/octet-stream"]},reason:"OK",status:"200",version:"1.1"},type:"http"}}}return v==="tcp"&&d!=="reality"&&!M&&(X.streamSettings.tcpSettings={header:{type:"none"}}),v==="ws"&&(X.streamSettings.wsSettings={headers:{Host:z},path:V}),v==="grpc"&&(delete X.mux,X.streamSettings.grpcSettings={authority:W,multiMode:H==="multi",serviceName:B}),X}f(sn,"buildXrayChainOutbound");function ro(t,r,a,n){let{xrayUdpNoises:l,fragmentPackets:h,lengthMin:d,lengthMax:v,intervalMin:p,intervalMax:g,enableIPv6:y,warpEnableIPv6:w}=t,_={tag:n,protocol:"freedom",settings:{}};return r&&(_.settings.fragment={packets:h,length:`${d}-${v}`,interval:`${p}-${g}`},_.settings.domainStrategy=y?"UseIPv4v6":"UseIPv4"),a&&(_.settings.noises=[],JSON.parse(l).forEach((k=>{let M=+k.count;delete k.count,_.settings.noises.push(...Array.from({length:M},(()=>k)))})),r||(_.settings.domainStrategy=w?"UseIPv4v6":"UseIPv4")),_}f(ro,"buildFreedomOutbound");function St(t,r,a,n,l,h){let{VLTRFakeDNS:d,warpFakeDNS:v,bestVLTRInterval:p,bestWarpInterval:g}=t,y=d&&!h||v&&h,w=structuredClone(dn);if(w.remarks=r,y&&w.inbounds[0].sniffing.destOverride.push("fakedns"),a){let _=h?g:p;w.observatory.probeInterval=`${_}s`,l&&(w.routing.balancers[0].fallbackTag="prox-2"),n&&(w.observatory.subjectSelector=["chain"],w.routing.balancers[0].selector=["chain"])}else delete w.observatory,delete w.routing.balancers;return w}f(St,"buildXrayConfig");async function cn(t,r,a,n,l){let h=l?` ${atob("QlBC")} F - Best Ping `:` ${atob("QlBC")} - Best Ping `,d=St(t,h,!0,a,!0);return d.dns=await Ot(t,r,void 0,!1,!1),d.routing.rules=vt(t,r,a,!0,!1),d.outbounds.unshift(...n),d}f(cn,"buildXrayBestPingConfig");async function ln(t,r,a,n){let l=["10-20","20-30","30-40","40-50","50-60","60-70","70-80","80-90","90-100","10-30","20-40","30-50","40-60","50-70","60-80","70-90","80-100","100-200"],h=St(t,` ${atob("QlBC")} F - Best Fragment `,!0,a,!1,!1);h.dns=await Ot(t,[],r,!1,!1),h.routing.rules=vt(t,[],a,!0,!1);let d=[],v=n.pop();return l.forEach(((p,g)=>{if(a){let _=structuredClone(a);_.tag=`chain-${g+1}`,_.streamSettings.sockopt.dialerProxy=`prox-${g+1}`,d.push(_)}let y=structuredClone(n[a?1:0]);y.tag=`prox-${g+1}`,y.streamSettings.sockopt.dialerProxy=`frag-${g+1}`;let w=structuredClone(v);w.tag=`frag-${g+1}`,w.settings.fragment.length=p,w.settings.fragment.interval="1-1",d.push(y,w)})),h.outbounds.unshift(...d),h}f(ln,"buildXrayBestFragmentConfig");async function fn(t){let r=St(t,` ${atob("QlBC")} F - WorkerLess `,!1,!1,!1,!1),a=ro(t,!0,!0,"fragment");r.outbounds.unshift(a),r.dns=await Ot(t,[],void 0,!0),r.routing.rules=vt(t,[],!1,!1,!0);let n=qo("fake-outbound","google.com","443",globalThis.userID,"google.com","google.com","",!0,!1);return n.streamSettings.wsSettings.path="/",r.outbounds.push(n),r}f(fn,"buildXrayWorkerLessConfig");async function oo(t,r,a){let{hostName:n,defaultHttpsPorts:l}=globalThis,{proxySettings:h}=await Qe(t,r),d=[],v=[],p=[],g,{proxyIP:y,outProxy:w,outProxyParams:_,cleanIPs:k,enableIPv6:M,customCdnAddrs:z,customCdnHost:V,customCdnSni:W,VLConfigs:B,TRConfigs:H,ports:X}=h;if(w){let P=JSON.parse(_);try{g=sn(P,M)}catch(F){console.log("An error occured while parsing chain proxy: ",F),g=void 0,await r.kv.put("proxySettings",JSON.stringify({...h,outProxy:"",outProxyParams:{}}))}}let K=await gt(k,M),x=z?z.split(","):[],A=a?[...K]:[...K,...x],D=X.filter((P=>a?l.includes(P):!0));B&&p.push(atob("VkxFU1M=")),H&&p.push(atob("VHJvamFu"));let E=1,L=a?ro(h,!0,!1,"fragment"):null;for(let P of p){let F=1;for(let Y of D)for(let se of A){let ie=x.includes(se),Se=ie?"C":a?"F":"",te=ie?W:wt(n),fe=ie?V:n,me=mt(F,Y,se,k,P,Se),xe=St(h,me,!1,g,!1,!1);a&&xe.outbounds.unshift(L),xe.dns=await Ot(h,[se],void 0,!1,!1),xe.routing.rules=vt(h,[se],g,!1,!1);let ke=P===atob("VkxFU1M=")?qo("proxy",se,Y,fe,te,y,a,ie,M):nn("proxy",se,Y,fe,te,y,a,ie,M);if(xe.outbounds.unshift({...ke}),ke.tag=`prox-${E}`,g){xe.outbounds.unshift(g);let ne=structuredClone(g);ne.tag=`chain-${E}`,ne.streamSettings.sockopt.dialerProxy=`prox-${E}`,v.push(ne)}v.push(ke),d.push(xe),E++,F++}}a&&v.push(L);let R=await cn(h,A,g,v,a),J=[...d,R];if(a){let P=await ln(h,n,g,v),F=await fn(h);J.push(P,F)}return new Response(JSON.stringify(J,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(oo,"getXrayCustomConfigs");async function Zo(t,r,a){let{proxySettings:n,warpConfigs:l}=await Qe(t,r),{warpEndpoints:h}=n,d=[],v=[],p=[],g=[],y=h.split(",").map((B=>B.split(":")[0])).filter((B=>Me(B))),w=a!=="xray"?" Pro ":" ",_=a==="xray-pro"?"udp-noise":void 0,k;for(let[B,H]of h.split(",").entries()){let X=H.split(":")[0],K=St(n,` ${B+1} - Warp${w}`,!1,!1,!1,!0),x=St(n,` ${B+1} - WoW${w}`,!1,!0,!1,!0);a==="xray-pro"&&(k=ro(n,!1,!0,"udp-noise"),K.outbounds.unshift(k),x.outbounds.unshift(k)),K.dns=x.dns=await Ot(n,[X],void 0,!1,!0),K.routing.rules=vt(n,[X],!1,!1,!1),x.routing.rules=vt(n,[X],!0,!1,!1);let A=Qo(n,l,H,_,a),D=Qo(n,l,H,"proxy",a);K.outbounds.unshift(A),x.outbounds.unshift(D,A),d.push(K),v.push(x);let E=structuredClone(A);E.tag=`prox-${B+1}`;let L=structuredClone(D);L.tag=`chain-${B+1}`,L.streamSettings.sockopt.dialerProxy=`prox-${B+1}`,p.push(E),g.push(L)}let M=await Ot(n,y,void 0,!1,!0),z=St(n,` Warp${w}- Best Ping `,!0,!1,!1,!0);z.dns=M,z.routing.rules=vt(n,y,!1,!0,!1),a==="xray-pro"&&z.outbounds.unshift(k),z.outbounds.unshift(...p);let V=St(n,` WoW${w}- Best Ping `,!0,!0,!1,!0);V.dns=M,V.routing.rules=vt(n,y,!0,!0,!1),a==="xray-pro"&&V.outbounds.unshift(k),V.outbounds.unshift(...g,...p);let W=[...d,...v,z,V];return new Response(JSON.stringify(W,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(Zo,"getXrayWarpConfigs");var dn={remarks:"",log:{loglevel:"warning"},dns:{},inbounds:[{port:10808,protocol:"socks",settings:{auth:"noauth",udp:!0,userLevel:8},sniffing:{destOverride:["http","tls"],enabled:!0,routeOnly:!0},tag:"socks-in"},{port:10853,protocol:"dokodemo-door",settings:{address:"1.1.1.1",network:"tcp,udp",port:53},tag:"dns-in"}],outbounds:[{protocol:"dns",tag:"dns-out"},{protocol:"freedom",settings:{domainStrategy:"UseIP"},tag:"direct"},{protocol:"blackhole",settings:{response:{type:"http"}},tag:"block"}],policy:{levels:{8:{connIdle:300,downlinkOnly:1,handshake:4,uplinkOnly:1}},system:{statsOutboundUplink:!0,statsOutboundDownlink:!0}},routing:{domainStrategy:"IPIfNonMatch",rules:[],balancers:[{tag:"all",selector:["prox"],strategy:{type:"leastPing"}}]},observatory:{subjectSelector:["prox"],probeUrl:"https://www.gstatic.com/generate_204",probeInterval:"30s",enableConcurrency:!0},stats:{}};function ta(t,r,a){let{remoteDNS:n,localDNS:l,VLTRFakeDNS:h,enableIPv6:d,warpFakeDNS:v,warpEnableIPv6:p,bypassIran:g,bypassChina:y,bypassRussia:w,blockAds:_,blockPorn:k,customBypassRules:M,customBlockRules:z}=t,V,W=Lt(n),B=h&&!a||v&&a,H=d&&!a||p&&a,X=M.split(",").filter((F=>Me(F))),K=z.split(",").filter((F=>Me(F))),x=[{rule:g,type:"direct",geosite:"geosite-ir",geoip:"geoip-ir"},{rule:y,type:"direct",geosite:"geosite-cn",geoip:"geoip-cn"},{rule:w,type:"direct",geosite:"geosite-category-ru",geoip:"geoip-ru"},{rule:!0,type:"block",geosite:"geosite-malware"},{rule:!0,type:"block",geosite:"geosite-phishing"},{rule:!0,type:"block",geosite:"geosite-cryptominers"},{rule:_,type:"block",geosite:"geosite-category-ads-all"},{rule:k,type:"block",geosite:"geosite-nsfw"}],A=[{address:a?"1.1.1.1":n,address_resolver:W.isHostDomain?"doh-resolver":"dns-direct",detour:" Selector",tag:"dns-remote"},{address:l==="localhost"?"local":l,detour:"direct",tag:"dns-direct"},{address:"local",tag:"dns-local"}];W.isHostDomain&&!a&&A.push({address:"https://8.8.8.8/dns-query",detour:" Selector",tag:"doh-resolver"});let D;if(a)D={outbound:"any",server:"dns-direct"};else{let F=r.filter((se=>Me(se)));D={domain:[...new Set(F)],server:"dns-direct"}}let E=[D,{domain:"www.gstatic.com",server:"dns-local"},{domain:["raw.githubusercontent.com","time.apple.com"],server:"dns-direct"},{clash_mode:"Direct",server:"dns-direct"},{clash_mode:"Global",server:"dns-remote"}],L={disable_cache:!0,rule_set:[],action:"reject"};x.forEach((({rule:F,type:Y,geosite:se,geoip:ie})=>{F&&Y==="direct"&&E.push({type:"logical",mode:"and",rules:[{rule_set:se},{rule_set:ie}],server:"dns-direct"}),F&&Y==="block"&&L.rule_set.push(se)})),E.push(L);let R=f((F=>({domain_suffix:[],server:F})),"createRule"),J,P;return X.length&&(J=R("dns-direct"),X.forEach((F=>{J.domain_suffix.push(F)})),E.push(J)),K.length&&(P=R("dns-block"),K.forEach((F=>{P.domain_suffix.push(F)})),E.push(P)),B&&(A.push({address:"fakeip",tag:"dns-fake"}),E.push({disable_cache:!0,inbound:"tun-in",query_type:["A","AAAA"],server:"dns-fake"}),V={enabled:!0,inet4_range:"198.18.0.0/15"},H&&(V.inet6_range="fc00::/18")),{servers:A,rules:E,fakeip:V}}f(ta,"buildSingBoxDNS");function ra(t){let{bypassLAN:r,bypassIran:a,bypassChina:n,bypassRussia:l,blockAds:h,blockPorn:d,blockUDP443:v,customBypassRules:p,customBlockRules:g}=t,y=p?p.split(","):[],w=g?g.split(","):[],_=[{action:"sniff"},{action:"hijack-dns",mode:"or",rules:[{inbound:"dns-in"},{protocol:"dns"}],type:"logical"},{clash_mode:"Direct",outbound:"direct"},{clash_mode:"Global",outbound:" Selector"}],k=[{rule:a,type:"direct",ruleSet:{geosite:"geosite-ir",geoip:"geoip-ir",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-ir.srs",geoipURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geoip-ir.srs"}},{rule:n,type:"direct",ruleSet:{geosite:"geosite-cn",geoip:"geoip-cn",geositeURL:"https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-cn.srs",geoipURL:"https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-cn.srs"}},{rule:l,type:"direct",ruleSet:{geosite:"geosite-category-ru",geoip:"geoip-ru",geositeURL:"https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-category-ru.srs",geoipURL:"https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-ru.srs"}},{rule:!0,type:"block",ruleSet:{geosite:"geosite-malware",geoip:"geoip-malware",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-malware.srs",geoipURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geoip-malware.srs"}},{rule:!0,type:"block",ruleSet:{geosite:"geosite-phishing",geoip:"geoip-phishing",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-phishing.srs",geoipURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geoip-phishing.srs"}},{rule:!0,type:"block",ruleSet:{geosite:"geosite-cryptominers",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-cryptominers.srs"}},{rule:h,type:"block",ruleSet:{geosite:"geosite-category-ads-all",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-category-ads-all.srs"}},{rule:d,type:"block",ruleSet:{geosite:"geosite-nsfw",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-sing-box-rules/rule-set/geosite-nsfw.srs"}}],M=[],z=[],V=[],W=[],B=[];r&&z.push({ip_is_private:!0,outbound:"direct"});let H=f(((J,P)=>P==="direct"?{[J]:[],outbound:P}:{[J]:[],action:P}),"createRule"),X={type:"remote",tag:"",format:"binary",url:"",download_detour:"direct"},K=H("rule_set","direct"),x=H("rule_set","direct"),A=H("rule_set","reject"),D=H("rule_set","reject");k.forEach((({rule:J,type:P,ruleSet:F})=>{if(!J)return;let{geosite:Y,geoip:se,geositeURL:ie,geoipURL:Se}=F,te=P==="direct",fe=te?K:A,me=te?x:D;fe.rule_set.push(Y),B.push({...X,tag:Y,url:ie}),se&&(me.rule_set.push(se),B.push({...X,tag:se,url:Se}))}));let E=f(((J,P)=>{(J.rule_set?.length||J.domain_suffix?.length||J.ip_cidr?.length)&&P.push(J)}),"pushRuleIfNotEmpty");E(K,M),E(x,z),E(A,V),E(D,W);let L=f(((J,P)=>{let F=H("domain_suffix",P),Y=H("ip_cidr",P);J.forEach((se=>{if(Me(se))F.domain_suffix.push(se);else{let ie=Rt(se)?se.replace(/\[|\]/g,""):se;Y.ip_cidr.push(ie)}})),E(F,P==="direct"?M:V),E(Y,P==="direct"?z:W)}),"processRules");y.length&&L(y,"direct"),w.length&&L(w,"reject");let R=[];return v&&R.push({network:"udp",port:443,protocol:"quic",action:"reject"}),R=[..._,...R,...V,...W,...M,...z],{rules:R,rule_set:B}}f(ra,"buildSingBoxRoutingRules");function un(t,r,a,n,l,h,d){let{userID:v,defaultHttpsPorts:p}=globalThis,{enableIPv6:g,proxyIP:y}=t,w=`/${nt(16)}${y?`/${btoa(y)}`:""}`,_=!!p.includes(n),k={type:atob("dmxlc3M="),server:a,server_port:+n,uuid:v,packet_encoding:"",tls:{alpn:"http/1.1",enabled:!0,insecure:d,server_name:h,utls:{enabled:!0,fingerprint:"randomized"}},transport:{early_data_header_name:"Sec-WebSocket-Protocol",max_early_data:2560,headers:{Host:l},path:w,type:"ws"},tcp_fast_open:!0,tcp_multi_path:!0,tag:r};return Me(a)&&(k.domain_strategy=g?"prefer_ipv4":"ipv4_only"),_||delete k.tls,k}f(un,"buildSingBoxVLOutbound");function pn(t,r,a,n,l,h,d){let{TRPassword:v,defaultHttpsPorts:p}=globalThis,{enableIPv6:g,proxyIP:y}=t,w=`/tr${nt(16)}${y?`/${btoa(y)}`:""}`,_=!!p.includes(n),k={type:atob("dHJvamFu"),password:v,server:a,server_port:+n,tls:{alpn:"http/1.1",enabled:!0,insecure:d,server_name:h,utls:{enabled:!0,fingerprint:"randomized"}},transport:{early_data_header_name:"Sec-WebSocket-Protocol",max_early_data:2560,headers:{Host:l},path:w,type:"ws"},tcp_fast_open:!0,tcp_multi_path:!0,tag:r};return Me(a)&&(k.domain_strategy=g?"prefer_ipv4":"ipv4_only"),_||delete k.tls,k}f(pn,"buildSingBoxTROutbound");function ea(t,r,a,n,l){let h=/\[(.*?)\]/,d=/[^:]*$/,v=n.includes("[")?n.match(h)[1]:n.split(":")[0],p=n.includes("[")?+n.match(d)[0]:+n.split(":")[1],g=l?"162.159.192.1":v,y=l?2408:p,{warpEnableIPv6:w}=t,{warpIPv6:_,reserved:k,publicKey:M,privateKey:z}=yt(r,l),V={address:["172.16.0.2/32",_],mtu:1280,peers:[{address:g,port:y,public_key:M,reserved:vr(k),allowed_ips:["0.0.0.0/0","::/0"],persistent_keepalive_interval:5}],private_key:z,type:"wireguard",tag:a};return Me(g)&&(V.domain_strategy=w?"prefer_ipv4":"ipv4_only"),l&&(V.detour=l),V}f(ea,"buildSingBoxWarpOutbound");function hn(t,r){if(["socks","http"].includes(t.protocol)){let{protocol:B,server:H,port:X,user:K,pass:x}=t,A={type:B,tag:"",server:H,server_port:+X,username:K,password:x,detour:""};return Me(H)&&(A.domain_strategy=r?"prefer_ipv4":"ipv4_only"),B==="socks"&&(A.version="5"),A}let{server:a,port:n,uuid:l,flow:h,security:d,type:v,sni:p,fp:g,alpn:y,pbk:w,sid:_,headerType:k,host:M,path:z,serviceName:V}=t,W={type:atob("dmxlc3M="),tag:"",server:a,server_port:+n,uuid:l,flow:h,detour:""};if(Me(a)&&(W.domain_strategy=r?"prefer_ipv4":"ipv4_only"),d==="tls"||d==="reality"){let B=y?y?.split(",").filter((H=>H!=="h2")):[];W.tls={enabled:!0,server_name:p,insecure:!1,alpn:B,utls:{enabled:!0,fingerprint:g}},d==="reality"&&(W.tls.reality={enabled:!0,public_key:w,short_id:_},delete W.tls.alpn)}if(k==="http"){let B=M?.split(",");W.transport={type:"http",host:B,path:z,method:"GET",headers:{Connection:["keep-alive"],"Content-Type":["application/octet-stream"]}}}if(v==="ws"){let B=z?.split("?ed=")[0],H=+z?.split("?ed=")[1]||0;W.transport={type:"ws",path:B,headers:{Host:M},max_early_data:H,early_data_header_name:"Sec-WebSocket-Protocol"}}return v==="grpc"&&(W.transport={type:"grpc",service_name:V}),W}f(hn,"buildSingBoxChainOutbound");async function oa(t,r){let{proxySettings:a,warpConfigs:n}=await Qe(t,r),{warpEndpoints:l}=a,h=structuredClone(na);h.endpoints=[];let d=ta(a,void 0,!0),{rules:v,rule_set:p}=ra(a);h.dns.servers=d.servers,h.dns.rules=d.rules,d.fakeip&&(h.dns.fakeip=d.fakeip),h.route.rules=v,h.route.rule_set=p;let g=h.outbounds[0],y=h.outbounds[1];g.outbounds=[" Warp - Best Ping "," WoW - Best Ping "],h.outbounds.splice(2,0,structuredClone(y));let w=h.outbounds[2];y.tag=" Warp - Best Ping ",y.interval=`${a.bestWarpInterval}s`,w.tag=" WoW - Best Ping ",w.interval=`${a.bestWarpInterval}s`;let _=[],k=[];return l.split(",").forEach(((M,z)=>{let V=` ${z+1} - Warp `,W=` ${z+1} - WoW `,B=ea(a,n,V,M,""),H=ea(a,n,W,M,V);h.endpoints.push(H,B),_.push(V),k.push(W),y.outbounds.push(V),w.outbounds.push(W)})),g.outbounds.push(..._,...k),new Response(JSON.stringify(h,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(oa,"getSingBoxWarpConfig");async function aa(t,r){let{hostName:a}=globalThis,{proxySettings:n}=await Qe(t,r),l,{cleanIPs:h,ports:d,VLConfigs:v,TRConfigs:p,outProxy:g,outProxyParams:y,customCdnAddrs:w,customCdnHost:_,customCdnSni:k,bestVLTRInterval:M,enableIPv6:z}=n;if(g){let R=JSON.parse(y);try{l=hn(R,z)}catch(J){console.log("An error occured while parsing chain proxy: ",J),l=void 0,await r.kv.put("proxySettings",JSON.stringify({...n,outProxy:"",outProxyParams:{}}))}}let V=await gt(h,z),W=w?w.split(","):[],B=[...V,...W],H=structuredClone(na),X=ta(n,B,!1),{rules:K,rule_set:x}=ra(n);H.dns.servers=X.servers,H.dns.rules=X.rules,X.fakeip&&(H.dns.fakeip=X.fakeip),H.route.rules=K,H.route.rule_set=x;let A=H.outbounds[0],D=H.outbounds[1];A.outbounds=[" Best Ping "],D.interval=`${M}s`,D.tag=" Best Ping ";let E=1;return[...v?[atob("VkxFU1M=")]:[],...p?[atob("VHJvamFu")]:[]].forEach((R=>{let J=1;d.forEach((P=>{B.forEach((F=>{let Y,se,ie=W.includes(F),Se=ie?"C":"",te=ie?k:wt(a),fe=ie?_:a,me=mt(J,P,F,h,R,Se);if(R===atob("VkxFU1M=")&&(Y=un(n,l?`proxy-${E}`:me,F,P,fe,te,ie),H.outbounds.push(Y)),R===atob("VHJvamFu")&&(se=pn(n,l?`proxy-${E}`:me,F,P,fe,te,ie),H.outbounds.push(se)),l){let xe=structuredClone(l);xe.tag=me,xe.detour=`proxy-${E}`,H.outbounds.push(xe)}A.outbounds.push(me),D.outbounds.push(me),E++,J++}))}))})),new Response(JSON.stringify(H,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(aa,"getSingBoxCustomConfig");var na={log:{level:"warn",timestamp:!0},dns:{servers:[],rules:[],strategy:"ipv4_only",independent_cache:!0},inbounds:[{type:"direct",tag:"dns-in",listen:"0.0.0.0",listen_port:6450,override_address:"1.1.1.1",override_port:53},{type:"tun",tag:"tun-in",address:["172.18.0.1/30","fdfe:dcba:9876::1/126"],mtu:9e3,auto_route:!0,strict_route:!0,endpoint_independent_nat:!0,stack:"mixed"},{type:"mixed",tag:"mixed-in",listen:"0.0.0.0",listen_port:2080}],outbounds:[{type:"selector",tag:" Selector",outbounds:[]},{type:"urltest",tag:"",outbounds:[],url:"https://www.gstatic.com/generate_204",interval:""},{type:"direct",domain_strategy:"ipv4_only",tag:"direct"}],route:{rules:[],rule_set:[],auto_detect_interface:!0,override_android_vpn:!0,final:" Selector"},ntp:{enabled:!0,server:"time.apple.com",server_port:123,detour:"direct",interval:"30m"},experimental:{cache_file:{enabled:!0,store_fakeip:!0},clash_api:{external_controller:"127.0.0.1:9090",external_ui:"ui",external_ui_download_url:"https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip",external_ui_download_detour:"direct",default_mode:"Rule"}}};async function ia(t,r,a){let{remoteDNS:n,localDNS:l,VLTRFakeDNS:h,outProxyParams:d,enableIPv6:v,warpFakeDNS:p,warpEnableIPv6:g,bypassIran:y,bypassChina:w,bypassRussia:_,customBypassRules:k}=t,M=g?["1.1.1.1","1.0.0.1","[2606:4700:4700::1111]","[2606:4700:4700::1001]"]:["1.1.1.1","1.0.0.1"],z=l==="localhost"?"system":`${l}#DIRECT`,V=h&&!a||p&&a,W=v&&!a||g&&a,B=k.split(",").filter((A=>Me(A))),H=y||w||_,X=[{rule:y,geosite:"ir"},{rule:w,geosite:"cn"},{rule:_,geosite:"ru"}],K={enable:!0,listen:"0.0.0.0:1053",ipv6:W,"respect-rules":!0,"use-system-hosts":!1,nameserver:a?M.map((A=>`${A}# Selector`)):[r?`${n}#proxy-1`:`${n}# Selector`],"proxy-server-nameserver":[z],"nameserver-policy":{"raw.githubusercontent.com":z,"time.apple.com":z,"www.gstatic.com":"system"}};if(r&&!a){let A=JSON.parse(d).server;Me(A)&&(K["nameserver-policy"][A]=`${n}#proxy-1`)}if(H){let A=[];X.forEach((({rule:D,geosite:E})=>{D&&A.push(E)})),K["nameserver-policy"][`rule-set:${A.join(",")}`]=[z]}return B.forEach((A=>{K["nameserver-policy"][`+.${A}`]=[z]})),Lt(n).isHostDomain&&!a&&(K["default-nameserver"]=[`https://8.8.8.8/dns-query#${r?"proxy-1":" Selector"}`]),V&&Object.assign(K,{"enhanced-mode":"fake-ip","fake-ip-range":"198.18.0.1/16","fake-ip-filter":["geosite:private"]}),K}f(ia,"buildClashDNS");function ca(t){let{bypassLAN:r,bypassIran:a,bypassChina:n,bypassRussia:l,blockAds:h,blockPorn:d,blockUDP443:v,customBypassRules:p,customBlockRules:g}=t,y=p?p.split(","):[],w=g?g.split(","):[],_=[{rule:r,type:"direct",noResolve:!0,ruleProvider:{format:"yaml",geosite:"private",geoip:"private-cidr",geositeURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.yaml",geoipURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/private.yaml"}},{rule:a,type:"direct",ruleProvider:{format:"text",geosite:"ir",geoip:"ir-cidr",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ir.txt",geoipURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ircidr.txt"}},{rule:n,type:"direct",ruleProvider:{format:"yaml",geosite:"cn",geoip:"cn-cidr",geositeURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.yaml",geoipURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.yaml"}},{rule:l,type:"direct",ruleProvider:{format:"yaml",geosite:"ru",geoip:"ru-cidr",geositeURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ru.yaml",geoipURL:"https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/ru.yaml"}},{rule:!0,type:"block",ruleProvider:{format:"text",geosite:"malware",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/malware.txt"}},{rule:!0,type:"block",ruleProvider:{format:"text",geosite:"phishing",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/phishing.txt"}},{rule:!0,type:"block",ruleProvider:{format:"text",geosite:"cryptominers",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/cryptominers.txt"}},{rule:h,type:"block",ruleProvider:{format:"text",geosite:"ads",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ads.txt"}},{rule:d,type:"block",ruleProvider:{format:"text",geosite:"nsfw",geositeURL:"https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/nsfw.txt"}}];function k(K,x,A,D){let E=x==="text"?"txt":x;return{[K]:{type:"http",format:x,behavior:A,url:D,path:`./ruleset/${K}.${E}`,interval:86400}}}f(k,"buildRuleProvider");let M=[],z=[],V=[],W=[],B={};_.forEach((({rule:K,type:x,ruleProvider:A,noResolve:D})=>{let{geosite:E,geoip:L,geositeURL:R,geoipURL:J,format:P}=A;if(K){if(E){(x==="direct"?M:V).push(`RULE-SET,${E},${x==="direct"?"DIRECT":"REJECT"}`);let Y=k(E,P,"domain",R);Object.assign(B,Y)}if(L){(x==="direct"?z:W).push(`RULE-SET,${L},${x==="direct"?"DIRECT":"REJECT"}${D?",no-resolve":""}`);let Y=k(L,P,"ipcidr",J);Object.assign(B,Y)}}}));let H=f(((K,x)=>{if(Me(K))return`DOMAIN-SUFFIX,${K},${x}`;{let A=Sr(K)?"IP-CIDR":"IP-CIDR6",D=Rt(K)?K.replace(/\[|\]/g,""):K,E=K.includes("/")?"":Sr(K)?"/32":"/128";return`${A},${D}${E},${x},no-resolve`}}),"generateRule");[...y,...w].forEach(((K,x)=>{let A=x<y.length,D=A?"DIRECT":"REJECT";(A?Me(K)?M:z:Me(K)?V:W).push(H(K,D))}));let X=[];return v&&X.push("AND,((NETWORK,udp),(DST-PORT,443)),REJECT"),X.push("OR,((IP-CIDR,10.10.34.34/32),(IP-CIDR,10.10.34.35/32),(IP-CIDR,10.10.34.36/32)),REJECT"),X=[...X,...V,...W,...M,...z],X.push("MATCH, Selector"),{rules:X,ruleProviders:B}}f(ca,"buildClashRoutingRules");function mn(t,r,a,n,l,h,d){let{userID:v,defaultHttpsPorts:p}=globalThis,g=!!p.includes(a),y=Rt(r)?r.replace(/\[|\]/g,""):r,w={name:t,type:atob("dmxlc3M="),server:y,port:+a,uuid:v,"packet-encoding":"packetaddr",tls:g,network:"ws",udp:!0,"ws-opts":{path:h,headers:{Host:n},"max-early-data":2560,"early-data-header-name":"Sec-WebSocket-Protocol"}};return g&&Object.assign(w,{servername:l,alpn:["http/1.1"],"client-fingerprint":"random","skip-cert-verify":d}),w}f(mn,"buildClashVLOutbound");function xn(t,r,a,n,l,h,d){let v=Rt(r)?r.replace(/\[|\]/g,""):r;return{name:t,type:atob("dHJvamFu"),server:v,port:+a,password:globalThis.TRPassword,network:"ws",udp:!0,"ws-opts":{path:h,headers:{Host:n},"max-early-data":2560,"early-data-header-name":"Sec-WebSocket-Protocol"},sni:l,alpn:["http/1.1"],"client-fingerprint":"random","skip-cert-verify":d}}f(xn,"buildClashTROutbound");function sa(t,r,a,n,l,h){let{amneziaNoiseCount:d,amneziaNoiseSizeMin:v,amneziaNoiseSizeMax:p}=t,g=/\[(.*?)\]/,y=/[^:]*$/,w=n.includes("[")?n.match(g)[1]:n.split(":")[0],_=n.includes("[")?+n.match(y)[0]:+n.split(":")[1],{warpIPv6:k,reserved:M,publicKey:z,privateKey:V}=yt(r,l),W={name:a,type:"wireguard",ip:"172.16.0.2/32",ipv6:k,"private-key":V,server:l?"162.159.192.1":w,port:l?2408:_,"public-key":z,"allowed-ips":["0.0.0.0/0","::/0"],reserved:M,udp:!0,mtu:1280};return l&&(W["dialer-proxy"]=l),h&&(W["amnezia-wg-option"]={jc:d,jmin:v,jmax:p}),W}f(sa,"buildClashWarpOutbound");function bn(t){if(["socks","http"].includes(t.protocol)){let{protocol:W,server:B,port:H,user:X,pass:K}=t;return{name:"",type:W==="socks"?"socks5":W,server:B,port:+H,"dialer-proxy":"",username:X,password:K}}let{server:r,port:a,uuid:n,flow:l,security:h,type:d,sni:v,fp:p,alpn:g,pbk:y,sid:w,headerType:_,host:k,path:M,serviceName:z}=t,V={name:" Chain Best Ping ",type:atob("dmxlc3M="),server:r,port:+a,udp:!0,uuid:n,flow:l,network:d,"dialer-proxy":" Best Ping "};if(h==="tls"){let W=g?g?.split(","):[];Object.assign(V,{tls:!0,servername:v,alpn:W,"client-fingerprint":p})}if(h==="reality"&&Object.assign(V,{tls:!0,servername:v,"client-fingerprint":p,"reality-opts":{"public-key":y,"short-id":w}}),_==="http"){let W=M?.split(",");V["http-opts"]={method:"GET",path:W,headers:{Connection:["keep-alive"],"Content-Type":["application/octet-stream"]}}}if(d==="ws"){let W=M?.split("?ed=")[0],B=+M?.split("?ed=")[1];V["ws-opts"]={path:W,headers:{Host:k},"max-early-data":B,"early-data-header-name":"Sec-WebSocket-Protocol"}}return d==="grpc"&&(V["grpc-opts"]={"grpc-service-name":z}),V}f(bn,"buildClashChainOutbound");async function ao(t,r,a){let{proxySettings:n,warpConfigs:l}=await Qe(t,r),{warpEndpoints:h}=n,d=structuredClone(fa);d.dns=await ia(n,!0,!0);let{rules:v,ruleProviders:p}=ca(n);d.rules=v,d["rule-providers"]=p;let g=d["proxy-groups"][0],y=d["proxy-groups"][1];g.proxies=[` Warp ${a?"Pro ":""}- Best Ping `,` WoW ${a?"Pro ":""}- Best Ping `],y.name=` Warp ${a?"Pro ":""}- Best Ping `,y.interval=+n.bestWarpInterval,d["proxy-groups"].push(structuredClone(y));let w=d["proxy-groups"][2];w.name=` WoW ${a?"Pro ":""}- Best Ping `;let _=[],k=[];return h.split(",").forEach(((M,z)=>{let V=` ${z+1} - Warp ${a?"Pro ":""}`,W=` ${z+1} - WoW ${a?"Pro ":""}`,B=sa(n,l,V,M,"",a),H=sa(n,l,W,M,V);d.proxies.push(H,B),_.push(V),k.push(W),y.proxies.push(V),w.proxies.push(W)})),g.proxies.push(..._,...k),new Response(JSON.stringify(d,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(ao,"getClashWarpConfig");async function la(t,r){let{hostName:a,defaultHttpsPorts:n}=globalThis,{proxySettings:l}=await Qe(t,r),h,{cleanIPs:d,proxyIP:v,ports:p,VLConfigs:g,TRConfigs:y,outProxy:w,outProxyParams:_,customCdnAddrs:k,customCdnHost:M,customCdnSni:z,bestVLTRInterval:V,enableIPv6:W}=l;if(w){let P=JSON.parse(_);try{h=bn(P)}catch(F){console.log("An error occured while parsing chain proxy: ",F),h=void 0,await r.kv.put("proxySettings",JSON.stringify({...l,outProxy:"",outProxyParams:{}}))}}let B=structuredClone(fa),{rules:H,ruleProviders:X}=ca(l);B.dns=await ia(l,h,!1),B.rules=H,B["rule-providers"]=X;let K=B["proxy-groups"][0],x=B["proxy-groups"][1];K.proxies=[" Best Ping "],x.name=" Best Ping ",x.interval=+V;let A=await gt(d,W),D=k?k.split(","):[],E=[...A,...D],L=1,R;return[...g?[atob("VkxFU1M=")]:[],...y?[atob("VHJvamFu")]:[]].forEach((P=>{let F=1;p.forEach((Y=>{E.forEach((se=>{let ie,Se,te=D.includes(se),fe=te?"C":"",me=te?z:wt(a),xe=te?M:a,ke=mt(F,Y,se,d,P,fe).replace(" : "," - ");if(P===atob("VkxFU1M=")&&(R=`/${nt(16)}${v?`/${btoa(v)}`:""}`,ie=mn(h?`proxy-${L}`:ke,se,Y,xe,me,R,te),B.proxies.push(ie),K.proxies.push(ke),x.proxies.push(ke)),P===atob("VHJvamFu")&&n.includes(Y)&&(R=`/tr${nt(16)}${v?`/${btoa(v)}`:""}`,Se=xn(h?`proxy-${L}`:ke,se,Y,xe,me,R,te),B.proxies.push(Se),K.proxies.push(ke),x.proxies.push(ke)),h){let ne=structuredClone(h);ne.name=ke,ne["dialer-proxy"]=`proxy-${L}`,B.proxies.push(ne)}L++,F++}))}))})),new Response(JSON.stringify(B,null,4),{status:200,headers:{"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(la,"getClashNormalConfig");var fa={"mixed-port":7890,ipv6:!0,"allow-lan":!0,mode:"rule","log-level":"warning","disable-keep-alive":!1,"keep-alive-idle":10,"keep-alive-interval":15,"unified-delay":!1,"geo-auto-update":!0,"geo-update-interval":168,"external-controller":"127.0.0.1:9090","external-ui-url":"https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip","external-ui":"ui","external-controller-cors":{"allow-origins":["*"],"allow-private-network":!0},profile:{"store-selected":!0,"store-fake-ip":!0},dns:{},tun:{enable:!0,stack:"mixed","auto-route":!0,"strict-route":!0,"auto-detect-interface":!0,"dns-hijack":["any:53","tcp://any:53"],mtu:9e3},sniffer:{enable:!0,"force-dns-mapping":!0,"parse-pure-ip":!0,"override-destination":!1,sniff:{HTTP:{ports:[80,8080,8880,2052,2082,2086,2095]},TLS:{ports:[443,8443,2053,2083,2087,2096]}}},proxies:[],"proxy-groups":[{name:" Selector",type:"select",proxies:[]},{name:"",type:"url-test",url:"https://www.gstatic.com/generate_204",interval:30,tolerance:50,proxies:[]}],"rule-providers":{},rules:[],ntp:{enable:!0,server:"time.apple.com",port:123,interval:30}};async function no(t,r){let{hostName:a,defaultHttpsPorts:n,client:l,userID:h,TRPassword:d}=globalThis,{proxySettings:v}=await Qe(t,r),{remoteDNS:p,cleanIPs:g,proxyIP:y,ports:w,VLConfigs:_,TRConfigs:k,lengthMin:M,lengthMax:z,intervalMin:V,intervalMax:W,outProxy:B,customCdnAddrs:H,customCdnHost:X,customCdnSni:K,enableIPv6:x}=v,A="",D="",E="",L=1,R=await gt(g,x),J=H?H.split(","):[],P=[...R,...J],F=encodeURIComponent(d),Y=l==="singbox"?"&eh=Sec-WebSocket-Protocol&ed=2560":encodeURIComponent("?ed=2560");if(w.forEach((Se=>{P.forEach(((te,fe)=>{let me=fe>R.length-1,xe=me?"C":"",ke=me?K:wt(a),ne=me?X:a,Fe=`${nt(16)}${y?`/${encodeURIComponent(btoa(y))}`:""}${Y}`,_t=encodeURIComponent(mt(L,Se,te,g,atob("VkxFU1M="),xe)),$t=encodeURIComponent(mt(L,Se,te,g,atob("VHJvamFu"),xe)),ft=n.includes(Se)?`&security=tls&sni=${ke}&fp=randomized&alpn=http/1.1`:"&security=none",dt=l==="hiddify-frag"&&n.includes(Se)?`&fragment=${M}-${z},${V}-${W},hellotls`:"";_&&(A+=`${atob("dmxlc3M6Ly8=")}${h}@${te}:${Se}?path=/${Fe}&encryption=none&host=${ne}&type=ws${ft}${dt}#${_t}\n`),k&&(D+=`${atob("dHJvamFuOi8v")}${F}@${te}:${Se}?path=/tr${Fe}&host=${ne}&type=ws${ft}${dt}#${$t}\n`),L++}))})),B){let Se=`#${encodeURIComponent(" Chain proxy ")}`;if(B.startsWith("socks")||B.startsWith("http")){let te=/^(?:socks|http):\/\/([^@]+)@/,fe=B.match(te),me=fe?fe[1]:!1;E=me?B.replace(me,btoa(me))+Se:B+Se}else E=B.split("#")[0]+Se}let se=btoa(A+D+E),ie={"Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"};return l==="hiddify-frag"&&Object.assign(ie,{"Profile-Title":"BPB Fragment",DNS:p}),new Response(se,{status:200,headers:ie})}f(no,"getNormalConfigs");async function so(t,r,a){let{proxySettings:n}=await Qe(t,r),{warpEndpoints:l,hiddifyNoiseMode:h,noiseCountMin:d,noiseCountMax:v,noiseSizeMin:p,noiseSizeMax:g,noiseDelayMin:y,noiseDelayMax:w}=n,_="";return l.split(",").forEach(((k,M)=>{_+=`warp://${k}${a?`?ifp=${d}-${v}&ifps=${p}-${g}&ifpd=${y}-${w}&ifpm=${h}`:""}#${encodeURIComponent(` ${M+1} - Warp `)}&&detour=warp://162.159.192.1:2408#${encodeURIComponent(` ${M+1} - WoW `)}\n`})),new Response(btoa(_),{status:200,headers:{"Profile-Title":`BPB Warp${a?" Pro":""}`,DNS:"1.1.1.1","Content-Type":"text/plain;charset=utf-8","Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate","CDN-Cache-Control":"no-store"}})}f(so,"getHiddifyWarpConfigs");async function da(){let t=`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${atob("QlBC")} Generator</title>\n    <style>\n        :root {\n            --color: black;\n            --primary-color: #09639f;\n            --header-color: #09639f; \n            --background-color: #fff;\n            --form-background-color: #f9f9f9;\n            --lable-text-color: #333;\n            --h2-color: #3b3b3b;\n            --border-color: #ddd;\n            --input-background-color: white;\n            --header-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);\n        }\n        html, body { height: 100%; margin: 0; }\n        body {\n            font-family: system-ui;\n            background-color: var(--background-color);\n            position: relative;\n            overflow: hidden;\n            text-align: center;\n        }\n        body.dark-mode {\n            --color: white;\n            --primary-color: #09639F;\n            --header-color: #3498DB; \n            --background-color: #121212;\n            --form-background-color: #121212;\n            --lable-text-color: #DFDFDF;\n            --h2-color: #D5D5D5;\n            --border-color: #353535;\n            --input-background-color: #252525;\n            --header-shadow: 2px 2px 4px rgba(255, 255, 255, 0.25);\n        }\n        html, body { height: 100%; margin: 0; }\n        .container {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            width: 90%;\n        }\n        h1 { font-size: 2.5rem; text-align: center; color: var(--header-color); margin: 0 auto 30px; text-shadow: var(--header-shadow); }        \n        h2 { text-align: center; color: var(--h2-color) }\n        strong { color: var(--lable-text-color); }\n        .output-container {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin: 15px 0;\n            padding: 10px;\n            background-color: var(--input-background-color);\n            color: var(--lable-text-color);\n            border: 1px solid var(--border-color);\n            border-radius: 5px;\n            font-family: monospace;\n            font-size: 1rem;\n            word-wrap: break-word;\n        }\n        .output { flex: 1; margin-right: 10px; overflow-wrap: break-word; }\n        .copy-icon {\n            cursor: pointer;\n            font-size: 1.2rem;\n            color: var(--primary-color);\n            transition: color 0.2s;\n        }\n        .copy-icon:hover { color: #2980b9; }\n        .form-container {\n            background: var(--form-background-color);\n            border: 1px solid var(--border-color);\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n            padding: 20px;\n        }\n        .form-control { margin-bottom: 15px; display: flex; align-items: center; }\n        button {\n            display: block;\n            width: 100%;\n            padding: 10px;\n            font-size: 16px;\n            font-weight: 600;\n            border: none;\n            border-radius: 5px;\n            color: white;\n            background-color: var(--primary-color);\n            cursor: pointer;\n            transition: background-color 0.3s ease;\n        }\n        .button:hover,\n        button:focus {\n            background-color: #2980b9;\n            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);\n            transform: translateY(-2px);\n        }\n        button.button:hover { color: white; }\n        .button:active { transform: translateY(1px); box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); }\n        @media only screen and (min-width: 768px) {\n            .container { width: 40%; }\n        }\n    </style>\n    </head>\n    <body>\n        <div class="container">\n            <h1>${atob("QlBC")} Panel <span style="font-size: smaller;">${globalThis.panelVersion}</span> </h1>\n            <div class="form-container">\n                <h2>Secrets generator</h2>\n                <div>\n                    <strong>Random UUID</strong>\n                    <div class="output-container">\n                        <span id="uuid" class="output"></span>\n                        <span class="copy-icon" onclick="copyToClipboard('uuid')"></span>\n                    </div>\n                </div>\n                <div>\n                    <strong>Random ${atob("VHJvamFu")} Password</strong>\n                    <div class="output-container">\n                        <span id="${atob("dHJvamFu")}-password" class="output"></span>\n                        <span class="copy-icon" onclick="copyToClipboard('${atob("dHJvamFu")}-password')"></span>\n                    </div>\n                </div>\n                <div>\n                    <strong>Random Subscription URI path</strong>\n                    <div class="output-container">\n                        <span id="sub-path" class="output"></span>\n                        <span class="copy-icon" onclick="copyToClipboard('sub-path')"></span>\n                    </div>\n                </div>\n                <button class="button" onclick="generateCredentials()">Generate Again </button>\n            </div>\n        </div>\n        <script>\n            localStorage.getItem('darkMode') === 'enabled' && document.body.classList.add('dark-mode');\n            function generateUUID() {\n                return crypto.randomUUID();\n            }\n    \n            function generateStrongPassword() {\n                const charset =\n                    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+[]{}|;:',.<>?";\n                let password = '';\n                const randomValues = new Uint8Array(16);\n                crypto.getRandomValues(randomValues);\n    \n                for (let i = 0; i < 16; i++) {\n                    password += charset[randomValues[i] % charset.length];\n                }\n                return password;\n            }\n            \n            function generateSubURIPath() {\n                const charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@$&*_-+;:,.";\n                let uriPath = '';\n                const randomValues = new Uint8Array(16);\n                crypto.getRandomValues(randomValues);\n    \n                for (let i = 0; i < 16; i++) {\n                    uriPath += charset[randomValues[i] % charset.length];\n                }\n                return uriPath;\n            }\n    \n            function generateCredentials() {\n                const uuid = generateUUID();\n                const password = generateStrongPassword();\n                const uriPath = generateSubURIPath();\n    \n                document.getElementById('uuid').textContent = uuid;\n                document.getElementById('${atob("dHJvamFu")}-password').textContent = password;\n                document.getElementById('sub-path').textContent = uriPath;\n            }\n    \n            function copyToClipboard(elementId) {\n                const textToCopy = document.getElementById(elementId).textContent;\n                navigator.clipboard.writeText(textToCopy)\n                    .then(() => alert(' Copied to clipboard!'))\n                    .catch(err => console.error('Failed to copy text:', err));\n            }\n    \n            generateCredentials();\n        <\/script>\n    </body>\n    </html>`;return new Response(t,{status:200,headers:{"Content-Type":"text/html"}})}f(da,"renderSecretsPage");var pl={async fetch(t,r){try{Lo(t,r);let{pathName:a,subPath:n,client:l}=globalThis,h=t.headers.get("Upgrade");if(!h||h!=="websocket")switch(a){case"/update-warp":return await Zr(t,r);case"/get-warp-configs":return l==="amnezia"?await eo(t,r,!0):await eo(t,r);case`/sub/${n}`:return l==="sfa"?await aa(t,r,!1):l==="clash"?await la(t,r):l==="xray"?await oo(t,r,!1):await no(t,r);case`/fragsub/${n}`:return l==="hiddify-frag"?await no(t,r):await oo(t,r,!0);case`/warpsub/${n}`:return l==="clash"?await ao(t,r):l==="clash-pro"?await ao(t,r,!0):l==="singbox"?await oa(t,r,l):l==="hiddify-pro"?await so(t,r,!0):l==="hiddify"?await so(t,r,!1):await Zo(t,r,l);case"/panel":return await Uo(t,r);case"/login":return await No(t,r);case"/logout":return To();case"/panel/password":return await Do(t,r);case"/my-ip":return await Wo(t);case"/secrets":return await da();default:return await Bo(t)}else return a.startsWith("/tr")?await Go(t):await Ko(t)}catch(a){return await Xo(a)}}};export{pl as default};